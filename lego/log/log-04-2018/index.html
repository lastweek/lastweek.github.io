
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Yizhou Shan">
      
      
        <link rel="canonical" href="http://lastweek.io/lego/log/log-04-2018/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>April 2018 - Yizhou Shan's Home Page</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Courier+Prime+Bold:300,300i,400,400i,700,700i%7CCourier+Prime+Bold:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Courier Prime Bold";--md-code-font:"Courier Prime Bold"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#april-2018" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Yizhou Shan&#39;s Home Page" class="md-header__button md-logo" aria-label="Yizhou Shan's Home Page" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Yizhou Shan's Home Page
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              April 2018
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/lastweek/lastweek.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81s-5.7.083-8.4 1.11c-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.1 18.1 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3s9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../notes/ssd/" class="md-tabs__link">
          
  
  Notes

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../notes/source_code/summary/" class="md-tabs__link">
          
  
  Code

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../fpga/bitstream/" class="md-tabs__link">
          
  
  FPGA

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../misc/" class="md-tabs__link">
          
  
  LegoOS

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Yizhou Shan&#39;s Home Page" class="md-nav__button md-logo" aria-label="Yizhou Shan's Home Page" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Yizhou Shan's Home Page
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lastweek/lastweek.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81s-5.7.083-8.4 1.11c-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.1 18.1 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3s9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Notes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/ssd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSD 101
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/CXL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is CXL?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/MLIR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is MLIR?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/virt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modern Virtualization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/cache_coherence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practical Cache Coherence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/resource-disaggregation-spectrum/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resource Disaggregation Design Spectrums
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/dist-xact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distributed Transactions and Databases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/dynamic_linking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dynamic Linking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/dcn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Center Networking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/packet-sched/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Switch Buffering and Packet Scheduling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/sysml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SysML
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/arch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/cryptography/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cryptography
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/cryptocurrency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cryptocurrency
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/hardware_pl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hardware Design Languages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/paper_perf_shadows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performance-Shadows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/essential/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Essential
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cheatsheet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/20200404-on-read-once/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    On Read Once and Compiler Optimization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Code
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Code
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linux
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-function-trace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Dump Function Graph
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/fork/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux fork/switch_to
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-rcu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux RCU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-completion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Completion/swait
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-workqueue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux workqueue
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-linker-script/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Linker Script
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-boot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Boot Sequence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/trace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Trace and Profile
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/rmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Reverse Mapping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/userfaultfd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Userfaultfd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/cgroup-swap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Cgroup and Swap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/xperf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux x86 Ring Switch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-x86-fpu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux FPU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-iouring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux io_uring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-resource/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Resource
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/proc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Special Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/kvm-basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux KVM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/rust.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Rust
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Go
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Go
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/go/golang/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learn Go
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/go/gvisor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gVisor
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Rust
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Rust
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/rust/rust/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learn Rust
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/rust/firecracker.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Firecracker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/rdma/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DPDK and RDMA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/program_advice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guideline & Advice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/firmware-softwares/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Firmware & Bootloader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/os/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Operating System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/compilers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compilers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/unix-tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unix Tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/virt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtualization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/20200501-on-graphic-softwares/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Graphics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/gpu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/fpga/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FPGA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/risc-v/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RISC-V
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/dotconfigs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dot-Configs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Misc
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    FPGA
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            FPGA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fpga/bitstream/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bitstream Explained
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/paper_fpga/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Papers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fpga/language/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Languages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fpga/vivado/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vivado Notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fpga/setup_hold/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup and Hold Time
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fpga/pr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Partial Reconfiguration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    LegoOS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            LegoOS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Log
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Log
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MISC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../test-note/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Script
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kernel
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Kernel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/boot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GRUB2 and Boot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/kconfig/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kconfig
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/debug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/grub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GRUB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/profile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profile
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/profile_strace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profile strace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/profile_heatmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profile heatmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/profile_points/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profile points
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/trampoline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trampoline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/pagefault_disable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disable pgfault
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/stop_machine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stop machine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/loader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Program Loader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/vDSO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vDSO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/vfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtual File System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/vm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Process Virtual Memory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/fpu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    x86 FPU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/irq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IRQ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/net_thpool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Thpool
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Syscall
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Syscall
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../syscall/facts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Facts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/profile_strace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profile strace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../syscall/compat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    compat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../syscall/msync/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    msync()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../syscall/mremap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mremap()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../syscall/fork/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fork()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../syscall/getrusage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    getrusage()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../syscall/wait_and_exit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    wait4 and exit()
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pcache
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Pcache
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/sweep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sweep
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/tlb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TLB Coherence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/pgtable-lock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PageTable Lock
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/victim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Victim Cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/virtual_cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtual Cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/rmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reverse Mapping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/evict_and_ref/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evict and Refcount
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/smp_design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SMP Design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/replication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Replication
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Driver
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Driver
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../driver/pci/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PCI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../driver/ib/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infiniband
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Paper
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Paper
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/nmp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NMP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/processor_oom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Processor OOM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/genz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gen-Z
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/replication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Replication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/related/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Related
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0504-fri" class="md-nav__link">
    <span class="md-ellipsis">
      05/04 Fri
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0429-sun" class="md-nav__link">
    <span class="md-ellipsis">
      04/29 Sun
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0426-thus" class="md-nav__link">
    <span class="md-ellipsis">
      04/26 Thus
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0425" class="md-nav__link">
    <span class="md-ellipsis">
      04/25
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0422-sun" class="md-nav__link">
    <span class="md-ellipsis">
      04/22 Sun
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0421-sat" class="md-nav__link">
    <span class="md-ellipsis">
      04/21 Sat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0420-fri" class="md-nav__link">
    <span class="md-ellipsis">
      04/20 Fri
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0419-thur" class="md-nav__link">
    <span class="md-ellipsis">
      04/19 Thur
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-a-256m-excache-today-0419-w15-4-a-timeout-happen-first-which-will-be-handled-as-segfault-to-kill-all-threads-in-an-eviction-victim_prepare_hits-the-get_memory_nodes-encounter-the-null-again-looks-like-the-thread_group-mm-got-cleared-before" class="md-nav__link">
    <span class="md-ellipsis">
      In a 256M excache today (0419-w15-4), a timeout happen first, which will be handled as segfault to kill all threads. In an eviction-&gt;victim_prepare_hits, the get_memory_nodes() encounter the NULL again. Looks like the thread_group-&gt;mm got cleared before.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0418-wed" class="md-nav__link">
    <span class="md-ellipsis">
      04/18 Wed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0417-tue" class="md-nav__link">
    <span class="md-ellipsis">
      04/17 Tue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0416-mon" class="md-nav__link">
    <span class="md-ellipsis">
      04/16 Mon
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0415-sun" class="md-nav__link">
    <span class="md-ellipsis">
      04/15 Sun
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0414-sat" class="md-nav__link">
    <span class="md-ellipsis">
      04/14 Sat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0413-fri" class="md-nav__link">
    <span class="md-ellipsis">
      04/13 Fri
    </span>
  </a>
  
    <nav class="md-nav" aria-label="04/13 Fri">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ib_mad_recv_done_handler-may-corrupt-memory-again" class="md-nav__link">
    <span class="md-ellipsis">
      ib_mad_recv_done_handler may corrupt memory, again.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patching-the-handlers-to-use-tx-buffer" class="md-nav__link">
    <span class="md-ellipsis">
      Patching the handlers to use tx buffer.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-if-page-table-pages-page-themselves-are-freed-in-munmap-at-both-p-and-m-need-to-confirm" class="md-nav__link">
    <span class="md-ellipsis">
      Check if page table pages, page themselves are freed in munmap, at both P and M. Need to confirm.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tonight-task-think-about-how-to-do-the-vma-replication-how-to-combine-with-the-line-replicaiton" class="md-nav__link">
    <span class="md-ellipsis">
      Tonight task. Think about how to do the VMA replication, how to combine with the $ line replicaiton.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0412-thur" class="md-nav__link">
    <span class="md-ellipsis">
      04/12 Thur
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0411-wed" class="md-nav__link">
    <span class="md-ellipsis">
      04/11 Wed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0410-tue" class="md-nav__link">
    <span class="md-ellipsis">
      04/10 Tue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0409-mon" class="md-nav__link">
    <span class="md-ellipsis">
      04/09 Mon
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0408-sun" class="md-nav__link">
    <span class="md-ellipsis">
      04/08 Sun
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0407-sat" class="md-nav__link">
    <span class="md-ellipsis">
      04/07 Sat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0406-fri" class="md-nav__link">
    <span class="md-ellipsis">
      04/06 Fri
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0405-thur" class="md-nav__link">
    <span class="md-ellipsis">
      04/05 Thur
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0404-wed" class="md-nav__link">
    <span class="md-ellipsis">
      04/04 Wed
    </span>
  </a>
  
    <nav class="md-nav" aria-label="04/04 Wed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#strace-performance" class="md-nav__link">
    <span class="md-ellipsis">
      STRACE Performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sm-heartbeat" class="md-nav__link">
    <span class="md-ellipsis">
      SM Heartbeat
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0403-tue" class="md-nav__link">
    <span class="md-ellipsis">
      04/03 Tue
    </span>
  </a>
  
    <nav class="md-nav" aria-label="04/03 Tue">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bug-bug-bug" class="md-nav__link">
    <span class="md-ellipsis">
      BUG BUG BUG
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BUG BUG BUG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ib_mad_completion_handler" class="md-nav__link">
    <span class="md-ellipsis">
      ib_mad_completion_handler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit_poll_cq" class="md-nav__link">
    <span class="md-ellipsis">
      fit_poll_cq
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ib-spec-qp-cqe-wqe-send" class="md-nav__link">
    <span class="md-ellipsis">
      IB Spec: QP, CQE, WQE, SEND
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0402-mon" class="md-nav__link">
    <span class="md-ellipsis">
      04/02 Mon
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0401-sun" class="md-nav__link">
    <span class="md-ellipsis">
      04/01 Sun
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="april-2018">April 2018<a class="headerlink" href="#april-2018" title="Permanent link">&para;</a></h1>
<h2 id="0504-fri">05/04 Fri<a class="headerlink" href="#0504-fri" title="Permanent link">&para;</a></h2>
<p>We made it. We&rsquo;ve done our part, now, it depends on reviewers. Please, be mercy, our hardworking deserves something good.</p>
<h2 id="0429-sun">04/29 Sun<a class="headerlink" href="#0429-sun" title="Permanent link">&para;</a></h2>
<p>Rolling.</p>
<h2 id="0426-thus">04/26 Thus<a class="headerlink" href="#0426-thus" title="Permanent link">&para;</a></h2>
<p>Fix the victim pte_same issue in SMP race cases. SMP is really pain in the ass, how many times? But&hellip; another victim ref count bug show up in SMP.
First log in 0426-w15-&frac12;</p>
<div class="highlight"><pre><span></span><code><span class="mo">0426</span><span class="o">-</span><span class="n">w15</span><span class="mi">-1</span><span class="o">/</span><span class="mi">3</span>

<span class="p">[</span><span class="w">  </span><span class="mf">206.381646</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID28</span><span class="w">  </span><span class="n">victim</span><span class="o">:</span><span class="n">ffff88207ff69120</span><span class="w"> </span><span class="n">index</span><span class="o">:</span><span class="mi">4</span><span class="w"> </span><span class="n">refcount</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">nr_fill</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">locked</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">:</span><span class="p">(</span><span class="mh">0x2e</span><span class="p">)(</span><span class="n">allocated</span><span class="o">|</span><span class="n">usable</span><span class="o">|</span><span class="n">hasdata</span><span class="o">|</span><span class="n">waitflush</span><span class="p">)</span><span class="w"> </span><span class="n">pcm</span><span class="o">:</span><span class="w">          </span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff72000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.416658</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID28</span><span class="w">     </span><span class="n">hit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">owner</span><span class="o">:</span><span class="mi">21</span><span class="w"> </span><span class="n">m_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">rep_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7fffd0000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.433431</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID28</span><span class="w">  </span><span class="n">victim</span><span class="o">:</span><span class="n">ffff88207ff69120</span><span class="w"> </span><span class="n">index</span><span class="o">:</span><span class="mi">4</span><span class="w"> </span><span class="n">refcount</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">nr_fill</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">locked</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">:</span><span class="p">(</span><span class="mh">0x4e</span><span class="p">)(</span><span class="n">allocated</span><span class="o">|</span><span class="n">usable</span><span class="o">|</span><span class="n">hasdata</span><span class="o">|</span><span class="n">flushed</span><span class="p">)</span><span class="w"> </span><span class="n">pcm</span><span class="o">:</span><span class="w">          </span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff72000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.468429</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID28</span><span class="w">     </span><span class="n">rmap</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff72000</span><span class="w"> </span><span class="n">set_idx</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">nr_lru</span><span class="o">:</span><span class="mi">63</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.484425</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID28</span><span class="w">     </span><span class="n">victim</span><span class="w"> </span><span class="n">dumped</span><span class="w"> </span><span class="n">because</span><span class="o">:</span><span class="w"> </span><span class="n">PCACHE_BUG_ON_VICTIM</span><span class="p">(</span><span class="o">!</span><span class="n">VictimAllocated</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">VictimUsable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">VictimFlushed</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">VictimWriteback</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">VictimLocked</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.543952</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">python</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">274</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.521849</span><span class="p">]</span><span class="w"> </span><span class="n">WARNING</span><span class="o">:</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">managers</span><span class="o">/</span><span class="n">processor</span><span class="o">/</span><span class="n">pcache</span><span class="o">/</span><span class="n">victim</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">196</span><span class="w"> </span><span class="n">__put_victim_nolist</span><span class="o">+</span><span class="mh">0xa5</span><span class="o">/</span><span class="mh">0xd0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.722631</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103b555</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">__put_victim_nolist</span><span class="o">+</span><span class="mh">0xa5</span><span class="o">/</span><span class="mh">0xd0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.729127</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103c419</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">victim_try_fill_pcache</span><span class="o">+</span><span class="mh">0x2d9</span><span class="o">/</span><span class="mh">0x460</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.736107</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103b740</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">victim_insert_hit_entry</span><span class="o">+</span><span class="mh">0x170</span><span class="o">/</span><span class="mh">0x170</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.743378</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810371ea</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">pcache_handle_fault</span><span class="o">+</span><span class="mh">0x18a</span><span class="o">/</span><span class="mh">0x750</span>

<span class="p">[</span><span class="w">  </span><span class="mf">206.399206</span><span class="p">]</span><span class="w"> </span><span class="n">CPU8</span><span class="w"> </span><span class="n">PID19</span><span class="w">  </span><span class="n">victim</span><span class="o">:</span><span class="n">ffff88207ff69120</span><span class="w"> </span><span class="n">index</span><span class="o">:</span><span class="mi">4</span><span class="w"> </span><span class="n">refcount</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">nr_fill</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">locked</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">:</span><span class="p">(</span><span class="mh">0x4e</span><span class="p">)(</span><span class="n">allocated</span><span class="o">|</span><span class="n">usable</span><span class="o">|</span><span class="n">hasdata</span><span class="o">|</span><span class="n">flushed</span><span class="p">)</span><span class="w"> </span><span class="n">pcm</span><span class="o">:</span><span class="w">          </span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff72000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.425092</span><span class="p">]</span><span class="w"> </span><span class="n">CPU8</span><span class="w"> </span><span class="n">PID19</span><span class="w">     </span><span class="n">hit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">owner</span><span class="o">:</span><span class="mi">21</span><span class="w"> </span><span class="n">m_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">rep_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7fffd0000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.450977</span><span class="p">]</span><span class="w"> </span><span class="n">CPU8</span><span class="w"> </span><span class="n">PID19</span><span class="w">  </span><span class="n">victim</span><span class="o">:</span><span class="n">ffff88207ff69120</span><span class="w"> </span><span class="n">index</span><span class="o">:</span><span class="mi">4</span><span class="w"> </span><span class="n">refcount</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">nr_fill</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">locked</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">:</span><span class="p">(</span><span class="mh">0x4e</span><span class="p">)(</span><span class="n">allocated</span><span class="o">|</span><span class="n">usable</span><span class="o">|</span><span class="n">hasdata</span><span class="o">|</span><span class="n">flushed</span><span class="p">)</span><span class="w"> </span><span class="n">pcm</span><span class="o">:</span><span class="w">          </span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff72000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.476475</span><span class="p">]</span><span class="w"> </span><span class="n">CPU8</span><span class="w"> </span><span class="n">PID19</span><span class="w">     </span><span class="n">rmap</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff72000</span><span class="w"> </span><span class="n">set_idx</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">nr_lru</span><span class="o">:</span><span class="mi">63</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.501779</span><span class="p">]</span><span class="w"> </span><span class="n">CPU8</span><span class="w"> </span><span class="n">PID19</span><span class="w">     </span><span class="n">victim</span><span class="w"> </span><span class="n">dumped</span><span class="w"> </span><span class="n">because</span><span class="o">:</span><span class="w"> </span><span class="n">PCACHE_BUG_ON_VICTIM</span><span class="p">(</span><span class="n">victim_ref_count</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.549963</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">kvictim_flushd</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">274</span>
<span class="p">[</span><span class="w">  </span><span class="mf">206.532803</span><span class="p">]</span><span class="w"> </span><span class="n">WARNING</span><span class="o">:</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">processor</span><span class="o">/</span><span class="n">pcache_victim</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">119</span><span class="w"> </span><span class="n">__victim_flush_func</span><span class="o">+</span><span class="mh">0x1e4</span><span class="o">/</span><span class="mh">0x1f0</span>
</code></pre></div>
<h2 id="0425">04/25<a class="headerlink" href="#0425" title="Permanent link">&para;</a></h2>
<p>Stay humble. Be real.</p>
<h2 id="0422-sun">04/22 Sun<a class="headerlink" href="#0422-sun" title="Permanent link">&para;</a></h2>
<p>Testing. Hardworking!</p>
<h2 id="0421-sat">04/21 Sat<a class="headerlink" href="#0421-sat" title="Permanent link">&para;</a></h2>
<p>Another major bug report in 0421-w15-19. Rmapped corrupted. lock issue?</p>
<p>Fixed. It is handle_m2m_fork bug.
<div class="highlight"><pre><span></span><code><span class="n">pcache_miss_error</span><span class="o">+</span><span class="mh">0x20</span>
</code></pre></div></p>
<p>Keep it going.</p>
<p>I can not remember how many times I have seen this bug issue. And I have no idea.
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">714.144354</span><span class="p">]</span><span class="w"> </span><span class="n">IP</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffffffff8100</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="mh">0xffffffffffff8100</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.150171</span><span class="p">]</span><span class="w"> </span><span class="n">PGD</span><span class="w"> </span><span class="mi">115</span><span class="n">c067</span><span class="w"> </span><span class="n">PUD</span><span class="w"> </span><span class="mf">115e067</span><span class="w"> </span><span class="n">PMD</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.154729</span><span class="p">]</span><span class="w"> </span><span class="n">Oops</span><span class="o">:</span><span class="w"> </span><span class="mo">0010</span><span class="w"> </span><span class="p">[</span><span class="err">#</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">SMP</span><span class="w"> </span><span class="n">PROCESSOR</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.159189</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">ib_mad_completi</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">245</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.165976</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="n">paging</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">ffffffffffff8100</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.173732</span><span class="p">]</span><span class="w"> </span><span class="n">IP</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffffffff8100</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="mh">0xffffffffffff8100</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.179549</span><span class="p">]</span><span class="w"> </span><span class="n">PGD</span><span class="w"> </span><span class="mi">115</span><span class="n">c067</span><span class="w"> </span><span class="n">PUD</span><span class="w"> </span><span class="mf">115e067</span><span class="w"> </span><span class="n">PMD</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.184106</span><span class="p">]</span><span class="w"> </span><span class="n">RIP</span><span class="o">:</span><span class="w"> </span><span class="mo">0010</span><span class="o">:</span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffffffff8100</span><span class="o">&gt;</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffffffff8100</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="mh">0xffffffffffff8100</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.192638</span><span class="p">]</span><span class="w"> </span><span class="n">RSP</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="o">:</span><span class="n">ffff88103e88fc80</span><span class="w">  </span><span class="n">EFLAGS</span><span class="o">:</span><span class="w"> </span><span class="mo">00010046</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.198552</span><span class="p">]</span><span class="w"> </span><span class="n">RAX</span><span class="o">:</span><span class="w"> </span><span class="mf">6e82000000000098</span><span class="w"> </span><span class="n">RBX</span><span class="o">:</span><span class="w"> </span><span class="mi">7</span><span class="n">b0bffffffffffff</span><span class="w"> </span><span class="n">RCX</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000001</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.206503</span><span class="p">]</span><span class="w"> </span><span class="n">RDX</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103e88fd28</span><span class="w"> </span><span class="n">RSI</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">RDI</span><span class="o">:</span><span class="w"> </span><span class="mi">44</span><span class="n">c0ffffffff8116</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.214453</span><span class="p">]</span><span class="w"> </span><span class="n">RBP</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103e88fcd0</span><span class="w"> </span><span class="n">R08</span><span class="o">:</span><span class="w"> </span><span class="mf">000000000000001f</span><span class="w"> </span><span class="n">R09</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103e8643c0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.222403</span><span class="p">]</span><span class="w"> </span><span class="n">R10</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103e88fe68</span><span class="w"> </span><span class="n">R11</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000001</span><span class="w"> </span><span class="n">R12</span><span class="o">:</span><span class="w"> </span><span class="n">a9670000018d71ba</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.230354</span><span class="p">]</span><span class="w"> </span><span class="n">R13</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">R14</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103e85d0f8</span><span class="w"> </span><span class="n">R15</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103dd58000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.238304</span><span class="p">]</span><span class="w"> </span><span class="n">Oops</span><span class="o">:</span><span class="w"> </span><span class="mo">0010</span><span class="w"> </span><span class="p">[</span><span class="err">#</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="n">SMP</span><span class="w"> </span><span class="n">PROCESSOR</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.242763</span><span class="p">]</span><span class="w"> </span><span class="n">FS</span><span class="o">:</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span><span class="w"> </span><span class="n">GS</span><span class="o">:</span><span class="n">ffff88107fc00000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span><span class="w"> </span><span class="n">knlGS</span><span class="o">:</span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.251781</span><span class="p">]</span><span class="w"> </span><span class="n">CS</span><span class="o">:</span><span class="w">  </span><span class="mo">0010</span><span class="w"> </span><span class="n">DS</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="n">ES</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="n">CR0</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000</span><span class="mi">80050033</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.258180</span><span class="p">]</span><span class="w"> </span><span class="n">CR2</span><span class="o">:</span><span class="w"> </span><span class="n">ffffffffffff8100</span><span class="w"> </span><span class="n">CR3</span><span class="o">:</span><span class="w"> </span><span class="mo">000000000115</span><span class="mi">9000</span><span class="w"> </span><span class="n">CR4</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000000406</span><span class="n">b0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.266130</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">python</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">245</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.272141</span><span class="p">]</span><span class="w"> </span><span class="n">RIP</span><span class="o">:</span><span class="w"> </span><span class="mo">0010</span><span class="o">:</span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffffffff8100</span><span class="o">&gt;</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffffffff8100</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="mh">0xffffffffffff8100</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.280673</span><span class="p">]</span><span class="w"> </span><span class="n">RSP</span><span class="o">:</span><span class="w"> </span><span class="mo">001</span><span class="mi">8</span><span class="o">:</span><span class="n">ffff88103dd8fe10</span><span class="w">  </span><span class="n">EFLAGS</span><span class="o">:</span><span class="w"> </span><span class="mo">00010202</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.286588</span><span class="p">]</span><span class="w"> </span><span class="n">RAX</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88101fa54270</span><span class="w"> </span><span class="n">RBX</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000000</span><span class="n">c92a6</span><span class="w"> </span><span class="n">RCX</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000002</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.294538</span><span class="p">]</span><span class="w"> </span><span class="n">RDX</span><span class="o">:</span><span class="w"> </span><span class="mf">00000000f</span><span class="n">fffffff</span><span class="w"> </span><span class="n">RSI</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">RDI</span><span class="o">:</span><span class="w"> </span><span class="mi">44</span><span class="n">c0ffffffff8116</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.302488</span><span class="p">]</span><span class="w"> </span><span class="n">RBP</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103dd8fe20</span><span class="w"> </span><span class="n">R08</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88101fa6f000</span><span class="w"> </span><span class="n">R09</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88101fa54400</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.310439</span><span class="p">]</span><span class="w"> </span><span class="n">R10</span><span class="o">:</span><span class="w"> </span><span class="n">ffff880000000000</span><span class="w"> </span><span class="n">R11</span><span class="o">:</span><span class="w"> </span><span class="mf">00000000407e9</span><span class="n">c00</span><span class="w"> </span><span class="n">R12</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88101fa54000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.318389</span><span class="p">]</span><span class="w"> </span><span class="n">R13</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103dd68000</span><span class="w"> </span><span class="n">R14</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88101fa60000</span><span class="w"> </span><span class="n">R15</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88101fa54000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.326339</span><span class="p">]</span><span class="w"> </span><span class="n">Stack</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.328569</span><span class="p">]</span><span class="w"> </span><span class="n">FS</span><span class="o">:</span><span class="w">  </span><span class="mf">00007f</span><span class="n">fff7fdf740</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span><span class="w"> </span><span class="n">GS</span><span class="o">:</span><span class="n">ffff88107fca0000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span><span class="w"> </span><span class="n">knlGS</span><span class="o">:</span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.337585</span><span class="p">]</span><span class="w"> </span><span class="n">CS</span><span class="o">:</span><span class="w">  </span><span class="mo">0010</span><span class="w"> </span><span class="n">DS</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="n">ES</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="n">CR0</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000</span><span class="mi">80050033</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.343984</span><span class="p">]</span><span class="w"> </span><span class="n">CR2</span><span class="o">:</span><span class="w"> </span><span class="n">ffffffffffff8100</span><span class="w"> </span><span class="n">CR3</span><span class="o">:</span><span class="w"> </span><span class="mo">000000103</span><span class="n">dd9a000</span><span class="w"> </span><span class="n">CR4</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000000406</span><span class="n">a0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.351936</span><span class="p">]</span><span class="w"> </span><span class="n">Stack</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.354165</span><span class="p">]</span><span class="w"> </span><span class="n">ffffffff810157f9</span><span class="w"> </span><span class="mo">00000000003</span><span class="n">d0f00</span><span class="w"> </span><span class="n">ffff88103dd8fec0</span><span class="w"> </span><span class="n">ffffffff8101dde5</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.362309</span><span class="p">]</span><span class="w"> </span><span class="n">ffff88103dd8fe68</span><span class="w"> </span><span class="n">ffffffff81036788</span><span class="w"> </span><span class="mo">000000000000003</span><span class="mi">8</span><span class="w"> </span><span class="mo">000000000000003</span><span class="mi">8</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.370453</span><span class="p">]</span><span class="w"> </span><span class="mf">00007f</span><span class="n">ffd89a79c0</span><span class="w"> </span><span class="n">ffff88101fa541c0</span><span class="w"> </span><span class="n">ffff88101fa54188</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.378598</span><span class="p">]</span><span class="w"> </span><span class="mf">000000101f</span><span class="n">a60000</span><span class="w"> </span><span class="mf">00007f</span><span class="n">ffd89a79d0</span><span class="w"> </span><span class="mf">00007f</span><span class="n">ffd89a7700</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.386742</span><span class="p">]</span><span class="w"> </span><span class="mf">00007f</span><span class="n">ffd89a6fb0</span><span class="w"> </span><span class="n">ffff88103dd8ff58</span><span class="w"> </span><span class="mo">000000000000003</span><span class="mi">8</span><span class="w"> </span><span class="mo">00000000003</span><span class="n">d0f00</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.394886</span><span class="p">]</span><span class="w"> </span><span class="n">Call</span><span class="w"> </span><span class="n">Trace</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.397600</span><span class="p">]</span><span class="w"> </span><span class="n">ffffffff81014f37</span><span class="w"> </span><span class="mo">00000000000000</span><span class="mi">86</span><span class="w"> </span><span class="n">ffff88107fc05d80</span><span class="w"> </span><span class="n">ffff88103e864000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.405745</span><span class="p">]</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">ffff88107fc04980</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.413889</span><span class="p">]</span><span class="w"> </span><span class="n">ffff88103e85d0f8</span><span class="w"> </span><span class="n">ffff88103dd58000</span><span class="w"> </span><span class="n">ffff88103e88fce8</span><span class="w"> </span><span class="n">ffffffff81016bb7</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.422034</span><span class="p">]</span><span class="w"> </span><span class="mf">000000007f</span><span class="n">c05d80</span><span class="w"> </span><span class="n">ffff88103e88fd10</span><span class="w"> </span><span class="n">ffffffff81006754</span><span class="w"> </span><span class="n">ffffffffffff0000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.430177</span><span class="p">]</span><span class="w"> </span><span class="n">ffff88107fc05d80</span><span class="w"> </span><span class="n">ffff88103e864000</span><span class="w"> </span><span class="n">ffff88103e88fe00</span><span class="w"> </span><span class="n">ffffffff8100e4ea</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.438321</span><span class="p">]</span><span class="w"> </span><span class="n">Call</span><span class="w"> </span><span class="n">Trace</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.441037</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.443169</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810157f9</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ktime_get</span><span class="o">+</span><span class="mh">0x19</span><span class="o">/</span><span class="mh">0x60</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.448890</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101dde5</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">copy_process</span><span class="o">+</span><span class="mh">0x2c5</span><span class="o">/</span><span class="mh">0x1170</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.454998</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81036788</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">strace_printflags</span><span class="o">+</span><span class="mh">0x88</span><span class="o">/</span><span class="mh">0xc0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.461495</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.463627</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81014f37</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">update_wall_time</span><span class="o">+</span><span class="mh">0x47</span><span class="o">/</span><span class="mh">0x6b0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.470123</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81016bb7</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">tick_handle_periodic</span><span class="o">+</span><span class="mh">0x67</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.476716</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81006754</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">apic_timer_interrupt</span><span class="o">+</span><span class="mh">0x55</span><span class="o">/</span><span class="mh">0x90</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.483309</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101ecb6</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">do_fork</span><span class="o">+</span><span class="mh">0x26</span><span class="o">/</span><span class="mh">0x160</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.488738</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101eea9</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">sys_clone</span><span class="o">+</span><span class="mh">0x29</span><span class="o">/</span><span class="mh">0x30</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.494265</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e8ad</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">do_syscall_64</span><span class="o">+</span><span class="mh">0x3d</span><span class="o">/</span><span class="mh">0xd0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.500180</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100d7ac</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">entry_SYSCALL64_slow_path</span><span class="o">+</span><span class="mh">0x25</span><span class="o">/</span><span class="mh">0x25</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.507257</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e4ea</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">smp__apic_timer_interrupt</span><span class="o">+</span><span class="mh">0x6a</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.514335</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">EOT</span><span class="o">&gt;</span>
</code></pre></div></p>
<h2 id="0420-fri">04/20 Fri<a class="headerlink" href="#0420-fri" title="Permanent link">&para;</a></h2>
<p>Glad TF finally working now!</p>
<p>Keep seeing this message from kernel. It have been many many times. Very deterministic.
<div class="highlight"><pre><span></span><code><span class="nl">BUG</span><span class="p">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="n">paging</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">ffffffffffff8100</span>
</code></pre></div></p>
<h2 id="0419-thur">04/19 Thur<a class="headerlink" href="#0419-thur" title="Permanent link">&para;</a></h2>
<ul>
<li>Patched clflush to use tgid, n_nid directly without task_struct.</li>
<li>
<h2 id="in-a-256m-excache-today-0419-w15-4-a-timeout-happen-first-which-will-be-handled-as-segfault-to-kill-all-threads-in-an-eviction-victim_prepare_hits-the-get_memory_nodes-encounter-the-null-again-looks-like-the-thread_group-mm-got-cleared-before">In a 256M excache today (0419-w15-4), a timeout happen first, which will be handled as segfault to kill all threads. In an eviction-&gt;victim_prepare_hits, the get_memory_nodes() encounter the NULL again. Looks like the thread_group-&gt;mm got cleared before.<a class="headerlink" href="#in-a-256m-excache-today-0419-w15-4-a-timeout-happen-first-which-will-be-handled-as-segfault-to-kill-all-threads-in-an-eviction-victim_prepare_hits-the-get_memory_nodes-encounter-the-null-again-looks-like-the-thread_group-mm-got-cleared-before" title="Permanent link">&para;</a></h2>
</li>
</ul>
<h2 id="0418-wed">04/18 Wed<a class="headerlink" href="#0418-wed" title="Permanent link">&para;</a></h2>
<ul>
<li>Try best to fix the pipe bug. (I found it by using my old way of debugging. By writing a function that test if PTE is corrupted or not. I put that function around the sycall enter/exit. So it help to find which syscall corrupt memory. I have used this stupid technique to find so many hard-to-find memory corruption bugs.....)<ul>
<li>do_close_on_exec</li>
<li>dup2</li>
</ul>
</li>
<li>
<p>Re-read Yutong&rsquo;s patch again. It touches a lot handler code. This has to be verified before using any nowait reply.</p>
</li>
<li>
<p>pipe&rsquo;s wakeup may have issue?</p>
</li>
<li>
<p>0418-w15-41. 39sec</p>
</li>
</ul>
<h2 id="0417-tue">04/17 Tue<a class="headerlink" href="#0417-tue" title="Permanent link">&para;</a></h2>
<p>Checking list:</p>
<ol>
<li><del class="critic">-pcache: ibapi use va or pa, does it matter?-</del><ul>
<li>No, I change it to use the VA. Then we don&rsquo;t have the need to use PA reply any more.</li>
</ul>
</li>
<li><mark class="critic">=ib_mad, does it really corrupt Memory=</mark><ul>
<li>Still not sure. Should be something come from the <code>ib_poll_cq</code>.</li>
</ul>
</li>
<li>M side per PTE lock, check if the lock is really the same lock!</li>
<li><del class="critic">-Mail I20. Check CPT.-</del></li>
<li>Dist-VMA<ul>
<li>First make sure, TF+no-dist-vma work on my own setting. Though sometimes random bug happen (I doubt it is IB).</li>
<li>Then turn on dist-vma<ul>
<li>w/wo zerofill</li>
<li>w/wo kfree</li>
<li>w/wo all-zero Debug.</li>
<li>w/wo M side per PTE lock</li>
</ul>
</li>
</ul>
</li>
<li>Change most handlers to use TX buffer. Reduce the random mismatched reply case.</li>
<li>P side watchdog patch: what to print</li>
<li>
<p><del class="critic">-It looks like it is more easier to have bug when I turn on those debug counter printing. I probably should check those buffer mgmt. All next test have zerofill:-</del></p>
<ul>
<li>w  print<ul>
<li>F 0417-w15-2(rmap_walk list_for_each_entrry #GP)</li>
<li>F 0417-w15-3(pcache_copy_page_range corrupted PTE)</li>
<li>F 0417-w15-4(fit_poll_cq+0x39 ib_poll_cq() &hellip;)</li>
<li>F 0417-w15-5(pcache_copy_page_range corrupted PTE)</li>
</ul>
</li>
<li>wo strace exit:<ul>
<li>S 0417-w15-6(each 100 step take ~39s/ Linux is ~34s)</li>
<li>S 0417-w15-7(filling shuffle data, that works)</li>
<li>F 0417-w15-8(pcache_copy_page_range+0x5d1)</li>
<li>F 0417-w15-9(rmap_walk+0x47 #GP)</li>
</ul>
</li>
<li>disable strace:<ul>
<li>F 0417-w15-10(pcache_copy_page_range+0x5d1)</li>
</ul>
</li>
<li>Conclusion<ul>
<li>it has nothing to do with the strace thing.</li>
<li>most of them fail around <code>nr_reqs=19103</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Why the pcache_copy_page_range always happen, after some fork, execve.</p>
<ul>
<li>w strace (fork, vfork, clone, execve)<ul>
<li>F 0417-w15-11 (pcache_cp_pg_range). Understand its flow. Back to make sure P side per PTE lock is correct. If it is pcache_cp fault, it always fail at <code>nr_reqs=19103</code>. And it is: 1) python fork, 2) execve sh.</li>
<li>S 0417-w15-12. With global PTE lock. Passed the failed stage above.</li>
<li>F 0417-W15-13. With global PTE lock. Failed at pcache_cp. Same place. (Since global PTE lock also fail, so it is not the lock issue. Still someone write to wrong memory.)</li>
<li>F 0417-w15-14. With global PTE lock. Same place. Found that I printed a misleading debug info. Modified a little bit to print the actual pte content. Hope can get some valid info next round.</li>
<li>F 0417-w15-15. Same place. <code>copy: addr: 0x7fffdca07000, ptecont: 0x8800000000000</code>. <code>zap: ptent: 0x340 address: 0x7fffdca08000</code>.</li>
<li>F 0417-w15-16. Well. BUG in ib_mad_send handler. I add the same checking in ib_mad_receive. This is really just used to catch it. Not fixing it.</li>
<li>F 0417-w15-17. Again, <code>addr: 0x7fffdc207000, ptecont: 0x8800000000000</code></li>
<li>F 0417-w15-18. <code>addr: 0x7fffdca07000, ptecont: 0x8800000000000</code></li>
</ul>
</li>
<li>Conclusion<ul>
<li>Only these two addresses</li>
<li>addr: 0x7fffdca07000, ptecont: 0x8800000000000</li>
<li>pte:ffff88103ea87038 (0x8800000000000) pfn:0x0 flags:(0x8800000000000)</li>
<li>addr: 0x7fffdc207000, ptecont: 0x8800000000000</li>
<li>pte:ffff88103ea97038 (0x8800000000000) pfn:0x0 flags:(0x8800000000000)</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Bug found. In pipe_read/write. It somehow corrupted memory. Damn.</p>
</li>
<li>
<p><del class="critic">-Another first thing, check this weird log.. :
Hmm, this log should be fine. mad_post is after recv_done_handler. So even if we detect corrupted memory in handler, it has nothing to do with mad_post. The root cause should come from ib_poll_cq, that is where we pass wc to, and where the wc.wr_id was filled in.-</del>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w"> </span><span class="mf">3850.911144</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_recv_done_handler</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">c1</span><span class="o">:</span><span class="w"> </span><span class="mi">2060</span><span class="w"> </span><span class="n">c2</span><span class="o">:</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="n">wc</span><span class="o">-&gt;</span><span class="n">wr_id</span><span class="o">:</span><span class="w"> </span><span class="mh">0xffff88103eea1398</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3850.921881</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_post_receive_mads</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">c1</span><span class="o">:</span><span class="w"> </span><span class="mi">2060</span><span class="w"> </span><span class="n">c2</span><span class="o">:</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="n">recv_wr</span><span class="p">.</span><span class="n">wr_id</span><span class="o">:</span><span class="w"> </span><span class="mh">0xffff88103eea1008</span><span class="w"> </span><span class="n">recv_queue</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103ee42520</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3850.933620</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2377</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">13</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3850.942346</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2383</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">14</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3850.951266</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_recv_done_handler</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">c1</span><span class="o">:</span><span class="w"> </span><span class="mi">2061</span><span class="w"> </span><span class="n">c2</span><span class="o">:</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="n">wc</span><span class="o">-&gt;</span><span class="n">wr_id</span><span class="o">:</span><span class="w"> </span><span class="mh">0xffff88103eea1560</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3850.961999</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_post_receive_mads</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">c1</span><span class="o">:</span><span class="w"> </span><span class="mi">2061</span><span class="w"> </span><span class="n">c2</span><span class="o">:</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">recv_wr</span><span class="p">.</span><span class="n">wr_id</span><span class="o">:</span><span class="w"> </span><span class="mh">0xffff88103eea11d0</span><span class="w"> </span><span class="n">recv_queue</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103ee42520</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3850.973737</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2377</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">14</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.257563</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2383</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">15</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.266295</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_recv_done_handler</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">c1</span><span class="o">:</span><span class="w"> </span><span class="mi">2062</span><span class="w"> </span><span class="n">c2</span><span class="o">:</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">wc</span><span class="o">-&gt;</span><span class="n">wr_id</span><span class="o">:</span><span class="w"> </span><span class="mh">0xffff88103eea1728</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.277029</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_post_receive_mads</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">c1</span><span class="o">:</span><span class="w"> </span><span class="mi">2062</span><span class="w"> </span><span class="n">c2</span><span class="o">:</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="n">recv_wr</span><span class="p">.</span><span class="n">wr_id</span><span class="o">:</span><span class="w"> </span><span class="mh">0xffff88103eea1398</span><span class="w"> </span><span class="n">recv_queue</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103ee42520</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.288767</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2377</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">15</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.297493</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2383</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">16</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.306413</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_recv_done_handler</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">c1</span><span class="o">:</span><span class="w"> </span><span class="mi">2063</span><span class="w"> </span><span class="n">c2</span><span class="o">:</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="n">wc</span><span class="o">-&gt;</span><span class="n">wr_id</span><span class="o">:</span><span class="w"> </span><span class="mh">0xffff88103eea18f0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.317147</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_post_receive_mads</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">c1</span><span class="o">:</span><span class="w"> </span><span class="mi">2063</span><span class="w"> </span><span class="n">c2</span><span class="o">:</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="n">recv_wr</span><span class="p">.</span><span class="n">wr_id</span><span class="o">:</span><span class="w"> </span><span class="mh">0xffff88103eea1560</span><span class="w"> </span><span class="n">recv_queue</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103ee42520</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.328886</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2377</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">16</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.903180</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2383</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">17</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.911913</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_recv_done_handler</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">c1</span><span class="o">:</span><span class="w"> </span><span class="mi">2064</span><span class="w"> </span><span class="n">c2</span><span class="o">:</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="n">wc</span><span class="o">-&gt;</span><span class="n">wr_id</span><span class="o">:</span><span class="w"> </span><span class="mh">0xffff88103eea1ab8</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.922646</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_post_receive_mads</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">c1</span><span class="o">:</span><span class="w"> </span><span class="mi">2064</span><span class="w"> </span><span class="n">c2</span><span class="o">:</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="n">recv_wr</span><span class="p">.</span><span class="n">wr_id</span><span class="o">:</span><span class="w"> </span><span class="mh">0xffff88103eea1728</span><span class="w"> </span><span class="n">recv_queue</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103ee42520</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.934384</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2377</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">17</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.943110</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2383</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">18</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.952030</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_recv_done_handler</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">c1</span><span class="o">:</span><span class="w"> </span><span class="mi">2065</span><span class="w"> </span><span class="n">c2</span><span class="o">:</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="n">wc</span><span class="o">-&gt;</span><span class="n">wr_id</span><span class="o">:</span><span class="w"> </span><span class="mh">0xffff88103eea1c80</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.962764</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_post_receive_mads</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">c1</span><span class="o">:</span><span class="w"> </span><span class="mi">2065</span><span class="w"> </span><span class="n">c2</span><span class="o">:</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="n">recv_wr</span><span class="p">.</span><span class="n">wr_id</span><span class="o">:</span><span class="w"> </span><span class="mh">0xffff88103eea18f0</span><span class="w"> </span><span class="n">recv_queue</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103ee42520</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3851.974502</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2377</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">18</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3864.723128</span><span class="p">]</span><span class="w"> </span><span class="o">***</span><span class="w">  </span><span class="n">FIT</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="n">ready</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">go</span><span class="o">!</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3864.727206</span><span class="p">]</span><span class="w"> </span><span class="o">***</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.339488</span><span class="p">]</span><span class="w"> </span><span class="n">Processor</span><span class="w"> </span><span class="n">LLC</span><span class="w"> </span><span class="n">Configurations</span><span class="o">:</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.343760</span><span class="p">]</span><span class="w">     </span><span class="n">PhysStart</span><span class="o">:</span><span class="w">         </span><span class="mh">0x100000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.348705</span><span class="p">]</span><span class="w">     </span><span class="n">VirtStart</span><span class="o">:</span><span class="w">         </span><span class="mh">0xffff880100000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.354329</span><span class="p">]</span><span class="w">     </span><span class="n">Registered</span><span class="w"> </span><span class="n">Size</span><span class="o">:</span><span class="w">   </span><span class="mh">0x400000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.359274</span><span class="p">]</span><span class="w">     </span><span class="n">Actual</span><span class="w"> </span><span class="n">Used</span><span class="w"> </span><span class="n">Size</span><span class="o">:</span><span class="w">  </span><span class="mh">0x208000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.364219</span><span class="p">]</span><span class="w">     </span><span class="n">NR</span><span class="w"> </span><span class="n">cachelines</span><span class="o">:</span><span class="w">     </span><span class="mi">2097152</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.368776</span><span class="p">]</span><span class="w">     </span><span class="n">Associativity</span><span class="o">:</span><span class="w">     </span><span class="mi">8</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.372751</span><span class="p">]</span><span class="w">     </span><span class="n">NR</span><span class="w"> </span><span class="n">Sets</span><span class="o">:</span><span class="w">           </span><span class="mi">262144</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.377210</span><span class="p">]</span><span class="w">     </span><span class="n">Cacheline</span><span class="w"> </span><span class="n">size</span><span class="o">:</span><span class="w">    </span><span class="mi">4096</span><span class="w"> </span><span class="n">B</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.381672</span><span class="p">]</span><span class="w">     </span><span class="n">Metadata</span><span class="w"> </span><span class="n">size</span><span class="o">:</span><span class="w">     </span><span class="mi">64</span><span class="w"> </span><span class="n">B</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.385937</span><span class="p">]</span><span class="w">     </span><span class="n">NR</span><span class="w"> </span><span class="n">cacheline</span><span class="w"> </span><span class="n">bits</span><span class="o">:</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">11</span><span class="p">]</span><span class="w"> </span><span class="mh">0x0000000000000fff</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.392821</span><span class="p">]</span><span class="w">     </span><span class="n">NR</span><span class="w"> </span><span class="n">set</span><span class="o">-</span><span class="n">index</span><span class="w"> </span><span class="n">bits</span><span class="o">:</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="p">[</span><span class="mi">12</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">29</span><span class="p">]</span><span class="w"> </span><span class="mh">0x000000003ffff000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.399705</span><span class="p">]</span><span class="w">     </span><span class="n">NR</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">bits</span><span class="o">:</span><span class="w">       </span><span class="mi">34</span><span class="w"> </span><span class="p">[</span><span class="mi">30</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">63</span><span class="p">]</span><span class="w"> </span><span class="mh">0xffffffffc0000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.406588</span><span class="p">]</span><span class="w">     </span><span class="n">NR</span><span class="w"> </span><span class="n">pages</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">data</span><span class="o">:</span><span class="w"> </span><span class="mi">2097152</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.411147</span><span class="p">]</span><span class="w">     </span><span class="n">NR</span><span class="w"> </span><span class="n">pages</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">meta</span><span class="o">:</span><span class="w"> </span><span class="mi">32768</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.415509</span><span class="p">]</span><span class="w">     </span><span class="n">Cacheline</span><span class="w"> </span><span class="p">(</span><span class="n">pa</span><span class="p">)</span><span class="w"> </span><span class="n">range</span><span class="o">:</span><span class="w">   </span><span class="p">[</span><span class="w">       </span><span class="mh">0x100000000</span><span class="w"> </span><span class="o">-</span><span class="w">        </span><span class="mh">0x2ffffffff</span><span class="p">]</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.423848</span><span class="p">]</span><span class="w">     </span><span class="n">Metadata</span><span class="w"> </span><span class="p">(</span><span class="n">pa</span><span class="p">)</span><span class="w"> </span><span class="n">range</span><span class="o">:</span><span class="w">    </span><span class="p">[</span><span class="w">       </span><span class="mh">0x300000000</span><span class="w"> </span><span class="o">-</span><span class="w">        </span><span class="mh">0x307ffffff</span><span class="p">]</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.432186</span><span class="p">]</span><span class="w">     </span><span class="n">Cacheline</span><span class="w"> </span><span class="p">(</span><span class="n">va</span><span class="p">)</span><span class="w"> </span><span class="n">range</span><span class="o">:</span><span class="w">   </span><span class="p">[</span><span class="mh">0xffff880100000000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0xffff8802ffffffff</span><span class="p">]</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.440524</span><span class="p">]</span><span class="w">     </span><span class="n">Metadata</span><span class="w"> </span><span class="p">(</span><span class="n">va</span><span class="p">)</span><span class="w"> </span><span class="n">range</span><span class="o">:</span><span class="w">    </span><span class="p">[</span><span class="w">  </span><span class="n">ffff880300000000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0xffff880307ffffff</span><span class="p">]</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.448862</span><span class="p">]</span><span class="w">     </span><span class="n">pcache_set_map</span><span class="p">(</span><span class="mo">064</span><span class="n">B</span><span class="p">)</span><span class="o">:</span><span class="w">   </span><span class="p">[</span><span class="w">  </span><span class="n">ffff88207ec00000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0xffff88207fbfffff</span><span class="p">]</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.457201</span><span class="p">]</span><span class="w">     </span><span class="n">Way</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="n">stride</span><span class="o">:</span><span class="w">  </span><span class="mh">0x40000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.462048</span><span class="p">]</span><span class="w">     </span><span class="n">Memmap</span><span class="w"> </span><span class="n">$</span><span class="w"> </span><span class="n">semantic</span><span class="o">:</span><span class="w">       </span><span class="n">memblock</span><span class="w"> </span><span class="n">reserved</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.468156</span><span class="p">]</span><span class="w">     </span><span class="n">NR</span><span class="w"> </span><span class="n">victim</span><span class="w"> </span><span class="n">$</span><span class="w"> </span><span class="n">entries</span><span class="o">:</span><span class="w">     </span><span class="mi">8</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.472725</span><span class="p">]</span><span class="w"> </span><span class="n">newpid</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">home</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">replica</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.476980</span><span class="p">]</span><span class="w"> </span><span class="n">p2m_fork</span><span class="p">(</span><span class="n">cpu0</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">cur</span><span class="o">:</span><span class="mi">1</span><span class="o">-</span><span class="n">kernel_init</span><span class="w"> </span><span class="n">new</span><span class="o">:</span><span class="mi">20</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.482718</span><span class="p">]</span><span class="w"> </span><span class="n">p2m_fork</span><span class="p">(</span><span class="n">cpu0</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">O</span><span class="w"> </span><span class="n">succeed</span><span class="w"> </span><span class="n">cur</span><span class="o">:</span><span class="mi">1</span><span class="o">-</span><span class="n">kernel_init</span><span class="w"> </span><span class="n">new</span><span class="o">:</span><span class="mi">20</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.489197</span><span class="p">]</span><span class="w"> </span><span class="n">Processor</span><span class="o">:</span><span class="w"> </span><span class="n">Processor</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">running</span><span class="p">.</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.494724</span><span class="p">]</span><span class="w"> </span><span class="n">Online</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">22</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.500444</span><span class="p">]</span><span class="w"> </span><span class="n">Active</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">22</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.505777</span><span class="p">]</span><span class="w">   </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">Thread</span><span class="p">[</span><span class="n">kvictim_flushd</span><span class="o">:</span><span class="mi">19</span><span class="p">]</span><span class="w"> </span><span class="n">pinned</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="mi">8</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.511982</span><span class="p">]</span><span class="w">   </span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">Thread</span><span class="p">[</span><span class="n">recvpollcq</span><span class="o">:</span><span class="mi">17</span><span class="p">]</span><span class="w"> </span><span class="n">pinned</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="mi">4</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.539217</span><span class="p">]</span><span class="w"> </span><span class="n">do_close_on_exec</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">TODO</span><span class="p">,</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implemented</span><span class="p">.</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.549209</span><span class="p">]</span><span class="w"> </span><span class="n">STDOUT</span><span class="o">:</span><span class="w"> </span><span class="o">---</span><span class="p">[</span>
<span class="n">Before</span><span class="w"> </span><span class="n">execv</span><span class="o">^</span><span class="n">V</span>
<span class="p">]</span><span class="o">---</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.553870</span><span class="p">]</span><span class="w"> </span><span class="n">STDOUT</span><span class="o">:</span><span class="w"> </span><span class="o">---</span><span class="p">[</span>

<span class="n">e</span>
<span class="o">---</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.557880</span><span class="p">]</span><span class="w"> </span><span class="n">newpid</span><span class="o">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="n">home</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">replica</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.562248</span><span class="p">]</span><span class="w"> </span><span class="n">p2m_fork</span><span class="p">(</span><span class="n">cpu10</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">cur</span><span class="o">:</span><span class="mi">20</span><span class="o">-</span><span class="n">exe</span><span class="p">.</span><span class="n">o</span><span class="w"> </span><span class="n">new</span><span class="o">:</span><span class="mi">21</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.567560</span><span class="p">]</span><span class="w"> </span><span class="n">p2m_fork</span><span class="p">(</span><span class="n">cpu10</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">O</span><span class="w"> </span><span class="n">succeed</span><span class="w"> </span><span class="n">cur</span><span class="o">:</span><span class="mi">20</span><span class="o">-</span><span class="n">exe</span><span class="p">.</span><span class="n">o</span><span class="w"> </span><span class="n">new</span><span class="o">:</span><span class="mi">21</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.573670</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID21</span><span class="w"> </span><span class="n">sys_execve</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.578681</span><span class="p">]</span><span class="w"> </span><span class="n">do_close_on_exec</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">TODO</span><span class="p">,</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implemented</span><span class="p">.</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.584215</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID21</span><span class="w"> </span><span class="n">sys_execve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.599867</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="n">paging</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mo">000000040</span><span class="mi">8446080</span>
<span class="p">[</span><span class="w"> </span><span class="mf">3867.607436</span><span class="p">]</span><span class="w"> </span><span class="n">IP</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101bbbf</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">task_tick_rt</span><span class="o">+</span><span class="mh">0x1f</span><span class="o">/</span><span class="mh">0xd0</span>
</code></pre></div></p>
</li>
</ol>
<h2 id="0416-mon">04/16 Mon<a class="headerlink" href="#0416-mon" title="Permanent link">&para;</a></h2>
<p>Make dist-vma work with TF first. Tough work.</p>
<p><code>0416-w14-7</code>: 1) do_wp_page triggered, 2) dealock on per pte lock. This really should not happen. It is single worker. Basically means the page-&gt;lock is not intialized. Probabaly our per PTE lock implementation is wrong.
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w"> </span><span class="mf">5220.250552</span><span class="p">]</span><span class="w"> </span><span class="n">hb</span><span class="o">:</span><span class="w"> </span><span class="n">worker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">stucked</span>
<span class="p">[</span><span class="w"> </span><span class="mf">5220.254819</span><span class="p">]</span><span class="w"> </span><span class="n">hb</span><span class="o">:</span><span class="w">  </span><span class="n">common_header</span><span class="w"> </span><span class="p">[</span><span class="n">op</span><span class="o">=</span><span class="mh">0x20000000</span><span class="w"> </span><span class="n">src_nid</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span>
<span class="p">[</span><span class="w"> </span><span class="mf">5220.260734</span><span class="p">]</span><span class="w"> </span><span class="n">hb</span><span class="o">:</span><span class="w">  </span><span class="n">msg</span><span class="w"> </span><span class="p">[</span><span class="n">pid</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span><span class="n">tgid</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="mh">0x51</span><span class="p">,</span><span class="n">vaddr</span><span class="o">=</span><span class="mh">0x7fff7b7fdfb8</span><span class="p">]</span>
<span class="p">[</span><span class="w"> </span><span class="mf">5220.267911</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">thpool</span><span class="o">-</span><span class="n">worker0</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">-</span><span class="n">ys</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">237</span>
<span class="p">[</span><span class="w"> </span><span class="mf">5220.274890</span><span class="p">]</span><span class="w"> </span><span class="n">RIP</span><span class="o">:</span><span class="w"> </span><span class="mo">0010</span><span class="o">:</span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81031aa3</span><span class="o">&gt;</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81031aa3</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">handle_lego_mm_fault</span><span class="o">+</span><span class="mh">0x373</span><span class="o">/</span><span class="mh">0x4f0</span>

<span class="n">handle_lego_mm_fault</span><span class="o">+</span><span class="mh">0x373</span><span class="o">/</span><span class="mh">0x4ee</span><span class="o">:</span><span class="w">                                                                                                                                                                                   </span>
<span class="n">arch_spin_lock</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">spinlock</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">21</span><span class="w">                                                                                                                                                                </span>
<span class="w"> </span><span class="p">(</span><span class="n">inlined</span><span class="w"> </span><span class="n">by</span><span class="p">)</span><span class="w"> </span><span class="n">spin_lock</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">include</span><span class="o">/</span><span class="n">lego</span><span class="o">/</span><span class="n">spinlock</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">72</span><span class="w">                                                                                                                                                               </span>
<span class="w"> </span><span class="p">(</span><span class="n">inlined</span><span class="w"> </span><span class="n">by</span><span class="p">)</span><span class="w"> </span><span class="n">do_anonymous_page</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">managers</span><span class="o">/</span><span class="n">memory</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">fault</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">115</span><span class="w">                                                                                                                                                   </span>
<span class="w"> </span><span class="p">(</span><span class="n">inlined</span><span class="w"> </span><span class="n">by</span><span class="p">)</span><span class="w"> </span><span class="n">handle_pte_fault</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">managers</span><span class="o">/</span><span class="n">memory</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">fault</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">142</span><span class="w">                                                                                                                                                    </span>
<span class="w"> </span><span class="p">(</span><span class="n">inlined</span><span class="w"> </span><span class="n">by</span><span class="p">)</span><span class="w"> </span><span class="n">handle_lego_mm_fault</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">managers</span><span class="o">/</span><span class="n">memory</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">fault</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">225</span>
</code></pre></div></p>
<p>A IB bug during normal run (P M S TF), this is REALLY weird:
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">395.259560</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID21</span><span class="w"> </span><span class="n">sys_execve</span>
<span class="p">[</span><span class="w">  </span><span class="mf">395.263345</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">dereference</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mo">00000000000001</span><span class="n">a0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">395.272068</span><span class="p">]</span><span class="w"> </span><span class="n">IP</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81064c09</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">+</span><span class="mh">0x39</span><span class="o">/</span><span class="mh">0x530</span>

<span class="n">fit_poll_cq</span><span class="o">+</span><span class="mh">0x39</span><span class="o">/</span><span class="mh">0x523</span><span class="o">:</span><span class="n">git</span><span class="o">:</span><span class="p">(</span><span class="n">test_vma</span><span class="p">)]</span><span class="w"> </span><span class="n">$</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">faddr2line</span><span class="w"> </span><span class="n">vmImage</span><span class="w">  </span><span class="n">fit_poll_cq</span><span class="o">+</span><span class="mh">0x39</span>
<span class="n">ib_poll_cq</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">include</span><span class="o">/</span><span class="n">rdma</span><span class="o">/</span><span class="n">ib_verbs</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">1614</span>
<span class="w"> </span><span class="p">(</span><span class="n">inlined</span><span class="w"> </span><span class="n">by</span><span class="p">)</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">net</span><span class="o">/</span><span class="n">lego</span><span class="o">/</span><span class="n">fit_internal</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">1671</span>
</code></pre></div></p>
<p>Catch the ib_mad bug once.. and mlx4_error follows. I added more checking to where the mad_queue was assigned.
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">787.471385</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2365</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">15</span>
<span class="p">[</span><span class="w">  </span><span class="mf">787.480124</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">!</span><span class="w"> </span><span class="n">mad_list</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103eea1728</span><span class="w"> </span><span class="n">mad_queue</span><span class="o">:</span><span class="w">           </span><span class="p">(</span><span class="n">null</span><span class="p">)</span>
<span class="p">[</span><span class="w">  </span><span class="mf">787.487491</span><span class="p">]</span><span class="w"> </span><span class="o">------------</span><span class="p">[</span><span class="w"> </span><span class="n">cut</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="p">]</span><span class="o">------------</span>
<span class="p">[</span><span class="w">  </span><span class="mf">787.492630</span><span class="p">]</span><span class="w"> </span><span class="n">WARNING</span><span class="o">:</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">drivers</span><span class="o">/</span><span class="n">infiniband</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">mad</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">1909</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="o">+</span><span class="mh">0xa56</span><span class="o">/</span><span class="mh">0xab0</span>
</code></pre></div></p>
<h2 id="0415-sun">04/15 Sun<a class="headerlink" href="#0415-sun" title="Permanent link">&para;</a></h2>
<p>Trying TF myself.</p>
<p>Had a bug report on 0415-w15-5, on fork, execve etc.
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">317.436811</span><span class="p">]</span><span class="w"> </span><span class="n">newpid</span><span class="o">:</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="n">home</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">replica</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.477701</span><span class="p">]</span><span class="w"> </span><span class="n">pte</span><span class="o">:</span><span class="n">ffff88103e94a038</span><span class="w"> </span><span class="n">pfn</span><span class="o">:</span><span class="mh">0x0</span><span class="w"> </span><span class="n">flags</span><span class="o">:</span><span class="p">()</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.482752</span><span class="p">]</span><span class="w"> </span><span class="n">pte</span><span class="w"> </span><span class="n">dumped</span><span class="w"> </span><span class="n">because</span><span class="o">:</span><span class="w"> </span><span class="n">corrupted</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.487213</span><span class="p">]</span><span class="w"> </span><span class="o">------------</span><span class="p">[</span><span class="w"> </span><span class="n">cut</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="p">]</span><span class="o">------------</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.492352</span><span class="p">]</span><span class="w"> </span><span class="n">WARNING</span><span class="o">:</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">managers</span><span class="o">/</span><span class="n">processor</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">365</span><span class="w"> </span><span class="n">pcache_copy_page_range</span><span class="o">+</span><span class="mh">0x5d1</span><span class="o">/</span><span class="mh">0x6c0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.503213</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">python</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">93</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.552082</span><span class="p">]</span><span class="w"> </span><span class="n">Call</span><span class="w"> </span><span class="n">Trace</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.554799</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.556930</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810123a1</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">__warn</span><span class="p">.</span><span class="n">constprop</span><span class="mf">.0</span><span class="o">+</span><span class="mh">0x91</span><span class="o">/</span><span class="mh">0xd0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.563330</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101246f</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">warn_slowpath_null</span><span class="o">+</span><span class="mh">0xf</span><span class="o">/</span><span class="mh">0x20</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.569634</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102d401</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">pcache_copy_page_range</span><span class="o">+</span><span class="mh">0x5d1</span><span class="o">/</span><span class="mh">0x6c0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.576615</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81037ed7</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">fork_dup_pcache</span><span class="o">+</span><span class="mh">0x27</span><span class="o">/</span><span class="mh">0x30</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.582723</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101e514</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">copy_process</span><span class="o">+</span><span class="mh">0xcf4</span><span class="o">/</span><span class="mh">0x1140</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.588833</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101e986</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">do_fork</span><span class="o">+</span><span class="mh">0x26</span><span class="o">/</span><span class="mh">0x160</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.594264</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101eb89</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">sys_clone</span><span class="o">+</span><span class="mh">0x29</span><span class="o">/</span><span class="mh">0x30</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.599789</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e66d</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">do_syscall_64</span><span class="o">+</span><span class="mh">0x3d</span><span class="o">/</span><span class="mh">0xd0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.605705</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100d56c</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">entry_SYSCALL64_slow_path</span><span class="o">+</span><span class="mh">0x25</span><span class="o">/</span><span class="mh">0x25</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.612782</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">EOT</span><span class="o">&gt;</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.614917</span><span class="p">]</span><span class="w"> </span><span class="o">---</span><span class="p">[</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">trace</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="p">]</span><span class="o">---</span>
<span class="p">[</span><span class="w">  </span><span class="mf">317.625561</span><span class="p">]</span><span class="w"> </span><span class="n">p2m_fork</span><span class="p">(</span><span class="n">cpu14</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">cur</span><span class="o">:</span><span class="mi">22</span><span class="o">-</span><span class="n">python</span><span class="w"> </span><span class="n">new</span><span class="o">:</span><span class="mi">36</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.209312</span><span class="p">]</span><span class="w"> </span><span class="n">p2m_fork</span><span class="p">(</span><span class="n">cpu14</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">O</span><span class="w"> </span><span class="n">succeed</span><span class="w"> </span><span class="n">cur</span><span class="o">:</span><span class="mi">22</span><span class="o">-</span><span class="n">python</span><span class="w"> </span><span class="n">new</span><span class="o">:</span><span class="mi">36</span>


<span class="p">[</span><span class="w">  </span><span class="mf">330.310909</span><span class="p">]</span><span class="w"> </span><span class="o">------------</span><span class="p">[</span><span class="w"> </span><span class="n">cut</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="p">]</span><span class="o">------------</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.315864</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">:</span><span class="w"> </span><span class="n">failure</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">managers</span><span class="o">/</span><span class="n">processor</span><span class="o">/</span><span class="n">pcache</span><span class="o">/</span><span class="n">rmap</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">804</span><span class="o">/</span><span class="n">pcache_zap_pte</span><span class="p">()</span><span class="o">!</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.324302</span><span class="p">]</span><span class="w"> </span><span class="n">Kernel</span><span class="w"> </span><span class="n">Panic</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">syncing</span><span class="o">:</span><span class="w"> </span><span class="n">BUG</span><span class="o">!</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.329050</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">36</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">python</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">93</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.377824</span><span class="p">]</span><span class="w"> </span><span class="n">Call</span><span class="w"> </span><span class="n">Trace</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.380540</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.382672</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81026493</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">panic</span><span class="o">+</span><span class="mh">0xc2</span><span class="o">/</span><span class="mh">0x105</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.387908</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101bbcc</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">task_tick_rt</span><span class="o">+</span><span class="mh">0x2c</span><span class="o">/</span><span class="mh">0xd0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.393920</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81019245</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">scheduler_tick</span><span class="o">+</span><span class="mh">0x55</span><span class="o">/</span><span class="mh">0x60</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.400126</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810168f5</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">tick_handle_periodic</span><span class="o">+</span><span class="mh">0x45</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.406913</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81006684</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">apic_timer_interrupt</span><span class="o">+</span><span class="mh">0x54</span><span class="o">/</span><span class="mh">0x90</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.413700</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e2aa</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">smp__apic_timer_interrupt</span><span class="o">+</span><span class="mh">0x6a</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.420973</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810125ad</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">printk</span><span class="o">+</span><span class="mh">0x11d</span><span class="o">/</span><span class="mh">0x1b0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.426597</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810375bc</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">pcache_zap_pte</span><span class="o">+</span><span class="mh">0x14c</span><span class="o">/</span><span class="mh">0x190</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.432802</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81035db0</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">__pcache_remove_rmap_one</span><span class="o">+</span><span class="mh">0x70</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.439978</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102cd25</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">unmap_page_range</span><span class="o">+</span><span class="mh">0x325</span><span class="o">/</span><span class="mh">0x3f0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.446379</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102ce0e</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">release_pgtable</span><span class="o">+</span><span class="mh">0x1e</span><span class="o">/</span><span class="mh">0x40</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.452487</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81037ef8</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">pcache_process_exit</span><span class="o">+</span><span class="mh">0x18</span><span class="o">/</span><span class="mh">0x20</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.458984</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101d3c4</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">mmput</span><span class="o">+</span><span class="mh">0x34</span><span class="o">/</span><span class="mh">0xb0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.464123</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102c38d</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">do_execve</span><span class="o">+</span><span class="mh">0x42d</span><span class="o">/</span><span class="mh">0x760</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.469845</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102c6c9</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">sys_execve</span><span class="o">+</span><span class="mh">0x9</span><span class="o">/</span><span class="mh">0x10</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.475371</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e66d</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">do_syscall_64</span><span class="o">+</span><span class="mh">0x3d</span><span class="o">/</span><span class="mh">0xd0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.481286</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100d56c</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">entry_SYSCALL64_slow_path</span><span class="o">+</span><span class="mh">0x25</span><span class="o">/</span><span class="mh">0x25</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.488364</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">EOT</span><span class="o">&gt;</span>
<span class="p">[</span><span class="w">  </span><span class="mf">330.490501</span><span class="p">]</span><span class="w"> </span><span class="o">---</span><span class="p">[</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">Kernel</span><span class="w"> </span><span class="n">panic</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">syncing</span><span class="o">:</span><span class="w"> </span><span class="n">BUG</span><span class="o">!</span>
</code></pre></div>
one more
<div class="highlight"><pre><span></span><code>[  369.223161] newpid: 22 home:1 replica: 1
[  369.264307] pte:ffff88103ea41038 (0x0) pfn:0x0 flags:()
[  369.269938] pte dumped because: corrupted
[  369.274399] ------------[ cut here ]------------
[  369.279538] WARNING: CPU: 14 PID: 22 at managers/processor/pgtable.c:365 pcache_copy_page_range+0x5d1/0x6c0
[  369.290398] CPU: 14 PID: 22 Comm: python 4.0.0-lego+ #94
[  369.296310] Stack:
[  369.341976] &lt;TSK&gt;
[  369.344107] [&lt;ffffffff810123a1&gt;] __warn.constprop.0+0x91/0xd0
[  369.350508] [&lt;ffffffff8101246f&gt;] warn_slowpath_null+0xf/0x20
[  369.356809] [&lt;ffffffff8102d401&gt;] pcache_copy_page_range+0x5d1/0x6c0
[  369.363790] [&lt;ffffffff81037f07&gt;] fork_dup_pcache+0x27/0x30
[  369.369897] [&lt;ffffffff8101e514&gt;] copy_process+0xcf4/0x1140
[  369.376006] [&lt;ffffffff8101e986&gt;] do_fork+0x26/0x160
[  369.381435] [&lt;ffffffff8101eb89&gt;] sys_clone+0x29/0x30
[  369.386960] [&lt;ffffffff8100e66d&gt;] do_syscall_64+0x3d/0xd0
[  369.392875] [&lt;ffffffff8100d56c&gt;] entry_SYSCALL64_slow_path+0x25/0x25
[  369.399952] &lt;EOT&gt;
[  369.402086] ---[ end trace 0000000000000000 ]---

[  369.412750] p2m_fork(cpu14): I cur:22-python new:36
[  369.418215] p2m_fork(cpu14): O succeed cur:22-python new:36
[  369.500829] ptent: 0x340 address: 0x7fffe2408000
[  369.505783] pte:ffff88103dbe5040 (0x340) pfn:0x0 flags:(dirty|global|softw1)
[  369.513637] pte dumped because: corrupted
[  369.518095] ------------[ cut here ]------------
[  369.523236] BUG: failure at managers/processor/pcache/rmap.c:808/pcache_zap_pte()!
[  369.531672] Kernel Panic - not syncing: BUG!
</code></pre></div></p>
<h2 id="0414-sat">04/14 Sat<a class="headerlink" href="#0414-sat" title="Permanent link">&para;</a></h2>
<ol>
<li>Check if page table pages, page themselves are freed in munmap, at both P and M. Need to confirm. Will they do harm</li>
<li>Implement replication</li>
<li>Add IB counter</li>
</ol>
<h2 id="0413-fri">04/13 Fri<a class="headerlink" href="#0413-fri" title="Permanent link">&para;</a></h2>
<p>Patched M side pgtable to use per PTE/PMD lock. So thpool in M will not be bottlnecked by the page_table_lock.</p>
<h3 id="ib_mad_recv_done_handler-may-corrupt-memory-again">ib_mad_recv_done_handler may corrupt memory, again.<a class="headerlink" href="#ib_mad_recv_done_handler-may-corrupt-memory-again" title="Permanent link">&para;</a></h3>
<p>Somehow, during testing of this patch. Running with MT-Phoenix 1GB, the P side has reported bad pgd entries. I&rsquo;m using fork+execve way. The child(phoenix) already exit. This msg is printed when parent exit_mm. The pgd table should either be 0, or valid pud va. Memory corruption happened&hellip;
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w"> </span><span class="mf">2551.687806</span><span class="p">]</span><span class="w"> </span><span class="n">Kernel</span><span class="w"> </span><span class="n">strace</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.690715</span><span class="p">]</span><span class="w"> </span><span class="n">Task</span><span class="o">:</span><span class="w"> </span><span class="mi">21</span><span class="o">:</span><span class="mi">21</span><span class="w"> </span><span class="n">nr_accumulated_threads</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.696327</span><span class="p">]</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">time</span><span class="w">        </span><span class="n">seconds</span><span class="w">  </span><span class="n">usecs</span><span class="o">/</span><span class="n">call</span><span class="w">     </span><span class="n">calls</span><span class="w">    </span><span class="n">errors</span><span class="w"> </span><span class="n">syscall</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.703704</span><span class="p">]</span><span class="w"> </span><span class="o">------</span><span class="w"> </span><span class="o">--------------</span><span class="w"> </span><span class="o">-----------</span><span class="w"> </span><span class="o">---------</span><span class="w"> </span><span class="o">---------</span><span class="w"> </span><span class="o">----------------</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.712141</span><span class="p">]</span><span class="w">  </span><span class="mf">98.63</span><span class="w">   </span><span class="mf">66.942660568</span><span class="w">    </span><span class="mi">66942661</span><span class="w">         </span><span class="mi">1</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_wait4</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.719898</span><span class="p">]</span><span class="w">   </span><span class="mf">0.45</span><span class="w">    </span><span class="mf">0.457060789</span><span class="w">      </span><span class="mi">457061</span><span class="w">         </span><span class="mi">1</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_clone</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.727654</span><span class="p">]</span><span class="w">   </span><span class="mf">0.20</span><span class="w">    </span><span class="mf">0.204320071</span><span class="w">       </span><span class="mi">51081</span><span class="w">         </span><span class="mi">4</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_brk</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.735216</span><span class="p">]</span><span class="w">   </span><span class="mf">0.40</span><span class="w">    </span><span class="mf">0.040378189</span><span class="w">       </span><span class="mi">40379</span><span class="w">         </span><span class="mi">1</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_mmap</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.742876</span><span class="p">]</span><span class="w">   </span><span class="mf">0.13</span><span class="w">    </span><span class="mf">0.013682424</span><span class="w">        </span><span class="mi">4561</span><span class="w">         </span><span class="mi">3</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_write</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.750633</span><span class="p">]</span><span class="w">   </span><span class="mf">0.10</span><span class="w">    </span><span class="mf">0.000001039</span><span class="w">           </span><span class="mi">2</span><span class="w">         </span><span class="mi">1</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_newfstat</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.758681</span><span class="p">]</span><span class="w">   </span><span class="mf">0.88</span><span class="w">    </span><span class="mf">0.000000888</span><span class="w">           </span><span class="mi">1</span><span class="w">         </span><span class="mi">2</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_rt_sigaction</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.767114</span><span class="p">]</span><span class="w">   </span><span class="mf">0.79</span><span class="w">    </span><span class="mf">0.000000792</span><span class="w">           </span><span class="mi">1</span><span class="w">         </span><span class="mi">2</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_futex</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.774871</span><span class="p">]</span><span class="w">   </span><span class="mf">0.77</span><span class="w">    </span><span class="mf">0.000000770</span><span class="w">           </span><span class="mi">1</span><span class="w">         </span><span class="mi">1</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_rt_sigprocmask</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.783501</span><span class="p">]</span><span class="w">   </span><span class="mf">0.54</span><span class="w">    </span><span class="mf">0.000000548</span><span class="w">           </span><span class="mi">1</span><span class="w">         </span><span class="mi">1</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_arch_prctl</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.791742</span><span class="p">]</span><span class="w">   </span><span class="mf">0.49</span><span class="w">    </span><span class="mf">0.000000499</span><span class="w">           </span><span class="mi">1</span><span class="w">         </span><span class="mi">1</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_newuname</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.799789</span><span class="p">]</span><span class="w">   </span><span class="mf">0.46</span><span class="w">    </span><span class="mf">0.000000469</span><span class="w">           </span><span class="mi">1</span><span class="w">         </span><span class="mi">1</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_getrlimit</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.807933</span><span class="p">]</span><span class="w">   </span><span class="mf">0.19</span><span class="w">    </span><span class="mf">0.000000195</span><span class="w">           </span><span class="mi">1</span><span class="w">         </span><span class="mi">1</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_set_tid_address</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.816659</span><span class="p">]</span><span class="w">   </span><span class="mf">0.19</span><span class="w">    </span><span class="mf">0.000000190</span><span class="w">           </span><span class="mi">1</span><span class="w">         </span><span class="mi">1</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_set_robust_list</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.825386</span><span class="p">]</span><span class="w">   </span><span class="mf">0.18</span><span class="w">    </span><span class="mf">0.000000181</span><span class="w">           </span><span class="mi">1</span><span class="w">         </span><span class="mi">1</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">sys_ioctl</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.833143</span><span class="p">]</span><span class="w"> </span><span class="o">------</span><span class="w"> </span><span class="o">--------------</span><span class="w"> </span><span class="o">-----------</span><span class="w"> </span><span class="o">---------</span><span class="w"> </span><span class="o">---------</span><span class="w"> </span><span class="o">----------------</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.841577</span><span class="p">]</span><span class="w"> </span><span class="mf">100.00</span><span class="w">   </span><span class="mf">67.658107612</span><span class="w">                    </span><span class="mi">22</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">total</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.848945</span><span class="p">]</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.850591</span><span class="p">]</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.852240</span><span class="p">]</span><span class="w"> </span><span class="n">Kernel</span><span class="w"> </span><span class="n">Profile</span><span class="w"> </span><span class="n">Points</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.855924</span><span class="p">]</span><span class="w">  </span><span class="n">status</span><span class="w">                  </span><span class="n">name</span><span class="w">             </span><span class="n">total</span><span class="w">                </span><span class="n">nr</span><span class="w">            </span><span class="n">avg</span><span class="p">.</span><span class="n">ns</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.865621</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.875317</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">      </span><span class="n">flush_tlb_others</span><span class="w">       </span><span class="mf">0.000204992</span><span class="w">                </span><span class="mi">58</span><span class="w">              </span><span class="mi">3535</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.885014</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">     </span><span class="n">__do_kmalloc_node</span><span class="w">       </span><span class="mf">0.300783843</span><span class="w">            </span><span class="mi">281501</span><span class="w">              </span><span class="mi">1069</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.894709</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">     </span><span class="n">__pcache_zerofill</span><span class="w">       </span><span class="mf">0.009844770</span><span class="w">             </span><span class="mi">16558</span><span class="w">               </span><span class="mi">595</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.904404</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">           </span><span class="n">pcache_miss</span><span class="w">      </span><span class="mf">54.414457906</span><span class="w">            </span><span class="mi">257869</span><span class="w">            </span><span class="mi">211016</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.914100</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">          </span><span class="n">pcache_flush</span><span class="w">       </span><span class="mf">0.000000000</span><span class="w">                 </span><span class="mi">0</span><span class="w">                 </span><span class="mi">0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.923795</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2551.933490</span><span class="p">]</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.074985</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956028</span><span class="p">(</span><span class="n">ffffffff81146ca0</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.084206</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956030</span><span class="p">(</span><span class="n">ffff88103e956030</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.093611</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956038</span><span class="p">(</span><span class="n">ffff88103e956030</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.103016</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956048</span><span class="p">(</span><span class="n">ffff88103cc48740</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.112421</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956050</span><span class="p">(</span><span class="mo">00000000000001</span><span class="n">c0</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.121825</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956058</span><span class="p">(</span><span class="n">ffff88103eea2008</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.131230</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956060</span><span class="p">(</span><span class="n">ffff88103eea17d8</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.140635</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956068</span><span class="p">(</span><span class="n">ffff88103ee42520</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.150040</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e9560e8</span><span class="p">(</span><span class="mf">000000103e9560f</span><span class="mi">0</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.159444</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956118</span><span class="p">(</span><span class="mo">010200</span><span class="mi">8081018101</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.168849</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956120</span><span class="p">(</span><span class="mi">3</span><span class="n">c010b0012000000</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.178254</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956128</span><span class="p">(</span><span class="mo">0000000000001100</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.187659</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956138</span><span class="p">(</span><span class="mf">00000000f</span><span class="n">fffffff</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.197064</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956158</span><span class="p">(</span><span class="mo">0307</span><span class="mi">8</span><span class="n">a2402010101</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.206467</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956160</span><span class="p">(</span><span class="mo">0307</span><span class="mi">8</span><span class="n">a2453946600</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.215872</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956168</span><span class="p">(</span><span class="mo">0307</span><span class="mi">8</span><span class="n">a2450946600</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.225277</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956170</span><span class="p">(</span><span class="mo">0310</span><span class="mi">800051946600</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.234682</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956178</span><span class="p">(</span><span class="n">c902000100000000</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.244088</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956198</span><span class="p">(</span><span class="n">bfd0cc054a122000</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.253492</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e9561a0</span><span class="p">(</span><span class="mo">0000000000</span><span class="mi">98</span><span class="n">b9c8</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.262897</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e9561a8</span><span class="p">(</span><span class="n">bfe0fe0610914e01</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.272302</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e9561b0</span><span class="p">(</span><span class="mf">000000000050f</span><span class="mi">2</span><span class="n">c7</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.281706</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e9561b8</span><span class="p">(</span><span class="n">bfd9a30000ec5100</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.291111</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e9561c0</span><span class="p">(</span><span class="n">bffc91d40f20f2c7</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.300516</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e9561c8</span><span class="p">(</span><span class="mf">0f</span><span class="mi">20</span><span class="n">cd054a20f2c7</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.309920</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e9561d0</span><span class="p">(</span><span class="mi">1094</span><span class="n">edcf0f60edcf</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.319325</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e9561d8</span><span class="p">(</span><span class="mo">0000000000000100</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.328730</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="k">asm</span><span class="o">/</span><span class="n">pgtable</span><span class="p">.</span><span class="n">h</span><span class="o">:</span><span class="mi">579</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">pgd</span><span class="w"> </span><span class="n">ffff88103e956218</span><span class="p">(</span><span class="mo">0000000000005</span><span class="n">aa5</span><span class="p">)</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2552.338151</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pgfault</span><span class="o">:</span><span class="w"> </span><span class="mi">26</span>
</code></pre></div></p>
<p>Second run, saw this invalid pointer deference again! Combined with the above log, I think ib_mad is definitely corrupting memory! I have to take a look.
<div class="highlight"><pre><span></span><code>qp_info = mad_list-&gt;mad_queue-&gt;qp_info;
</code></pre></div></p>
<h3 id="patching-the-handlers-to-use-tx-buffer">Patching the handlers to use tx buffer.<a class="headerlink" href="#patching-the-handlers-to-use-tx-buffer" title="Permanent link">&para;</a></h3>
<p>Patched.</p>
<p>Once race condition: pcache_handle_miss use the page itself as the reply buffer. Assume later on, it changes to use nowait reply. When the reply is buffered in the queue and has not been sent. Another munmap comes in and invalidate this area, then the page will be freed. The data is invalidate.</p>
<p>But this case seems abnormal. The application will not do so I guess.</p>
<h3 id="check-if-page-table-pages-page-themselves-are-freed-in-munmap-at-both-p-and-m-need-to-confirm">Check if page table pages, page themselves are freed in munmap, at both P and M. Need to confirm.<a class="headerlink" href="#check-if-page-table-pages-page-themselves-are-freed-in-munmap-at-both-p-and-m-need-to-confirm" title="Permanent link">&para;</a></h3>
<h3 id="tonight-task-think-about-how-to-do-the-vma-replication-how-to-combine-with-the-line-replicaiton">Tonight task. Think about how to do the VMA replication, how to combine with the $ line replicaiton.<a class="headerlink" href="#tonight-task-think-about-how-to-do-the-vma-replication-how-to-combine-with-the-line-replicaiton" title="Permanent link">&para;</a></h3>
<h2 id="0412-thur">04/12 Thur<a class="headerlink" href="#0412-thur" title="Permanent link">&para;</a></h2>
<p>Patched zerofill. All done.</p>
<p>Testing new driver fix with Phoenix
- 1<sup>st</sup> run, the mismatch reply is still there. mmap() replied address is different from the one printed. So segfault follows. (0412-w15-4)
- 2st run, 3st run, succeed.</p>
<p>0412-w15-9 0412-w14-9  First time testing phoenix with zerofill (no net). Somehow, P has pcache timeout, but M&rsquo;s watchdog show there is no pending requests. This happen once before I remember&hellip;</p>
<p>0412-w15-10. Have not seen this ib mad thing for a long time. Indeed somewhere is wrong.
<div class="highlight"><pre><span></span><code>[  297.794969] ib_mad_completion_handler 2344 got successful recv cq op 128 mad_got_one 15
[  297.803706] BUG: unable to handle kernel NULL pointer dereference at 0000000000000020
[  297.812431] IP: [&lt;ffffffff81058937&gt;] ib_mad_completion_handler+0xc7/0x810
</code></pre></div>
2</p>
<h2 id="0411-wed">04/11 Wed<a class="headerlink" href="#0411-wed" title="Permanent link">&para;</a></h2>
<p>Adding anon first touch opt.</p>
<p><mark class="critic">0411-p/m-9</mark>: this log indicate M does not have any unhandled requests, but P side has 1 <code>__pcache_fill</code> timeout. It seems the message is lost somewhere.</p>
<p><mark class="critic">0411-p/m-11</mark>: catch one with the debug msg Yiying added. She says the M side send queue has 2 reqs. But poll does not return any error. Weird.</p>
<p>Help debugging IB issue.</p>
<h2 id="0410-tue">04/10 Tue<a class="headerlink" href="#0410-tue" title="Permanent link">&para;</a></h2>
<p>Found. IB stuck. Damn.
<div class="highlight"><pre><span></span><code>[ 2240.294960] RIP: 0010:[&lt;ffffffff8104a6d8&gt;]  [&lt;ffffffff8104a6d8&gt;] mlx4_ib_poll_cq+0x378/0x6a0
[ 2242.694733] RIP: 0010:[&lt;ffffffff8104a6d8&gt;]  [&lt;ffffffff8104a6d8&gt;] mlx4_ib_poll_cq+0x378/0x6a0
[ 2245.094524] RIP: 0010:[&lt;ffffffff8104a6e3&gt;]  [&lt;ffffffff8104a6e3&gt;] mlx4_ib_poll_cq+0x383/0x6a0
[ 2247.494306] RIP: 0010:[&lt;ffffffff8104a6d8&gt;]  [&lt;ffffffff8104a6d8&gt;] mlx4_ib_poll_cq+0x378/0x6a0
[ 2249.894088] RIP: 0010:[&lt;ffffffff8104a6d8&gt;]  [&lt;ffffffff8104a6d8&gt;] mlx4_ib_poll_cq+0x378/0x6a0
[ 2252.293870] RIP: 0010:[&lt;ffffffff8104a6d8&gt;]  [&lt;ffffffff8104a6d8&gt;] mlx4_ib_poll_cq+0x378/0x6a0
[ 2254.693651] RIP: 0010:[&lt;ffffffff8104a6d8&gt;]  [&lt;ffffffff8104a6d8&gt;] mlx4_ib_poll_cq+0x378/0x6a0
[ 2257.093431] RIP: 0010:[&lt;ffffffff8104a6e3&gt;]  [&lt;ffffffff8104a6e3&gt;] mlx4_ib_poll_cq+0x383/0x6a0
</code></pre></div></p>
<h2 id="0409-mon">04/09 Mon<a class="headerlink" href="#0409-mon" title="Permanent link">&para;</a></h2>
<p>thpool testing. 4 workers. MT-phoenix:</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">wuklab05</span><span class="w"> </span><span class="n">ys</span><span class="p">]</span><span class="err">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="mo">040</span><span class="mi">9</span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="n">__munmap</span>
<span class="p">[</span><span class="w">  </span><span class="mf">227.054974</span><span class="p">]</span><span class="w"> </span><span class="n">CPU14</span><span class="w"> </span><span class="n">PID22</span><span class="w"> </span><span class="n">strace__munmap</span><span class="p">([</span><span class="mh">0x7fffb0ba9000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x7fffb4000000</span><span class="p">],</span><span class="w"> </span><span class="mi">54882304</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">227.093466</span><span class="p">]</span><span class="w"> </span><span class="n">CPU16</span><span class="w"> </span><span class="n">PID23</span><span class="w"> </span><span class="n">strace__munmap</span><span class="p">([</span><span class="mh">0x7fffab7ff000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x7fffac000000</span><span class="p">],</span><span class="w"> </span><span class="mi">8392704</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">227.102773</span><span class="p">]</span><span class="w"> </span><span class="n">CPU14</span><span class="w"> </span><span class="n">PID22</span><span class="w"> </span><span class="n">strace__munmap</span><span class="p">([</span><span class="mh">0x7fffb8000000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x7fffb8ba9000</span><span class="p">],</span><span class="w"> </span><span class="mi">12226560</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">227.141265</span><span class="p">]</span><span class="w"> </span><span class="n">CPU18</span><span class="w"> </span><span class="n">PID24</span><span class="w"> </span><span class="n">strace__munmap</span><span class="p">([</span><span class="mh">0x7fffa8000000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x7fffac000000</span><span class="p">],</span><span class="w"> </span><span class="mi">67108864</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">227.150669</span><span class="p">]</span><span class="w"> </span><span class="n">CPU16</span><span class="w"> </span><span class="n">PID23</span><span class="w"> </span><span class="n">strace__munmap</span><span class="p">([</span><span class="mh">0x7fffb0000000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x7fffb37ff000</span><span class="p">],</span><span class="w"> </span><span class="mi">58716160</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">227.218248</span><span class="p">]</span><span class="w"> </span><span class="n">CPU22</span><span class="w"> </span><span class="n">PID26</span><span class="w"> </span><span class="n">strace__munmap</span><span class="p">([</span><span class="mh">0x7fffa0000000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x7fffa4000000</span><span class="p">],</span><span class="w"> </span><span class="mi">67108864</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">227.285826</span><span class="p">]</span><span class="w"> </span><span class="n">CPU2</span><span class="w"> </span><span class="n">PID28</span><span class="w"> </span><span class="n">strace__munmap</span><span class="p">([</span><span class="mh">0x7fff98000000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x7fff9c000000</span><span class="p">],</span><span class="w"> </span><span class="mi">67108864</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">227.440567</span><span class="p">]</span><span class="w"> </span><span class="n">CPU14</span><span class="w"> </span><span class="n">PID31</span><span class="w"> </span><span class="n">strace__munmap</span><span class="p">([</span><span class="mh">0x7fff8a7fd000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x7fff8c000000</span><span class="p">],</span><span class="w"> </span><span class="mi">25178112</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">227.449972</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID30</span><span class="w"> </span><span class="n">strace__munmap</span><span class="p">([</span><span class="mh">0x7fff88000000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x7fff8c000000</span><span class="p">],</span><span class="w"> </span><span class="mi">67108864</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">227.459376</span><span class="p">]</span><span class="w"> </span><span class="n">CPU14</span><span class="w"> </span><span class="n">PID31</span><span class="w"> </span><span class="n">strace__munmap</span><span class="p">([</span><span class="mh">0x7fff90000000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x7fff927fd000</span><span class="p">],</span><span class="w"> </span><span class="mi">41930752</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">227.490109</span><span class="p">]</span><span class="w"> </span><span class="n">CPU18</span><span class="w"> </span><span class="n">PID33</span><span class="w"> </span><span class="n">strace__munmap</span><span class="p">([</span><span class="mh">0x7fff80000000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x7fff84000000</span><span class="p">],</span><span class="w"> </span><span class="mi">67108864</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">227.723140</span><span class="p">]</span><span class="w"> </span><span class="n">word_count</span><span class="o">-</span><span class="n">pthr</span><span class="p">[</span><span class="mi">29</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="n">segfault</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mh">0x4e842010</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="mo">0000000000420354</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="mf">00007f</span><span class="n">ffb17f9bc0</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">6</span>
<span class="mh">0x4e842010</span>
</code></pre></div>
<ul>
<li>Print mmap on M, if segfault. Printed, the <code>0x4e842010</code> is never a valid address. thpool makes Memory side SMP. Probably bring some issues.</li>
</ul>
<p>Found:
<div class="highlight"><pre><span></span><code>P
CPU22 PID26 strace__mmap(addr=0x0, len=0xfb000, prot(0x3)=PROT_READ|PROT_WRITE, flags(0x22)=MAP_PRIVATE|MAP_ANONYMOUS, fd=18446744073709551615( ), off=0x0) = 1317351432, 0x4e853008
word_count-pthr[26]: segfault at 0x4e853010 ip 0000000000420354 sp 00007fff972a8bc0 error 6

M
[  583.120615]   00400000-004d9000 r-xp 00000000 /root/ys/phoenix/phoenix-2.0/tests/word_count/word_count-pthread
[  583.131578]   006d9000-006dc000 rw-p 000d9000 /root/ys/phoenix/phoenix-2.0/tests/word_count/word_count-pthread
[  583.142729]   006dc000-00755000 rw-p 00000000 [heap]
[  583.148254]   7fff529c9000-7fffb93aa000 rw-p 00000000
[  583.153974]   7fffb93aa000-7ffff7fff000 rw-p 00000000 /root/ys/phoenix/phoenix-2.0/tests/word_count/word_count_datafiles/word_1GB.txt
[  583.167355]   7ffffffde000-7ffffffff000 rw-p 00000000 [stack]
[  583.173753] ------------[ cut here ]------------
[  583.178892] WARNING: CPU: 4 PID: 31 at managers/memory/handle_pcache/fault.c:55 handle_p2m_pcache_miss+0x18e/0x1d0
[  583.190430] src_nid:0,pid:21,vaddr:0x4e853010
[  583.195279] CPU: 4 PID: 31 Comm: thpool-worker0 4.0.0-lego-ys+ #90
</code></pre></div></p>
<p>Confirmed. I printed added a number to mmap requests. And the compare the results of both P and M. The data is wrong. Btw, I&rsquo;m only running 1 worker thread at M, which makes it single thread handling. So, I&rsquo;m going to, 1) first use kmalloc to get the reply buffer, and 2) revert back the IB MAX_OUT config, remove the #ifdef COMP_MEMORY. See if it is this patch&rsquo;s issue.
<div class="highlight"><pre><span></span><code><span class="nl">P</span><span class="p">:</span>
<span class="n">CPU18</span><span class="w"> </span><span class="n">PID24</span><span class="w"> </span><span class="n">strace__mmap</span><span class="p">(</span><span class="mi">30</span><span class="w"> </span><span class="p">..)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1325940736</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7fffb0f7c000</span>
<span class="n">CPU22</span><span class="w"> </span><span class="n">PID26</span><span class="w"> </span><span class="n">strace__mmap</span><span class="p">(</span><span class="mi">31</span><span class="w"> </span><span class="p">..)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2144269992</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7fcef6a8</span>

<span class="nl">M</span><span class="p">:</span>
<span class="p">...</span>
<span class="n">handle_p2m_mmap</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mf">7f</span><span class="n">ffb0f7c000</span>
<span class="n">handle_p2m_mmap</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="mf">7f</span><span class="n">ffb0efe000</span>
<span class="p">...</span>
</code></pre></div></p>
<p>Anyway, this is <mark class="critic">temporary</mark> fixed by using kmalloced reply buffer.</p>
<p>Spent whole afternoon and whole night. Finally figure out why timeout happen in P. It is because somewhere in the middle, M has 1 or more requests stucked/unhandled. Deadlock happen in the middle.</p>
<p>Like this one. 5 requests queued waiting, 1 is being handled. And that 1 handler stuck. And it is handle_pcache_miss. Now, I need to find out where it stuck!
<div class="highlight"><pre><span></span><code>thpool-worker0 nr_queued: 5 1
</code></pre></div></p>
<p>Oh, I really hope we can have some <mark class="critic">soft/hw lockdep, watchdog stuff</mark>. This should make out life much much much much much easier!</p>
<h2 id="0408-sun">04/08 Sun<a class="headerlink" href="#0408-sun" title="Permanent link">&para;</a></h2>
<p>Trying the fit_nowait patch.</p>
<ul>
<li>First try fit_nowait patch, without any chanegs to other code. See if this patch can work.</li>
<li>Second, modify pcache to use reply_message_nowait. See if this can work. and improve performance.</li>
<li>Third, if 2) can improve, perf. Move on to modify thpool patch.</li>
</ul>
<p>1<sup>st</sup>, P fail at ib_mad, during boot:
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">349.239220</span><span class="p">]</span><span class="w"> </span><span class="n">Online</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">22</span>
<span class="p">[</span><span class="w">  </span><span class="mf">349.244940</span><span class="p">]</span><span class="w"> </span><span class="n">Active</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">22</span>
<span class="p">[</span><span class="w">  </span><span class="mf">349.250272</span><span class="p">]</span><span class="w">   </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">Thread</span><span class="p">[</span><span class="n">kvictim_flushd</span><span class="o">:</span><span class="mi">19</span><span class="p">]</span><span class="w"> </span><span class="n">pinned</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="mi">8</span>
<span class="p">[</span><span class="w">  </span><span class="mf">349.256478</span><span class="p">]</span><span class="w">   </span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">Thread</span><span class="p">[</span><span class="n">recvpollcq</span><span class="o">:</span><span class="mi">17</span><span class="p">]</span><span class="w"> </span><span class="n">pinned</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="mi">4</span>
<span class="p">[</span><span class="w">  </span><span class="mf">356.188819</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">13</span>
<span class="p">[</span><span class="w">  </span><span class="mf">356.197545</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">dereference</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mo">0000000000000020</span>
<span class="p">[</span><span class="w">  </span><span class="mf">356.206270</span><span class="p">]</span><span class="w"> </span><span class="n">IP</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81058287</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="o">+</span><span class="mh">0xc7</span><span class="o">/</span><span class="mh">0x810</span>
</code></pre></div></p>
<p>2st run, P side, config MAX_OUT to 1. Then single-thread pheonix with 1GB data finished. But forgot to turn on the profile point. Run one more time.</p>
<p>3st run. Same with 2st run setting. But with profile on. Bug shows. Ugh. I still think it is because of ib_mad_handler. It must write to wrong memory locations, and corrupt things randomly.
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">456.237913</span><span class="p">]</span><span class="w"> </span><span class="n">do_close_on_exec</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">TODO</span><span class="p">,</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implemented</span><span class="p">.</span>
<span class="p">...</span>
<span class="p">[</span><span class="w">  </span><span class="mf">456.263274</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="n">paging</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mf">00000002f</span><span class="mi">4</span><span class="n">bfbf58</span>
<span class="p">[</span><span class="w">  </span><span class="mf">456.270843</span><span class="p">]</span><span class="w"> </span><span class="n">IP</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101bbff</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">task_tick_rt</span><span class="o">+</span><span class="mh">0x1f</span><span class="o">/</span><span class="mh">0xd0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">456.277048</span><span class="p">]</span><span class="w"> </span><span class="n">PGD</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">456.279279</span><span class="p">]</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="n">overran</span><span class="w"> </span><span class="n">stack</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="n">corrupted</span>
<span class="p">[</span><span class="w">  </span><span class="mf">456.284804</span><span class="p">]</span><span class="w"> </span><span class="n">Oops</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="p">[</span><span class="err">#</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">SMP</span><span class="w"> </span><span class="n">PROCESSOR</span>
<span class="p">[</span><span class="w">  </span><span class="mf">456.289265</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">kevict_sweepd</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">40</span>
<span class="p">[</span><span class="w">  </span><span class="mf">456.295858</span><span class="p">]</span><span class="w"> </span><span class="n">RIP</span><span class="o">:</span><span class="w"> </span><span class="mo">0010</span><span class="o">:</span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101bbff</span><span class="o">&gt;</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101bbff</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">task_tick_rt</span><span class="o">+</span><span class="mh">0x1f</span><span class="o">/</span><span class="mh">0xd0</span>
</code></pre></div></p>
<p>4st run, succeed. But it looks like the perf is very bad. Oh. but 99% of the pcache miss are file-backed, which will go to storage. So the number is actually doubled.
<div class="highlight"><pre><span></span><code><span class="n">With</span><span class="w"> </span><span class="n">fit_nowait</span><span class="w"> </span><span class="n">patch</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">308.660051</span><span class="p">]</span><span class="w"> </span><span class="n">Kernel</span><span class="w"> </span><span class="n">Profile</span><span class="w"> </span><span class="n">Points</span>
<span class="p">[</span><span class="w">  </span><span class="mf">308.663734</span><span class="p">]</span><span class="w">  </span><span class="n">status</span><span class="w">                  </span><span class="n">name</span><span class="w">             </span><span class="n">total</span><span class="w">                </span><span class="n">nr</span><span class="w">            </span><span class="n">avg</span><span class="p">.</span><span class="n">ns</span>
<span class="p">[</span><span class="w">  </span><span class="mf">308.673431</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
<span class="p">[</span><span class="w">  </span><span class="mf">308.683128</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">      </span><span class="n">flush_tlb_others</span><span class="w">       </span><span class="mf">0.000130715</span><span class="w">                </span><span class="mi">53</span><span class="w">              </span><span class="mi">2467</span>
<span class="p">[</span><span class="w">  </span><span class="mf">308.692824</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">     </span><span class="n">__do_kmalloc_node</span><span class="w">       </span><span class="mf">0.097344056</span><span class="w">            </span><span class="mi">265647</span><span class="w">               </span><span class="mi">367</span>
<span class="p">[</span><span class="w">  </span><span class="mf">308.702521</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">           </span><span class="n">pcache_miss</span><span class="w">       </span><span class="mf">4.504660891</span><span class="w">            </span><span class="mi">258211</span><span class="w">             </span><span class="mi">17446</span>
<span class="p">[</span><span class="w">  </span><span class="mf">308.712218</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">          </span><span class="n">pcache_flush</span><span class="w">       </span><span class="mf">0.000000000</span><span class="w">                 </span><span class="mi">0</span><span class="w">                 </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">308.721914</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
</code></pre></div></p>
<p>5st run. Just run large malloc test. Looks better than yesterday&rsquo;s result. But I&rsquo;m using 15 as P today, instead of 13. So, let me try one more time to see if it is the machine.
<div class="highlight"><pre><span></span><code><span class="n">With</span><span class="w"> </span><span class="n">fit_nowait</span><span class="w"> </span><span class="n">patch</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.382592</span><span class="p">]</span><span class="w"> </span><span class="n">Kernel</span><span class="w"> </span><span class="n">Profile</span><span class="w"> </span><span class="n">Points</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.386277</span><span class="p">]</span><span class="w">  </span><span class="n">status</span><span class="w">                  </span><span class="n">name</span><span class="w">             </span><span class="n">total</span><span class="w">                </span><span class="n">nr</span><span class="w">            </span><span class="n">avg</span><span class="p">.</span><span class="n">ns</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.395974</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.405670</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">      </span><span class="n">flush_tlb_others</span><span class="w">       </span><span class="mf">0.000130838</span><span class="w">                </span><span class="mi">53</span><span class="w">              </span><span class="mi">2469</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.415366</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">     </span><span class="n">__do_kmalloc_node</span><span class="w">       </span><span class="mf">1.604700641</span><span class="w">           </span><span class="mi">1584917</span><span class="w">              </span><span class="mi">1013</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.425062</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">           </span><span class="n">pcache_miss</span><span class="w">       </span><span class="mf">6.467938547</span><span class="w">            </span><span class="mi">786571</span><span class="w">              </span><span class="mi">8223</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.434758</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">          </span><span class="n">pcache_flush</span><span class="w">       </span><span class="mf">3.342783614</span><span class="w">            </span><span class="mi">262225</span><span class="w">             </span><span class="mi">12748</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.444455</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.554497</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pgfault</span><span class="o">:</span><span class="w"> </span><span class="mi">786513</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.557706</span><span class="p">]</span><span class="w"> </span><span class="n">nr_clflush</span><span class="o">:</span><span class="w"> </span><span class="mi">262225</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.561099</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pgfault_wp</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.564299</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pgfault_wp_cow</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.567887</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pgfault_wp_reuse</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.571668</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pgfault_due_to_concurrent_eviction</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.577195</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pcache_fill_from_memory</span><span class="o">:</span><span class="w"> </span><span class="mi">786511</span>
<span class="p">[</span><span class="w">  </span><span class="mf">674.582139</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pcache_fill_from_victim</span><span class="o">:</span><span class="w"> </span><span class="mi">2</span>
</code></pre></div></p>
<p>6st run. Looks like the above fit_nowait can have 400ns improvement. But how come? I did not even change the pcache handling to use ibapi_nowait!!! Maybe random variation. Let me run more.
<div class="highlight"><pre><span></span><code><span class="n">Without</span><span class="w"> </span><span class="n">fit_nowait</span><span class="w"> </span><span class="n">patches</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.546738</span><span class="p">]</span><span class="w"> </span><span class="n">Kernel</span><span class="w"> </span><span class="n">Profile</span><span class="w"> </span><span class="n">Points</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.550424</span><span class="p">]</span><span class="w">  </span><span class="n">status</span><span class="w">                  </span><span class="n">name</span><span class="w">             </span><span class="n">total</span><span class="w">                </span><span class="n">nr</span><span class="w">            </span><span class="n">avg</span><span class="p">.</span><span class="n">ns</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.560119</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.569815</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">      </span><span class="n">flush_tlb_others</span><span class="w">       </span><span class="mf">0.000131140</span><span class="w">                </span><span class="mi">53</span><span class="w">              </span><span class="mi">2475</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.579510</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">     </span><span class="n">__do_kmalloc_node</span><span class="w">       </span><span class="mf">1.758704197</span><span class="w">           </span><span class="mi">1331927</span><span class="w">              </span><span class="mi">1321</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.589205</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">           </span><span class="n">pcache_miss</span><span class="w">       </span><span class="mf">6.807601189</span><span class="w">            </span><span class="mi">786575</span><span class="w">              </span><span class="mi">8655</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.598899</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">          </span><span class="n">pcache_flush</span><span class="w">       </span><span class="mf">3.699044847</span><span class="w">            </span><span class="mi">262227</span><span class="w">             </span><span class="mi">14107</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.608594</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.618289</span><span class="p">]</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.718670</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pgfault</span><span class="o">:</span><span class="w"> </span><span class="mi">786515</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.721878</span><span class="p">]</span><span class="w"> </span><span class="n">nr_clflush</span><span class="o">:</span><span class="w"> </span><span class="mi">262227</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.725272</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pgfault_wp</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.728470</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pgfault_wp_cow</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.732058</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pgfault_wp_reuse</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.735840</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pgfault_due_to_concurrent_eviction</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.741365</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pcache_fill_from_memory</span><span class="o">:</span><span class="w"> </span><span class="mi">786515</span>
<span class="p">[</span><span class="w">  </span><span class="mf">428.746310</span><span class="p">]</span><span class="w"> </span><span class="n">nr_pcache_fill_from_victim</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span>
</code></pre></div></p>
<p>7<sup>th</sup> run. without fit_nowait.
<div class="highlight"><pre><span></span><code><span class="n">without</span><span class="w"> </span><span class="n">fit_nowait</span><span class="p">.</span>
<span class="p">[</span><span class="w">  </span><span class="mf">901.223090</span><span class="p">]</span><span class="w"> </span><span class="n">Kernel</span><span class="w"> </span><span class="n">Profile</span><span class="w"> </span><span class="n">Points</span>
<span class="p">[</span><span class="w">  </span><span class="mf">901.226775</span><span class="p">]</span><span class="w">  </span><span class="n">status</span><span class="w">                  </span><span class="n">name</span><span class="w">             </span><span class="n">total</span><span class="w">                </span><span class="n">nr</span><span class="w">            </span><span class="n">avg</span><span class="p">.</span><span class="n">ns</span>
<span class="p">[</span><span class="w">  </span><span class="mf">901.236472</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
<span class="p">[</span><span class="w">  </span><span class="mf">901.246168</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">      </span><span class="n">flush_tlb_others</span><span class="w">       </span><span class="mf">0.000130802</span><span class="w">                </span><span class="mi">53</span><span class="w">              </span><span class="mi">2468</span>
<span class="p">[</span><span class="w">  </span><span class="mf">901.255865</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">     </span><span class="n">__do_kmalloc_node</span><span class="w">       </span><span class="mf">1.862575608</span><span class="w">           </span><span class="mi">1331923</span><span class="w">              </span><span class="mi">1399</span>
<span class="p">[</span><span class="w">  </span><span class="mf">901.265560</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">           </span><span class="n">pcache_miss</span><span class="w">       </span><span class="mf">6.814540477</span><span class="w">            </span><span class="mi">786572</span><span class="w">              </span><span class="mi">8664</span>
<span class="p">[</span><span class="w">  </span><span class="mf">901.275257</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">          </span><span class="n">pcache_flush</span><span class="w">       </span><span class="mf">3.699187003</span><span class="w">            </span><span class="mi">262224</span><span class="w">             </span><span class="mi">14107</span>
<span class="p">[</span><span class="w">  </span><span class="mf">901.284953</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
</code></pre></div></p>
<p>8<sup>th</sup> run. without fit_nowait.
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">321.514564</span><span class="p">]</span><span class="w"> </span><span class="n">Kernel</span><span class="w"> </span><span class="n">Profile</span><span class="w"> </span><span class="n">Points</span>
<span class="p">[</span><span class="w">  </span><span class="mf">321.518250</span><span class="p">]</span><span class="w">  </span><span class="n">status</span><span class="w">                  </span><span class="n">name</span><span class="w">             </span><span class="n">total</span><span class="w">                </span><span class="n">nr</span><span class="w">            </span><span class="n">avg</span><span class="p">.</span><span class="n">ns</span>
<span class="p">[</span><span class="w">  </span><span class="mf">321.527945</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
<span class="p">[</span><span class="w">  </span><span class="mf">321.537639</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">      </span><span class="n">flush_tlb_others</span><span class="w">       </span><span class="mf">0.000130934</span><span class="w">                </span><span class="mi">53</span><span class="w">              </span><span class="mi">2471</span>
<span class="p">[</span><span class="w">  </span><span class="mf">321.547335</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">     </span><span class="n">__do_kmalloc_node</span><span class="w">       </span><span class="mf">2.216772665</span><span class="w">           </span><span class="mi">1331939</span><span class="w">              </span><span class="mi">1665</span>
<span class="p">[</span><span class="w">  </span><span class="mf">321.557031</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">           </span><span class="n">pcache_miss</span><span class="w">       </span><span class="mf">6.806060415</span><span class="w">            </span><span class="mi">786573</span><span class="w">              </span><span class="mi">8653</span>
<span class="p">[</span><span class="w">  </span><span class="mf">321.566726</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">          </span><span class="n">pcache_flush</span><span class="w">       </span><span class="mf">3.725455841</span><span class="w">            </span><span class="mi">262231</span><span class="w">             </span><span class="mi">14207</span>
<span class="p">[</span><span class="w">  </span><span class="mf">321.576421</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
</code></pre></div></p>
<p>9<sup>th</sup> run. with fit_nowait
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">374.847912</span><span class="p">]</span><span class="w"> </span><span class="n">Kernel</span><span class="w"> </span><span class="n">Profile</span><span class="w"> </span><span class="n">Points</span>
<span class="p">[</span><span class="w">  </span><span class="mf">374.851597</span><span class="p">]</span><span class="w">  </span><span class="n">status</span><span class="w">                  </span><span class="n">name</span><span class="w">             </span><span class="n">total</span><span class="w">                </span><span class="n">nr</span><span class="w">            </span><span class="n">avg</span><span class="p">.</span><span class="n">ns</span>
<span class="p">[</span><span class="w">  </span><span class="mf">374.861293</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
<span class="p">[</span><span class="w">  </span><span class="mf">374.870989</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">      </span><span class="n">flush_tlb_others</span><span class="w">       </span><span class="mf">0.000130858</span><span class="w">                </span><span class="mi">53</span><span class="w">              </span><span class="mi">2470</span>
<span class="p">[</span><span class="w">  </span><span class="mf">374.880684</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">     </span><span class="n">__do_kmalloc_node</span><span class="w">       </span><span class="mf">1.485304454</span><span class="w">           </span><span class="mi">1331934</span><span class="w">              </span><span class="mi">1116</span>
<span class="p">[</span><span class="w">  </span><span class="mf">374.890381</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">           </span><span class="n">pcache_miss</span><span class="w">       </span><span class="mf">6.615317677</span><span class="w">            </span><span class="mi">786582</span><span class="w">              </span><span class="mi">8411</span>
<span class="p">[</span><span class="w">  </span><span class="mf">374.900076</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">          </span><span class="n">pcache_flush</span><span class="w">       </span><span class="mf">3.508328900</span><span class="w">            </span><span class="mi">262234</span><span class="w">             </span><span class="mi">13379</span>
<span class="p">[</span><span class="w">  </span><span class="mf">374.909772</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
</code></pre></div></p>
<p>10<sup>th</sup> run, with fit_nowait
<div class="highlight"><pre><span></span><code>[  225.211058] Kernel Profile Points
[  225.214743]  status                  name             total                nr            avg.ns
[  225.224440] -------  --------------------  ----------------  ----------------  ----------------
[  225.234137]     off      flush_tlb_others       0.000131029                53              2473
[  225.243833]     off     __do_kmalloc_node       1.211421872           1331984               910  
[  225.253529]     off           pcache_miss       6.583096125            786574              8370
[  225.263226]     off          pcache_flush       3.464430818            262227             13212
[  225.272922] -------  --------------------  ----------------  ----------------  ----------------
</code></pre></div></p>
<p>Sum:
<div class="highlight"><pre><span></span><code>with fit_nowait:

[  225.253529]     off           pcache_miss       6.583096125            786574              8370
[  225.263226]     off          pcache_flush       3.464430818            262227             13212

[  374.890381]     off           pcache_miss       6.615317677            786582              8411
[  374.900076]     off          pcache_flush       3.508328900            262234             13379

[  674.425062]     off           pcache_miss       6.467938547            786571              8223
[  674.434758]     off          pcache_flush       3.342783614            262225             12748

Without fit_nowait:
[  428.589205]     off           pcache_miss       6.807601189            786575              8655
[  428.598899]     off          pcache_flush       3.699044847            262227             14107

[  901.265560]     off           pcache_miss       6.814540477            786572              8664
[  901.275257]     off          pcache_flush       3.699187003            262224             14107

[  321.557031]     off           pcache_miss       6.806060415            786573              8653
[  321.566726]     off          pcache_flush       3.725455841            262231             14207
</code></pre></div></p>
<h2 id="0407-sat">04/07 Sat<a class="headerlink" href="#0407-sat" title="Permanent link">&para;</a></h2>
<p>Well, now we finished all the profiling stuff. Continue on other work.</p>
<p>Now I like listening Jazz while coding. Amazing Jazz, really good.</p>
<p>Once again, ib_mad_completion_handler bug will happen. During application run, or even after application exit.
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">465.835447</span><span class="p">]</span><span class="w"> </span><span class="n">nr_mremap_pset_diff</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">477.086886</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">21</span>
<span class="p">[</span><span class="w">  </span><span class="mf">477.095620</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">dereference</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mo">0000000000000020</span>
<span class="p">[</span><span class="w">  </span><span class="mf">477.104345</span><span class="p">]</span><span class="w"> </span><span class="n">IP</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81058277</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="o">+</span><span class="mh">0xc7</span><span class="o">/</span><span class="mh">0x810</span>

<span class="n">ib_mad_completion_handler</span><span class="o">+</span><span class="mh">0xc7</span><span class="o">/</span><span class="mh">0x808</span><span class="o">:</span>
<span class="n">ib_mad_recv_done_handler</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">drivers</span><span class="o">/</span><span class="n">infiniband</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">mad</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">1899</span>
<span class="w"> </span><span class="p">(</span><span class="n">inlined</span><span class="w"> </span><span class="n">by</span><span class="p">)</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">drivers</span><span class="o">/</span><span class="n">infiniband</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">mad</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">2345</span>
</code></pre></div></p>
<p>After remove net from pcache miss:
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">465.572131</span><span class="p">]</span><span class="w"> </span><span class="n">Kernel</span><span class="w"> </span><span class="n">Profile</span><span class="w"> </span><span class="n">Points</span>
<span class="p">[</span><span class="w">  </span><span class="mf">465.575815</span><span class="p">]</span><span class="w">  </span><span class="n">status</span><span class="w">                  </span><span class="n">name</span><span class="w">             </span><span class="n">total</span><span class="w">                </span><span class="n">nr</span><span class="w">            </span><span class="n">avg</span><span class="p">.</span><span class="n">ns</span>
<span class="p">[</span><span class="w">  </span><span class="mf">465.585510</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
<span class="p">[</span><span class="w">  </span><span class="mf">465.595206</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">      </span><span class="n">flush_tlb_others</span><span class="w">       </span><span class="mf">0.000000000</span><span class="w">                 </span><span class="mi">0</span><span class="w">                 </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">465.604901</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">     </span><span class="n">__do_kmalloc_node</span><span class="w">       </span><span class="mf">0.656371295</span><span class="w">           </span><span class="mi">1762220</span><span class="w">               </span><span class="mi">373</span>
<span class="p">[</span><span class="w">  </span><span class="mf">465.614597</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">           </span><span class="n">pcache_miss</span><span class="w">       </span><span class="mf">7.172572671</span><span class="w">            </span><span class="mi">786596</span><span class="w">              </span><span class="mi">9119</span>
<span class="p">[</span><span class="w">  </span><span class="mf">465.624291</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">          </span><span class="n">pcache_flush</span><span class="w">       </span><span class="mf">3.698294960</span><span class="w">            </span><span class="mi">262251</span><span class="w">             </span><span class="mi">14103</span>
<span class="p">[</span><span class="w">  </span><span class="mf">465.633987</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
</code></pre></div></p>
<p>After remove net from pcache flush:
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">684.984000</span><span class="p">]</span><span class="w"> </span><span class="n">Kernel</span><span class="w"> </span><span class="n">Profile</span><span class="w"> </span><span class="n">Points</span>
<span class="p">[</span><span class="w">  </span><span class="mf">684.987683</span><span class="p">]</span><span class="w">  </span><span class="n">status</span><span class="w">                  </span><span class="n">name</span><span class="w">             </span><span class="n">total</span><span class="w">                </span><span class="n">nr</span><span class="w">            </span><span class="n">avg</span><span class="p">.</span><span class="n">ns</span>
<span class="p">[</span><span class="w">  </span><span class="mf">684.997379</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
<span class="p">[</span><span class="w">  </span><span class="mf">685.007074</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">      </span><span class="n">flush_tlb_others</span><span class="w">       </span><span class="mf">0.000000000</span><span class="w">                 </span><span class="mi">0</span><span class="w">                 </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">685.016770</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">     </span><span class="n">__do_kmalloc_node</span><span class="w">       </span><span class="mf">0.627372836</span><span class="w">           </span><span class="mi">1500543</span><span class="w">               </span><span class="mi">419</span>
<span class="p">[</span><span class="w">  </span><span class="mf">685.026464</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">           </span><span class="n">pcache_miss</span><span class="w">       </span><span class="mf">7.128702028</span><span class="w">            </span><span class="mi">786596</span><span class="w">              </span><span class="mi">9063</span>
<span class="p">[</span><span class="w">  </span><span class="mf">685.036159</span><span class="p">]</span><span class="w">     </span><span class="n">off</span><span class="w">          </span><span class="n">pcache_flush</span><span class="w">       </span><span class="mf">3.660772506</span><span class="w">            </span><span class="mi">262251</span><span class="w">             </span><span class="mi">13960</span>
<span class="p">[</span><span class="w">  </span><span class="mf">685.045855</span><span class="p">]</span><span class="w"> </span><span class="o">-------</span><span class="w">  </span><span class="o">--------------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span><span class="w">  </span><span class="o">----------------</span>
</code></pre></div></p>
<p>malloc, miss, flush are too slow. Especially the flush, how can it take 13.9us?</p>
<p>It must be our handlers! lego_copy_to_user stuff.</p>
<h2 id="0406-fri">04/06 Fri<a class="headerlink" href="#0406-fri" title="Permanent link">&para;</a></h2>
<p>Well.
Now we have in-kernel strace, in-kernel readprofile. Yummy.</p>
<h2 id="0405-thur">04/05 Thur<a class="headerlink" href="#0405-thur" title="Permanent link">&para;</a></h2>
<p>Discussion with Yilun.
1. munmap+nr_pgfault figure: count number of pgfaults between munmap, it should be an interesting figure.
2. track number of pgfault at: since there is no eviction, so any mmaped area at M should only have exactly one pcache fetch.
3. I probably want to use per-cpu counter.</p>
<p>Anyway, continue strace work first. Finished.</p>
<h2 id="0404-wed">04/04 Wed<a class="headerlink" href="#0404-wed" title="Permanent link">&para;</a></h2>
<h3 id="strace-performance">STRACE Performance<a class="headerlink" href="#strace-performance" title="Permanent link">&para;</a></h3>
<p>TF has very bad performance. It is either due to the syscall or pcache. Now I&rsquo;m adding facilities to track syscall activities, including average latency, total time.</p>
<p>Basic utilities of strace are done. But I somehow need to change the design of multithread strace. Previously, I naively make the thread group keep some info, and let all other threads use that info to do bookkeeping.</p>
<p>But this is really hard and not accurate. We first need to make sure we are running on a non-preemptable kernel, so the per-cpu time tracking will be accurate. Besides, we also need to make sure threads do not migrate because of syscalls such as sched_setaffinity.</p>
<p>Oh, well, so I though I have to use per-thread strace_info. The first design I thought is: accumulating the counter of one thread to its thread group leader, when it exit. But this is slightly complex, and will affect the thread group leader runtime.</p>
<p>So the second solution I came up is let all threads within a process, chain their straec_info together. And normal thread does not need to accumulate the counter. It can just exit. While the thread group leader exit, it walk through the chain to accumulate the counters. This is simpler. Besides, the strace_info of dead thread is safe. No one will touch it.</p>
<p>Yeh! Let us do this tomorrow. We will have a robust kernel version strace.</p>
<h3 id="sm-heartbeat">SM Heartbeat<a class="headerlink" href="#sm-heartbeat" title="Permanent link">&para;</a></h3>
<p>Continue run some experiments on yesterday&rsquo;s case.</p>
<p>One we sure is SM will keep sending requests to HCA. And it looks like it does not send in a very deterministic interval:
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w"> </span><span class="mf">1224.034898</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">15</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1224.130616</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">15</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1224.222189</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">16</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1224.417181</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">16</span>

<span class="p">[</span><span class="w"> </span><span class="mf">1393.159845</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">17</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1393.255546</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">17</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1393.347132</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">18</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1393.538972</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">18</span>

<span class="p">[</span><span class="w"> </span><span class="mf">1449.437542</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">19</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1449.533248</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">19</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1449.624833</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">20</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1449.722512</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">20</span>

<span class="p">[</span><span class="w"> </span><span class="mf">4322.423624</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">21</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4322.519328</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">21</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4322.610914</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">22</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4322.708594</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">22</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4350.750574</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">23</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4350.846278</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">23</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4350.937863</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">24</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4351.035543</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">24</span>

<span class="p">[</span><span class="w"> </span><span class="mf">4519.690559</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">25</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4519.786262</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">25</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4519.877848</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">26</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4519.975527</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">26</span>

<span class="p">[</span><span class="w"> </span><span class="mf">4576.396279</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">27</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4576.491979</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">27</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4576.583565</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">28</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4576.681245</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">28</span>

<span class="p">[</span><span class="w"> </span><span class="mf">4942.886820</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">29</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4942.982523</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">29</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4943.074108</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2344</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">30</span>
<span class="p">[</span><span class="w"> </span><span class="mf">4943.171789</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2338</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">30</span>
</code></pre></div></p>
<h2 id="0403-tue">04/03 Tue<a class="headerlink" href="#0403-tue" title="Permanent link">&para;</a></h2>
<h3 id="bug-bug-bug">BUG BUG BUG<a class="headerlink" href="#bug-bug-bug" title="Permanent link">&para;</a></h3>
<p>Finished basic replication mechanism last night.</p>
<p>Today merged several patches. And both Yilun and I think there is something wrong with <code>ib_mad_completion_handler</code>. It seems it will break things behind our back.</p>
<p>This is one bug catched today:</p>
<h4 id="ib_mad_completion_handler">ib_mad_completion_handler<a class="headerlink" href="#ib_mad_completion_handler" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">At</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">early</span><span class="w"> </span><span class="n">stage</span><span class="o">:</span>

<span class="p">[</span><span class="w"> </span><span class="mf">1174.406177</span><span class="p">]</span><span class="w"> </span><span class="n">newpid</span><span class="o">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="n">home</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">replica</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1174.452983</span><span class="p">]</span><span class="w"> </span><span class="n">p2m_fork</span><span class="p">(</span><span class="n">cpu10</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">cur</span><span class="o">:</span><span class="mi">20</span><span class="o">-</span><span class="n">exe</span><span class="p">.</span><span class="n">o</span><span class="w"> </span><span class="n">new</span><span class="o">:</span><span class="mi">21</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1177.462795</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2324</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">22</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1177.556502</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">dereference</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mo">0000000000000020</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1177.650101</span><span class="p">]</span><span class="w"> </span><span class="n">IP</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81059104</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="o">+</span><span class="mh">0xb4</span><span class="o">/</span><span class="mh">0x8a0</span>

<span class="p">.</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">faddr2line</span><span class="w"> </span><span class="n">vmImage</span><span class="w">  </span><span class="n">ib_mad_completion_handler</span><span class="o">+</span><span class="mh">0xb4</span>
<span class="n">ib_mad_completion_handler</span><span class="o">+</span><span class="mh">0xb4</span><span class="o">/</span><span class="mh">0x899</span><span class="o">:</span>
<span class="n">ib_mad_recv_done_handler</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">drivers</span><span class="o">/</span><span class="n">infiniband</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">mad</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">1899</span>
<span class="w"> </span><span class="p">(</span><span class="n">inlined</span><span class="w"> </span><span class="n">by</span><span class="p">)</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">drivers</span><span class="o">/</span><span class="n">infiniband</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">mad</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">2325</span>

<span class="n">ib_mad_recv_done_handler</span><span class="p">()</span><span class="o">:</span>
<span class="mi">1899</span><span class="o">:</span><span class="w"> </span><span class="n">qp_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mad_list</span><span class="o">-&gt;</span><span class="n">mad_queue</span><span class="o">-&gt;</span><span class="n">qp_info</span><span class="p">;</span>
</code></pre></div>
<p>A more scared one after I changed ib_mad_completion_handler. Note that recvcq is the only thread running on cpu4:
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">863.887705</span><span class="p">]</span><span class="w"> </span><span class="n">p2m_fork</span><span class="p">(</span><span class="n">cpu10</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">cur</span><span class="o">:</span><span class="mi">20</span><span class="o">-</span><span class="n">exe</span><span class="p">.</span><span class="n">o</span><span class="w"> </span><span class="n">new</span><span class="o">:</span><span class="mi">21</span>
<span class="p">[</span><span class="w">  </span><span class="mf">868.478424</span><span class="p">]</span><span class="w"> </span><span class="n">p2m_fork</span><span class="p">(</span><span class="n">cpu10</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">O</span><span class="w"> </span><span class="n">succeed</span><span class="w"> </span><span class="n">cur</span><span class="o">:</span><span class="mi">20</span><span class="o">-</span><span class="n">exe</span><span class="p">.</span><span class="n">o</span><span class="w"> </span><span class="n">new</span><span class="o">:</span><span class="mi">21</span>
<span class="p">[</span><span class="w">  </span><span class="mf">868.541991</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">dereference</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mo">000000000000000</span><span class="mi">8</span>
<span class="p">[</span><span class="w">  </span><span class="mf">868.635569</span><span class="p">]</span><span class="w"> </span><span class="n">IP</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810656d4</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">__schedule</span><span class="o">+</span><span class="mh">0x94</span><span class="o">/</span><span class="mh">0x1e0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">868.701090</span><span class="p">]</span><span class="w"> </span><span class="n">PGD</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">868.725010</span><span class="p">]</span><span class="w"> </span><span class="n">general</span><span class="w"> </span><span class="n">protection</span><span class="w"> </span><span class="n">fault</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="p">[</span><span class="err">#</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">SMP</span><span class="w"> </span><span class="n">PROCESSOR</span>
<span class="p">[</span><span class="w">  </span><span class="mf">868.793651</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">recvpollcq</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">-</span><span class="n">ys</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">737</span>

<span class="nl">Source</span><span class="p">:</span>
<span class="n">clear_tsk_need_resched</span><span class="p">(</span><span class="n">prev</span><span class="p">);</span>
</code></pre></div></p>
<p>Even this one for Phoenix:
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">763.442043</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">dereference</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mo">0000000000000010</span>
<span class="p">[</span><span class="w">  </span><span class="mf">763.535636</span><span class="p">]</span><span class="w"> </span><span class="n">IP</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81018d6f</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">task_curr</span><span class="o">+</span><span class="mh">0xf</span><span class="o">/</span><span class="mh">0x30</span>
<span class="p">[</span><span class="w">  </span><span class="mf">763.598035</span><span class="p">]</span><span class="w"> </span><span class="n">PGD</span><span class="w"> </span><span class="mf">103e956067</span><span class="w"> </span><span class="n">PUD</span><span class="w"> </span><span class="mf">103e964067</span><span class="w"> </span><span class="n">PMD</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">763.653154</span><span class="p">]</span><span class="w"> </span><span class="n">Oops</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="p">[</span><span class="err">#</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">SMP</span><span class="w"> </span><span class="n">PROCESSOR</span>
<span class="p">[</span><span class="w">  </span><span class="mf">763.700992</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">word_count</span><span class="o">-</span><span class="n">pthr</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">-</span><span class="n">ys</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">740</span>
<span class="p">[</span><span class="w">  </span><span class="mf">763.777950</span><span class="p">]</span><span class="w"> </span><span class="n">RIP</span><span class="o">:</span><span class="w"> </span><span class="mo">0010</span><span class="o">:</span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81018d6f</span><span class="o">&gt;</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81018d6f</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">task_curr</span><span class="o">+</span><span class="mh">0xf</span><span class="o">/</span><span class="mh">0x30</span>
</code></pre></div></p>
<p>This NEVER happen before. And this part of code should be correct. We&rsquo;ve ran a
lot things.. I doubt if recent IB merge corrupt things.</p>
<h4 id="fit_poll_cq">fit_poll_cq<a class="headerlink" href="#fit_poll_cq" title="Permanent link">&para;</a></h4>
<p>Another one:
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">690.401626</span><span class="p">]</span><span class="w"> </span><span class="n">stat</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">ys</span><span class="o">/</span><span class="n">phoenix</span><span class="o">/</span><span class="n">phoenix</span><span class="mf">-2.0</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">word_count</span><span class="o">/</span><span class="n">word_count_datafiles</span><span class="o">/</span><span class="n">word_1GB</span><span class="p">.</span><span class="n">txt</span>
<span class="p">[</span><span class="w">  </span><span class="mf">690.507742</span><span class="p">]</span><span class="w"> </span><span class="n">SYSC_close</span><span class="p">()</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="mi">21</span><span class="w"> </span><span class="p">[</span><span class="n">fd</span><span class="o">:</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">devices</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">cpu</span><span class="o">/</span><span class="n">online</span><span class="p">]</span>
<span class="p">[</span><span class="w">  </span><span class="mf">713.899884</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2337</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">21</span>
<span class="p">[</span><span class="w">  </span><span class="mf">713.995606</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2331</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">21</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.087185</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2337</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">22</span>
<span class="p">[</span><span class="w">  </span><span class="mf">714.184871</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2331</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">22</span>
<span class="p">[</span><span class="w">  </span><span class="mf">742.078102</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2337</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">23</span>
<span class="p">[</span><span class="w">  </span><span class="mf">742.173810</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2331</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">23</span>
<span class="p">[</span><span class="w">  </span><span class="mf">742.265399</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2337</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">24</span>
<span class="p">[</span><span class="w">  </span><span class="mf">742.363085</span><span class="p">]</span><span class="w"> </span><span class="n">ib_mad_completion_handler</span><span class="w"> </span><span class="mi">2331</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">mad_got_one</span><span class="w"> </span><span class="mi">24</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.063372</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">21</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.116511</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.170590</span><span class="p">]</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="mi">12</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.230909</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.284988</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.339067</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.393146</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">1832</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.457624</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">1833</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.522103</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">Recv</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="mi">-1</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.589701</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">1834</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.654179</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">Recv</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="mi">-30704</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.725938</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">1835</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.790416</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">Recv</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="mi">-30704</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.862174</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.916252</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="w">  </span><span class="mf">847.970331</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.024410</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.078490</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">1836</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.142967</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">1837</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.207446</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">Recv</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="mi">-1</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.275044</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">1838</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.339523</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">Recv</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="mi">-30704</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.411281</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">1839</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.475760</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">Recv</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="mi">-30704</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.547517</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.601596</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.655675</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.709753</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.763832</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">1840</span>

<span class="p">[</span><span class="w">  </span><span class="mf">848.828313</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">dereference</span><span class="w"> </span><span class="n">at</span><span class="w">           </span><span class="p">(</span><span class="n">null</span><span class="p">)</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.921908</span><span class="p">]</span><span class="w"> </span><span class="n">IP</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8106346d</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">+</span><span class="mh">0x4ad</span><span class="o">/</span><span class="mh">0x510</span>
<span class="p">[</span><span class="w">  </span><span class="mf">848.989507</span><span class="p">]</span><span class="w"> </span><span class="n">PGD</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">849.013426</span><span class="p">]</span><span class="w"> </span><span class="n">Oops</span><span class="o">:</span><span class="w"> </span><span class="mo">0002</span><span class="w"> </span><span class="p">[</span><span class="err">#</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">SMP</span><span class="w"> </span><span class="n">PROCESSOR</span>
<span class="p">[</span><span class="w">  </span><span class="mf">849.061265</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">recvpollcq</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">-</span><span class="n">ys</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">744</span>
<span class="p">[</span><span class="w">  </span><span class="mf">849.131983</span><span class="p">]</span><span class="w"> </span><span class="n">RIP</span><span class="o">:</span><span class="w"> </span><span class="mo">0010</span><span class="o">:</span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8106346d</span><span class="o">&gt;</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8106346d</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">+</span><span class="mh">0x4ad</span><span class="o">/</span><span class="mh">0x510</span>
<span class="p">[</span><span class="w">  </span><span class="mf">849.228700</span><span class="p">]</span><span class="w"> </span><span class="n">RSP</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="o">:</span><span class="n">ffff88103e813d88</span><span class="w">  </span><span class="n">EFLAGS</span><span class="o">:</span><span class="w"> </span><span class="mo">00010246</span>
<span class="p">[</span><span class="w">  </span><span class="mf">849.292139</span><span class="p">]</span><span class="w"> </span><span class="n">RAX</span><span class="o">:</span><span class="w"> </span><span class="mo">000000000000100</span><span class="mi">8</span><span class="w"> </span><span class="n">RBX</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103effbad0</span><span class="w"> </span><span class="n">RCX</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">849.377418</span><span class="p">]</span><span class="w"> </span><span class="n">RDX</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">RSI</span><span class="o">:</span><span class="w"> </span><span class="n">ffffffff811d46e0</span><span class="w"> </span><span class="n">RDI</span><span class="o">:</span><span class="w"> </span><span class="n">ffffffff811dbc08</span>
<span class="p">[</span><span class="w">  </span><span class="mf">849.462695</span><span class="p">]</span><span class="w"> </span><span class="n">RBP</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103e813ea8</span><span class="w"> </span><span class="n">R08</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">R09</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">849.547973</span><span class="p">]</span><span class="w"> </span><span class="n">R10</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000002</span><span class="w"> </span><span class="n">R11</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000004</span><span class="w"> </span><span class="n">R12</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">849.633251</span><span class="p">]</span><span class="w"> </span><span class="n">R13</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103e801008</span><span class="w"> </span><span class="n">R14</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000004</span><span class="w"> </span><span class="n">R15</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103e813da0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">849.718529</span><span class="p">]</span><span class="w"> </span><span class="n">FS</span><span class="o">:</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span><span class="w"> </span><span class="n">GS</span><span class="o">:</span><span class="n">ffff88107fc40000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span><span class="w"> </span><span class="n">knlGS</span><span class="o">:</span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">849.815246</span><span class="p">]</span><span class="w"> </span><span class="n">CS</span><span class="o">:</span><span class="w">  </span><span class="mo">0010</span><span class="w"> </span><span class="n">DS</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="n">ES</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="n">CR0</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000</span><span class="mi">80050033</span>
<span class="p">[</span><span class="w">  </span><span class="mf">849.883884</span><span class="p">]</span><span class="w"> </span><span class="n">CR2</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">CR3</span><span class="o">:</span><span class="w"> </span><span class="mo">000000000113</span><span class="n">d000</span><span class="w"> </span><span class="n">CR4</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000000406</span><span class="n">a0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">849.969163</span><span class="p">]</span><span class="w"> </span><span class="n">Stack</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">849.993082</span><span class="p">]</span><span class="w"> </span><span class="n">ffffffff81003299</span><span class="w"> </span><span class="mo">000001</span><span class="n">b03e813da0</span><span class="w"> </span><span class="mo">0000000000000004</span><span class="w"> </span><span class="mo">0000000000000730</span>
<span class="p">[</span><span class="w">  </span><span class="mf">850.080440</span><span class="p">]</span><span class="w"> </span><span class="mo">000000</span><span class="mi">8100000005</span><span class="w"> </span><span class="mf">00001008000000f</span><span class="mi">9</span><span class="w"> </span><span class="n">ffff88103eff8c50</span><span class="w"> </span><span class="mo">002</span><span class="n">c222040000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">850.167798</span><span class="p">]</span><span class="w"> </span><span class="mo">0010004000000002</span><span class="w"> </span><span class="n">ffff88107fc20000</span><span class="w"> </span><span class="mo">0000000000000731</span><span class="w"> </span><span class="n">ffffffff00000005</span>
<span class="p">[</span><span class="w">  </span><span class="mf">850.255156</span><span class="p">]</span><span class="w"> </span><span class="n">ffff8810000000f9</span><span class="w"> </span><span class="n">ffff88103eff8c50</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">ffff88103e813e38</span>
<span class="p">[</span><span class="w">  </span><span class="mf">850.342513</span><span class="p">]</span><span class="w"> </span><span class="n">ffffffff81019854</span><span class="w"> </span><span class="mo">0000000000000732</span><span class="w"> </span><span class="n">ffff881000000005</span><span class="w"> </span><span class="n">ffff8810000000f9</span>
<span class="p">[</span><span class="w">  </span><span class="mf">850.429871</span><span class="p">]</span><span class="w"> </span><span class="n">Call</span><span class="w"> </span><span class="n">Trace</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">850.458992</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span><span class="w">  </span><span class="mf">850.481870</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81003299</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">native_smp_send_reschedule</span><span class="o">+</span><span class="mh">0x39</span><span class="o">/</span><span class="mh">0x50</span>
<span class="p">[</span><span class="w">  </span><span class="mf">850.560909</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81019854</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">try_to_wake_up</span><span class="o">+</span><span class="mh">0xe4</span><span class="o">/</span><span class="mh">0x1f0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">850.628506</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81065708</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">__schedule</span><span class="o">+</span><span class="mh">0xf8</span><span class="o">/</span><span class="mh">0x1e0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">850.691945</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810634d0</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">+</span><span class="mh">0x510</span><span class="o">/</span><span class="mh">0x510</span>
<span class="p">[</span><span class="w">  </span><span class="mf">850.757464</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810634e4</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq_pass</span><span class="o">+</span><span class="mh">0x14</span><span class="o">/</span><span class="mh">0x30</span>
<span class="p">[</span><span class="w">  </span><span class="mf">850.824021</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81020636</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">kthread</span><span class="o">+</span><span class="mh">0xf6</span><span class="o">/</span><span class="mh">0x120</span>
<span class="p">[</span><span class="w">  </span><span class="mf">850.882260</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81020540</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">__kthread_parkme</span><span class="o">+</span><span class="mh">0x70</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="w">  </span><span class="mf">850.950898</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e572</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">ret_from_fork</span><span class="o">+</span><span class="mh">0x22</span><span class="o">/</span><span class="mh">0x30</span>

<span class="cm">/* handle normal reply */</span>
<span class="p">...</span>
<span class="n">memcpy</span><span class="p">((</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">ctx</span><span class="o">-&gt;</span><span class="n">reply_ready_indicators</span><span class="p">[</span><span class="n">reply_indicator_index</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
<span class="p">...</span>
<span class="p">(</span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">memcpy</span><span class="o">:</span><span class="w"> </span><span class="n">reply_indicator_index</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">checked</span><span class="p">.)</span>
</code></pre></div></p>
<h3 id="ib-spec-qp-cqe-wqe-send">IB Spec: QP, CQE, WQE, SEND<a class="headerlink" href="#ib-spec-qp-cqe-wqe-send" title="Permanent link">&para;</a></h3>
<p>The channel adapter detects the WQE posting and accesses the WQE.
The channel adapter interprets the command, validates the WQE’s virtual 12
addresses, translates it to physical addresses, and accesses the data.
The outgoing message buffer is split into one or more packets. To each packet the channel adapter adds a transport header (sequence numbers, opcode, etc.). If the destination resides on a remote subnet the channel adapter adds a network header (source &amp; destination GIDs). The channel adapter then adds the local route header and calculates both the variant
and invariant checksums.</p>
<p>For a Send operation, the QP retrieves the address of
the receive buffer from the next WQE on its receive queue, translates it to physical addresses, and accesses memory writing the data. If this is not
the last packet of the message, the QP saves the current write location in 38 its context and waits for the next packet at which time it continues writing
the receive buffer until it receives a packet that indicates it is the last packet of the operation. It then updates the receive WQE, retires it, and sends an acknowledge message to the originator.</p>
<p>When the originator receives an acknowledgment, it creates a CQE on the 5
CQ and retires the WQE from the send queue.</p>
<p>A QP can have multiple outstanding messages at any one time but the 8
target always acknowledges in the order sent, thus WQEs are retired in the order that they are posted.</p>
<h2 id="0402-mon">04/02 Mon<a class="headerlink" href="#0402-mon" title="Permanent link">&para;</a></h2>
<p>Patching storage replica handler, able to finish today.</p>
<h2 id="0401-sun">04/01 Sun<a class="headerlink" href="#0401-sun" title="Permanent link">&para;</a></h2>
<p>Anyway. Summary of the day: replication at M almost done. Only flush part left. Storage also need a handler. But we still need code to recover.</p>
<p>I&rsquo;m tired. :-( A month to go.</p>
<p>Record a IB error. Using wuklab12 (P) and wuklab14(M+RAMFS), running usr/pcache_conflic.o:
<div class="highlight"><pre><span></span><code><span class="n">P</span>
<span class="p">[</span><span class="mf">30801.296160</span><span class="p">]</span><span class="w"> </span><span class="n">ibapi_send_reply</span><span class="p">()</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="mi">8</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="mi">19</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="p">(</span><span class="mi">30010</span><span class="w"> </span><span class="n">ms</span><span class="p">),</span><span class="w"> </span><span class="n">caller</span><span class="o">:</span><span class="w"> </span><span class="n">clflush_one</span><span class="o">+</span><span class="mh">0x1c9</span><span class="o">/</span><span class="mh">0x370</span>
<span class="p">[</span><span class="mf">30938.564843</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">21</span>
<span class="p">[</span><span class="mf">30938.617988</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="mf">30938.672068</span><span class="p">]</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="mi">12</span>
<span class="p">[</span><span class="mf">30938.732389</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="mf">30938.786470</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="mf">30938.840551</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="mf">30938.894632</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">1584</span>
<span class="p">[</span><span class="mf">30938.959112</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">1585</span>
<span class="p">[</span><span class="mf">30939.023593</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">Recv</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="mi">-1</span>
<span class="p">[</span><span class="mf">30939.091194</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">1586</span>
<span class="p">[</span><span class="mf">30939.155676</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">Recv</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="mi">-30704</span>
<span class="p">[</span><span class="mf">30939.227436</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">1587</span>
<span class="p">[</span><span class="mf">30939.291917</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">Recv</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="mi">-30704</span>
<span class="p">[</span><span class="mf">30939.363678</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="mf">30939.417759</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="mf">30939.471839</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="mf">30939.525921</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="mf">30939.580002</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">1588</span>
<span class="p">[</span><span class="mf">30939.644483</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">dereference</span><span class="w"> </span><span class="n">at</span><span class="w">           </span><span class="p">(</span><span class="n">null</span><span class="p">)</span>
<span class="p">[</span><span class="mf">30939.738083</span><span class="p">]</span><span class="w"> </span><span class="n">IP</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81062fcd</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">+</span><span class="mh">0x4ad</span><span class="o">/</span><span class="mh">0x510</span>
<span class="p">[</span><span class="mf">30939.805684</span><span class="p">]</span><span class="w"> </span><span class="n">PGD</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="mf">30939.829604</span><span class="p">]</span><span class="w"> </span><span class="n">Oops</span><span class="o">:</span><span class="w"> </span><span class="mo">0002</span><span class="w"> </span><span class="p">[</span><span class="err">#</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">SMP</span><span class="w"> </span><span class="n">PROCESSOR</span>
<span class="p">[</span><span class="mf">30939.877445</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">recvpollcq</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">-</span><span class="n">ys</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">715</span>
<span class="p">[</span><span class="mf">30939.948166</span><span class="p">]</span><span class="w"> </span><span class="n">RIP</span><span class="o">:</span><span class="w"> </span><span class="mo">0010</span><span class="o">:</span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81062fcd</span><span class="o">&gt;</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81062fcd</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">+</span><span class="mh">0x4ad</span><span class="o">/</span><span class="mh">0x510</span>

<span class="n">fit_poll_cq</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">net</span><span class="o">/</span><span class="n">lego</span><span class="o">/</span><span class="n">fit_internal</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">1734</span>
<span class="n">memcpy</span><span class="p">((</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">ctx</span><span class="o">-&gt;</span><span class="n">reply_ready_indicators</span><span class="p">[</span><span class="n">reply_indicator_index</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>

<span class="n">M</span>
<span class="p">[</span><span class="mf">30913.642698</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">21</span>
<span class="p">[</span><span class="mf">30913.695839</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="mf">30913.749919</span><span class="p">]</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="mi">12</span>
<span class="p">[</span><span class="mf">30913.810236</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="mf">30913.864315</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="mf">30913.918395</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_handle_error_cqe</span><span class="w"> </span><span class="n">syndrome</span><span class="w"> </span><span class="mi">5</span>
<span class="p">[</span><span class="mf">30913.972474</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">305</span>
<span class="p">[</span><span class="mf">30914.035912</span><span class="p">]</span><span class="w"> </span><span class="n">fit_poll_cq</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">wr_id</span><span class="w"> </span><span class="mi">306</span>
</code></pre></div></p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">May 4, 2018</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["instant", "tabs", "navigation.tabs", "navigation.tabs.sticky", "navigation.top"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>