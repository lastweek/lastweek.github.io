
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Yizhou Shan">
      
      
        <link rel="canonical" href="http://lastweek.io/lego/log/log-08-2018/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>Aug 2018 - Yizhou Shan's Home Page</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Courier+Prime+Bold:300,300i,400,400i,700,700i%7CCourier+Prime+Bold:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Courier Prime Bold";--md-code-font:"Courier Prime Bold"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#aug-2018" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Yizhou Shan&#39;s Home Page" class="md-header__button md-logo" aria-label="Yizhou Shan's Home Page" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Yizhou Shan's Home Page
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Aug 2018
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/lastweek/lastweek.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81s-5.7.083-8.4 1.11c-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.1 18.1 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3s9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../notes/ssd/" class="md-tabs__link">
          
  
  Notes

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../notes/source_code/summary/" class="md-tabs__link">
          
  
  Code

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../fpga/bitstream/" class="md-tabs__link">
          
  
  FPGA

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../misc/" class="md-tabs__link">
          
  
  LegoOS

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Yizhou Shan&#39;s Home Page" class="md-nav__button md-logo" aria-label="Yizhou Shan's Home Page" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Yizhou Shan's Home Page
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lastweek/lastweek.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81s-5.7.083-8.4 1.11c-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.1 18.1 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3s9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Notes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/ssd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSD 101
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/CXL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is CXL?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/MLIR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is MLIR?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/virt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modern Virtualization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/cache_coherence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practical Cache Coherence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/resource-disaggregation-spectrum/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resource Disaggregation Design Spectrums
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/dist-xact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distributed Transactions and Databases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/dynamic_linking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dynamic Linking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/dcn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Center Networking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/packet-sched/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Switch Buffering and Packet Scheduling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/sysml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SysML
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/arch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/cryptography/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cryptography
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/cryptocurrency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cryptocurrency
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/hardware_pl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hardware Design Languages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/paper_perf_shadows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performance-Shadows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/essential/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Essential
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cheatsheet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/20200404-on-read-once/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    On Read Once and Compiler Optimization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Code
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Code
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linux
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-function-trace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Dump Function Graph
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/fork/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux fork/switch_to
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-rcu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux RCU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-completion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Completion/swait
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-workqueue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux workqueue
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-linker-script/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Linker Script
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-boot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Boot Sequence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/trace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Trace and Profile
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/rmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Reverse Mapping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/userfaultfd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Userfaultfd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/cgroup-swap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Cgroup and Swap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/xperf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux x86 Ring Switch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-x86-fpu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux FPU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-iouring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux io_uring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/linux-resource/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Resource
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/proc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Special Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/kvm-basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux KVM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/linux/rust.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Rust
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Go
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Go
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/go/golang/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learn Go
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/go/gvisor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gVisor
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Rust
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Rust
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/rust/rust/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learn Rust
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/rust/firecracker.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Firecracker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/rdma/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DPDK and RDMA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/program_advice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guideline & Advice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/firmware-softwares/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Firmware & Bootloader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/os/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Operating System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/compilers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compilers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/unix-tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unix Tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/virt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtualization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/20200501-on-graphic-softwares/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Graphics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/gpu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/fpga/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FPGA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/risc-v/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RISC-V
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/dotconfigs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dot-Configs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/source_code/misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Misc
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    FPGA
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            FPGA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fpga/bitstream/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bitstream Explained
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/paper_fpga/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Papers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fpga/language/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Languages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fpga/vivado/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vivado Notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fpga/setup_hold/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup and Hold Time
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fpga/pr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Partial Reconfiguration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    LegoOS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            LegoOS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Log
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Log
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MISC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../test-note/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Script
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kernel
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Kernel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/boot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GRUB2 and Boot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/kconfig/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kconfig
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/debug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/grub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GRUB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/profile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profile
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/profile_strace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profile strace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/profile_heatmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profile heatmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/profile_points/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profile points
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/trampoline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trampoline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/pagefault_disable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disable pgfault
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/stop_machine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stop machine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/loader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Program Loader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/vDSO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vDSO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/vfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtual File System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/vm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Process Virtual Memory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/fpu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    x86 FPU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/irq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IRQ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/net_thpool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Thpool
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Syscall
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Syscall
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../syscall/facts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Facts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kernel/profile_strace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profile strace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../syscall/compat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    compat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../syscall/msync/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    msync()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../syscall/mremap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mremap()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../syscall/fork/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fork()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../syscall/getrusage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    getrusage()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../syscall/wait_and_exit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    wait4 and exit()
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pcache
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Pcache
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/sweep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sweep
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/tlb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TLB Coherence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/pgtable-lock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PageTable Lock
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/victim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Victim Cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/virtual_cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtual Cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/rmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reverse Mapping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/evict_and_ref/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evict and Refcount
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/smp_design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SMP Design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pcache/replication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Replication
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Driver
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Driver
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../driver/pci/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PCI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../driver/ib/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infiniband
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Paper
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Paper
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/nmp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NMP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/processor_oom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Processor OOM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/genz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gen-Z
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/replication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Replication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/related/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Related
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aug-31" class="md-nav__link">
    <span class="md-ellipsis">
      Aug 31
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aug 31">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#one-major-todo" class="md-nav__link">
    <span class="md-ellipsis">
      One major TODO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ugh" class="md-nav__link">
    <span class="md-ellipsis">
      Ugh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#try-max_send_wr-and-number-of-qps" class="md-nav__link">
    <span class="md-ellipsis">
      Try max_send_wr and number of QPs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#after-victim-bug-fix" class="md-nav__link">
    <span class="md-ellipsis">
      After Victim bug fix
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aug-30" class="md-nav__link">
    <span class="md-ellipsis">
      Aug 30
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aug 30">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identified-victim-bug" class="md-nav__link">
    <span class="md-ellipsis">
      Identified victim bug.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#after-adding-pi_lock" class="md-nav__link">
    <span class="md-ellipsis">
      After adding pi_lock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rq-lock-deadlock" class="md-nav__link">
    <span class="md-ellipsis">
      rq-&gt;lock deadlock
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aug-29" class="md-nav__link">
    <span class="md-ellipsis">
      Aug 29
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aug-27" class="md-nav__link">
    <span class="md-ellipsis">
      Aug 27
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aug-26" class="md-nav__link">
    <span class="md-ellipsis">
      Aug 26
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aug-22" class="md-nav__link">
    <span class="md-ellipsis">
      Aug 22
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="aug-2018">Aug 2018<a class="headerlink" href="#aug-2018" title="Permanent link">&para;</a></h1>
<h2 id="aug-31">Aug 31<a class="headerlink" href="#aug-31" title="Permanent link">&para;</a></h2>
<h3 id="one-major-todo">One major TODO<a class="headerlink" href="#one-major-todo" title="Permanent link">&para;</a></h3>
<p>Check <code>do_handle_p2m_pcache_miss()</code>. We MUST remove that mempcy, maybe by using another flag in thpool. This is just no acceptable.</p>
<h3 id="ugh">Ugh<a class="headerlink" href="#ugh" title="Permanent link">&para;</a></h3>
<p>Fuck. Without debug_mm, there is still memory corruption.</p>
<h3 id="try-max_send_wr-and-number-of-qps">Try max_send_wr and number of QPs<a class="headerlink" href="#try-max_send_wr-and-number-of-qps" title="Permanent link">&para;</a></h3>
<p>without lock_ib, with debug_mm.
Change max_send_wr at all P M S.</p>
<ul>
<li>QP=4, max_send_wr = 1: always fail</li>
<li>QP=4, max_send_wr = 256: always fail</li>
<li>QP=24, max_send_wr = 1: succeed (0831-w14-18 0831-w14-20)</li>
<li>QP=24, max_send_wr = 256: succeed (0831-w14-16 0831-w14-17)</li>
</ul>
<p>Pay attention to the <code>0831-w14-15</code>： something wrong with our timekeeping code? QP=24, max_send_wr = 1 case.</p>
<h3 id="after-victim-bug-fix">After Victim bug fix<a class="headerlink" href="#after-victim-bug-fix" title="Permanent link">&para;</a></h3>
<p>MNIST 4 threads</p>
<ul>
<li>With lock_ib, debug_mm etc: 3 successful runs</li>
<li>Only with debug_mm: Well fit failed. Lost CQE.</li>
</ul>
<p>Now the debug scope is limited. Let me try the micro test suite, to stress ibapi_send_reply itself.</p>
<p>Potential: read/write buffer.</p>
<h2 id="aug-30">Aug 30<a class="headerlink" href="#aug-30" title="Permanent link">&para;</a></h2>
<p>Be humble.</p>
<h3 id="identified-victim-bug">Identified victim bug.<a class="headerlink" href="#identified-victim-bug" title="Permanent link">&para;</a></h3>
<p>Finally. I thought it through, and with the help of this <code>0830-w14-12</code>.
The bug is in <code>victim_try_fill_pcache()</code>, when there are multiple hits to the same victim. Since we released the <code>usable_victim_lock</code> after a hit. There might a be race case where: 1) CPU0 reached <code>dec_and_test_filling</code>, and passed to free the line. 2) CPU1 just got to the <code>victim_check_hit</code>, and increment the fill counter to 1 again. When CPU1 finished filling, and do <code>dec_and_test_filling</code>, it will do the free again!!! What a double free.</p>
<p>Tomorrow, let me do the fix. Thought: adding more sync in victim_check_hit part. Basically we want to ensure only one CPU can do the final free.</p>
<h3 id="after-adding-pi_lock">After adding pi_lock<a class="headerlink" href="#after-adding-pi_lock" title="Permanent link">&para;</a></h3>
<p>Okay. the pi_lock is added. Although it is mostly used by futex-pi and rt-mutex, we lego does not have these two guys. Therefore, it is only used by sched/core.c, exit.c, and kthread.c. 99% is in core.c</p>
<p>The purpose of having this back is to have the <code>spin_lock_irqsave(&amp;p-&gt;pi_lock)</code> back. Most scheduling code is not recursive, we have to disable interrupt. Of course we can use <code>spin_lock_irqsave(&amp;rq-&gt;lock)</code> instead of <code>spin_lock(&amp;rq-&gt;lock)</code>. But this is too dangerous at this stage. Porting based on Linux now is the fastest and safest way.</p>
<p><strong>The importance of disabling interrupt in some kernel path!!</strong></p>
<p>Good. Now I&rsquo;m seeing now debuggable victim issue.</p>
<p>Classical deadlock catched. Now, only two victims.</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w"> </span><span class="mf">2819.068997</span><span class="p">]</span><span class="w"> </span><span class="n">CPU14</span><span class="w"> </span><span class="n">PID29</span><span class="w"> </span><span class="n">Abort</span><span class="w"> </span><span class="n">victim</span><span class="w"> </span><span class="n">alloc</span><span class="w"> </span><span class="p">(</span><span class="mi">20010</span><span class="n">ms</span><span class="p">)</span><span class="w"> </span><span class="n">nr_usable_victims</span><span class="o">:</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">From</span><span class="w"> </span><span class="n">pset_idx</span><span class="o">:</span><span class="mi">532</span><span class="w"> </span><span class="n">nr_lru</span><span class="o">:</span><span class="mi">63</span><span class="w"> </span><span class="n">fault_uva</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7fff98614000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.094409</span><span class="p">]</span><span class="w"> </span><span class="n">CPU14</span><span class="w"> </span><span class="n">PID29</span><span class="w">   </span><span class="o">--</span><span class="w">   </span><span class="n">Start</span><span class="w"> </span><span class="n">Dump</span><span class="w"> </span><span class="n">Victim</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">total</span><span class="o">:</span><span class="w"> </span><span class="mi">2</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.114188</span><span class="p">]</span><span class="w"> </span><span class="n">CPU14</span><span class="w"> </span><span class="n">PID29</span><span class="w">  </span><span class="n">victim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">:</span><span class="n">ffffffff810c2880</span><span class="w"> </span><span class="n">refcount</span><span class="o">:</span><span class="mi">2</span><span class="w"> </span><span class="n">nr_fill</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">max_fill</span><span class="o">:</span><span class="mi">4</span><span class="w"> </span><span class="n">locked</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">:</span><span class="p">(</span><span class="mh">0x14e</span><span class="p">)(</span><span class="n">allocated</span><span class="o">|</span><span class="n">usable</span><span class="o">|</span><span class="n">hasdata</span><span class="o">|</span><span class="n">flushed</span><span class="o">|</span><span class="n">fillfree</span><span class="p">)</span><span class="w"> </span><span class="n">pcm</span><span class="o">:</span><span class="w">          </span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.133289</span><span class="p">]</span><span class="w"> </span><span class="n">CPU14</span><span class="w"> </span><span class="n">PID29</span><span class="w">     </span><span class="n">hit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">owner</span><span class="o">:</span><span class="mi">21</span><span class="w"> </span><span class="n">m_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">rep_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7fffcc000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.141723</span><span class="p">]</span><span class="w"> </span><span class="n">CPU14</span><span class="w"> </span><span class="n">PID29</span><span class="w">     </span><span class="n">rmap</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span><span class="w"> </span><span class="n">set_idx</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">nr_lru</span><span class="o">:</span><span class="mi">63</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.149770</span><span class="p">]</span><span class="w"> </span><span class="n">CPU14</span><span class="w"> </span><span class="n">PID29</span><span class="w">  </span><span class="n">victim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span><span class="n">ffffffff810c2900</span><span class="w"> </span><span class="n">refcount</span><span class="o">:</span><span class="mi">2</span><span class="w"> </span><span class="n">nr_fill</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">max_fill</span><span class="o">:</span><span class="mi">4</span><span class="w"> </span><span class="n">locked</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">:</span><span class="p">(</span><span class="mh">0x14e</span><span class="p">)(</span><span class="n">allocated</span><span class="o">|</span><span class="n">usable</span><span class="o">|</span><span class="n">hasdata</span><span class="o">|</span><span class="n">flushed</span><span class="o">|</span><span class="n">fillfree</span><span class="p">)</span><span class="w"> </span><span class="n">pcm</span><span class="o">:</span><span class="w">          </span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.168870</span><span class="p">]</span><span class="w"> </span><span class="n">CPU14</span><span class="w"> </span><span class="n">PID29</span><span class="w">     </span><span class="n">hit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">owner</span><span class="o">:</span><span class="mi">21</span><span class="w"> </span><span class="n">m_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">rep_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7fffb0000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.177306</span><span class="p">]</span><span class="w"> </span><span class="n">CPU14</span><span class="w"> </span><span class="n">PID29</span><span class="w">     </span><span class="n">rmap</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span><span class="w"> </span><span class="n">set_idx</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">nr_lru</span><span class="o">:</span><span class="mi">63</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.185352</span><span class="p">]</span><span class="w"> </span><span class="n">CPU14</span><span class="w"> </span><span class="n">PID29</span><span class="w">   </span><span class="o">--</span><span class="w">   </span><span class="n">End</span><span class="w"> </span><span class="n">Dump</span><span class="w"> </span><span class="n">Victim</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="p">[</span><span class="w"> </span><span class="mf">2819.081708</span><span class="p">]</span><span class="w"> </span><span class="n">CPU16</span><span class="w"> </span><span class="n">PID30</span><span class="w"> </span><span class="n">Abort</span><span class="w"> </span><span class="n">victim</span><span class="w"> </span><span class="n">alloc</span><span class="w"> </span><span class="p">(</span><span class="mi">20010</span><span class="n">ms</span><span class="p">)</span><span class="w"> </span><span class="n">nr_usable_victims</span><span class="o">:</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">From</span><span class="w"> </span><span class="n">pset_idx</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">nr_lru</span><span class="o">:</span><span class="mi">63</span><span class="w"> </span><span class="n">fault_uva</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7fffcc000024</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.209008</span><span class="p">]</span><span class="w"> </span><span class="n">CPU16</span><span class="w"> </span><span class="n">PID30</span><span class="w">   </span><span class="o">--</span><span class="w">   </span><span class="n">Start</span><span class="w"> </span><span class="n">Dump</span><span class="w"> </span><span class="n">Victim</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">total</span><span class="o">:</span><span class="w"> </span><span class="mi">2</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.223358</span><span class="p">]</span><span class="w"> </span><span class="n">CPU16</span><span class="w"> </span><span class="n">PID30</span><span class="w">  </span><span class="n">victim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">:</span><span class="n">ffffffff810c2880</span><span class="w"> </span><span class="n">refcount</span><span class="o">:</span><span class="mi">2</span><span class="w"> </span><span class="n">nr_fill</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">max_fill</span><span class="o">:</span><span class="mi">4</span><span class="w"> </span><span class="n">locked</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">:</span><span class="p">(</span><span class="mh">0x14e</span><span class="p">)(</span><span class="n">allocated</span><span class="o">|</span><span class="n">usable</span><span class="o">|</span><span class="n">hasdata</span><span class="o">|</span><span class="n">flushed</span><span class="o">|</span><span class="n">fillfree</span><span class="p">)</span><span class="w"> </span><span class="n">pcm</span><span class="o">:</span><span class="w">          </span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.252443</span><span class="p">]</span><span class="w"> </span><span class="n">CPU16</span><span class="w"> </span><span class="n">PID30</span><span class="w">     </span><span class="n">hit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">owner</span><span class="o">:</span><span class="mi">21</span><span class="w"> </span><span class="n">m_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">rep_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7fffcc000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.260879</span><span class="p">]</span><span class="w"> </span><span class="n">CPU16</span><span class="w"> </span><span class="n">PID30</span><span class="w">     </span><span class="n">rmap</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span><span class="w"> </span><span class="n">set_idx</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">nr_lru</span><span class="o">:</span><span class="mi">63</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.268926</span><span class="p">]</span><span class="w"> </span><span class="n">CPU16</span><span class="w"> </span><span class="n">PID30</span><span class="w">  </span><span class="n">victim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span><span class="n">ffffffff810c2900</span><span class="w"> </span><span class="n">refcount</span><span class="o">:</span><span class="mi">2</span><span class="w"> </span><span class="n">nr_fill</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">max_fill</span><span class="o">:</span><span class="mi">4</span><span class="w"> </span><span class="n">locked</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">:</span><span class="p">(</span><span class="mh">0x14e</span><span class="p">)(</span><span class="n">allocated</span><span class="o">|</span><span class="n">usable</span><span class="o">|</span><span class="n">hasdata</span><span class="o">|</span><span class="n">flushed</span><span class="o">|</span><span class="n">fillfree</span><span class="p">)</span><span class="w"> </span><span class="n">pcm</span><span class="o">:</span><span class="w">          </span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.288026</span><span class="p">]</span><span class="w"> </span><span class="n">CPU16</span><span class="w"> </span><span class="n">PID30</span><span class="w">     </span><span class="n">hit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">owner</span><span class="o">:</span><span class="mi">21</span><span class="w"> </span><span class="n">m_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">rep_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7fffb0000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.296461</span><span class="p">]</span><span class="w"> </span><span class="n">CPU16</span><span class="w"> </span><span class="n">PID30</span><span class="w">     </span><span class="n">rmap</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span><span class="w"> </span><span class="n">set_idx</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">nr_lru</span><span class="o">:</span><span class="mi">63</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.304508</span><span class="p">]</span><span class="w"> </span><span class="n">CPU16</span><span class="w"> </span><span class="n">PID30</span><span class="w">   </span><span class="o">--</span><span class="w">   </span><span class="n">End</span><span class="w"> </span><span class="n">Dump</span><span class="w"> </span><span class="n">Victim</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="p">[</span><span class="w"> </span><span class="mf">2819.101391</span><span class="p">]</span><span class="w"> </span><span class="n">CPU18</span><span class="w"> </span><span class="n">PID31</span><span class="w"> </span><span class="n">Abort</span><span class="w"> </span><span class="n">victim</span><span class="w"> </span><span class="n">alloc</span><span class="w"> </span><span class="p">(</span><span class="mi">20010</span><span class="n">ms</span><span class="p">)</span><span class="w"> </span><span class="n">nr_usable_victims</span><span class="o">:</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">From</span><span class="w"> </span><span class="n">pset_idx</span><span class="o">:</span><span class="mi">15</span><span class="w"> </span><span class="n">nr_lru</span><span class="o">:</span><span class="mi">63</span><span class="w"> </span><span class="n">fault_uva</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7fff98c0f000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.328165</span><span class="p">]</span><span class="w"> </span><span class="n">CPU18</span><span class="w"> </span><span class="n">PID31</span><span class="w">   </span><span class="o">--</span><span class="w">   </span><span class="n">Start</span><span class="w"> </span><span class="n">Dump</span><span class="w"> </span><span class="n">Victim</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="n">total</span><span class="o">:</span><span class="w"> </span><span class="mi">2</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.335146</span><span class="p">]</span><span class="w"> </span><span class="n">CPU18</span><span class="w"> </span><span class="n">PID31</span><span class="w">  </span><span class="n">victim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">:</span><span class="n">ffffffff810c2880</span><span class="w"> </span><span class="n">refcount</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">nr_fill</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">max_fill</span><span class="o">:</span><span class="mi">4</span><span class="w"> </span><span class="n">locked</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">:</span><span class="p">(</span><span class="mh">0x14e</span><span class="p">)(</span><span class="n">allocated</span><span class="o">|</span><span class="n">usable</span><span class="o">|</span><span class="n">hasdata</span><span class="o">|</span><span class="n">flushed</span><span class="o">|</span><span class="n">fillfree</span><span class="p">)</span><span class="w"> </span><span class="n">pcm</span><span class="o">:</span><span class="w">          </span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.354246</span><span class="p">]</span><span class="w"> </span><span class="n">CPU18</span><span class="w"> </span><span class="n">PID31</span><span class="w">     </span><span class="n">hit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">owner</span><span class="o">:</span><span class="mi">21</span><span class="w"> </span><span class="n">m_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">rep_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7fffcc000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.362680</span><span class="p">]</span><span class="w"> </span><span class="n">CPU18</span><span class="w"> </span><span class="n">PID31</span><span class="w">     </span><span class="n">rmap</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span><span class="w"> </span><span class="n">set_idx</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">nr_lru</span><span class="o">:</span><span class="mi">63</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.370728</span><span class="p">]</span><span class="w"> </span><span class="n">CPU18</span><span class="w"> </span><span class="n">PID31</span><span class="w">  </span><span class="n">victim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span><span class="n">ffffffff810c2900</span><span class="w"> </span><span class="n">refcount</span><span class="o">:</span><span class="mi">2</span><span class="w"> </span><span class="n">nr_fill</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">max_fill</span><span class="o">:</span><span class="mi">4</span><span class="w"> </span><span class="n">locked</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">:</span><span class="p">(</span><span class="mh">0x14e</span><span class="p">)(</span><span class="n">allocated</span><span class="o">|</span><span class="n">usable</span><span class="o">|</span><span class="n">hasdata</span><span class="o">|</span><span class="n">flushed</span><span class="o">|</span><span class="n">fillfree</span><span class="p">)</span><span class="w"> </span><span class="n">pcm</span><span class="o">:</span><span class="w">          </span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.389828</span><span class="p">]</span><span class="w"> </span><span class="n">CPU18</span><span class="w"> </span><span class="n">PID31</span><span class="w">     </span><span class="n">hit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">owner</span><span class="o">:</span><span class="mi">21</span><span class="w"> </span><span class="n">m_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">rep_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7fffb0000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.398262</span><span class="p">]</span><span class="w"> </span><span class="n">CPU18</span><span class="w"> </span><span class="n">PID31</span><span class="w">     </span><span class="n">rmap</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span><span class="w"> </span><span class="n">set_idx</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">nr_lru</span><span class="o">:</span><span class="mi">63</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2819.406310</span><span class="p">]</span><span class="w"> </span><span class="n">CPU18</span><span class="w"> </span><span class="n">PID31</span><span class="w">   </span><span class="o">--</span><span class="w">   </span><span class="n">End</span><span class="w"> </span><span class="n">Dump</span><span class="w"> </span><span class="n">Victim</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="cp">#</span>
<span class="cp"># This guy grabbed the fill counter right before the first timout</span>
<span class="cp"># That&#39;s why the above three timeout happen. And this one is 20s later</span>
<span class="cp"># which equals to the timeout second.</span>
<span class="cp">#</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2839.327457</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID28</span><span class="w"> </span><span class="n">Abort</span><span class="w"> </span><span class="n">victim</span><span class="w"> </span><span class="n">alloc</span><span class="w"> </span><span class="p">(</span><span class="mi">20010</span><span class="n">ms</span><span class="p">)</span><span class="w"> </span><span class="n">nr_usable_victims</span><span class="o">:</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">From</span><span class="w"> </span><span class="n">pset_idx</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">nr_lru</span><span class="o">:</span><span class="mi">63</span><span class="w"> </span><span class="n">fault_uva</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7fffb0000f00</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2839.339964</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID28</span><span class="w">   </span><span class="o">--</span><span class="w">   </span><span class="n">Start</span><span class="w"> </span><span class="n">Dump</span><span class="w"> </span><span class="n">Victim</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="n">total</span><span class="o">:</span><span class="w"> </span><span class="mi">2</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2839.346945</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID28</span><span class="w">  </span><span class="n">victim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">:</span><span class="n">ffffffff810c2880</span><span class="w"> </span><span class="n">refcount</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">nr_fill</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">max_fill</span><span class="o">:</span><span class="mi">4</span><span class="w"> </span><span class="n">locked</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">:</span><span class="p">(</span><span class="mh">0x14e</span><span class="p">)(</span><span class="n">allocated</span><span class="o">|</span><span class="n">usable</span><span class="o">|</span><span class="n">hasdata</span><span class="o">|</span><span class="n">flushed</span><span class="o">|</span><span class="n">fillfree</span><span class="p">)</span><span class="w"> </span><span class="n">pcm</span><span class="o">:</span><span class="w">          </span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2839.366046</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID28</span><span class="w">     </span><span class="n">hit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">owner</span><span class="o">:</span><span class="mi">21</span><span class="w"> </span><span class="n">m_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">rep_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7fffcc000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2839.374480</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID28</span><span class="w">     </span><span class="n">rmap</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span><span class="w"> </span><span class="n">set_idx</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">nr_lru</span><span class="o">:</span><span class="mi">63</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2839.382527</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID28</span><span class="w">  </span><span class="n">victim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span><span class="n">ffffffff810c2900</span><span class="w"> </span><span class="n">refcount</span><span class="o">:</span><span class="mi">2</span><span class="w"> </span><span class="n">nr_fill</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">max_fill</span><span class="o">:</span><span class="mi">4</span><span class="w"> </span><span class="n">locked</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">:</span><span class="p">(</span><span class="mh">0x14e</span><span class="p">)(</span><span class="n">allocated</span><span class="o">|</span><span class="n">usable</span><span class="o">|</span><span class="n">hasdata</span><span class="o">|</span><span class="n">flushed</span><span class="o">|</span><span class="n">fillfree</span><span class="p">)</span><span class="w"> </span><span class="n">pcm</span><span class="o">:</span><span class="w">          </span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2839.401628</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID28</span><span class="w">     </span><span class="n">hit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">owner</span><span class="o">:</span><span class="mi">21</span><span class="w"> </span><span class="n">m_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">rep_nid</span><span class="o">:</span><span class="mi">1</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7fffb0000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2839.410062</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID28</span><span class="w">     </span><span class="n">rmap</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pset</span><span class="o">:</span><span class="n">ffff88207ff5a000</span><span class="w"> </span><span class="n">set_idx</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">nr_lru</span><span class="o">:</span><span class="mi">63</span>
<span class="p">[</span><span class="w"> </span><span class="mf">2839.418109</span><span class="p">]</span><span class="w"> </span><span class="n">CPU12</span><span class="w"> </span><span class="n">PID28</span><span class="w">   </span><span class="o">--</span><span class="w">   </span><span class="n">End</span><span class="w"> </span><span class="n">Dump</span><span class="w"> </span><span class="n">Victim</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div>
<h3 id="rq-lock-deadlock">rq-&gt;lock deadlock<a class="headerlink" href="#rq-lock-deadlock" title="Permanent link">&para;</a></h3>
<p>Alright. We had rq-&gt;lock deadlock issue. Basically, we missed the part of disabling interrupt. A timer interrupt will try to acquire the lock again. Then, bang we have a deadlock. Digging into the code, you will be able to find the cause easily. The root cause we removed all the pi_lock stuff, which actually have a lot irqsave usages&hellip; Oh man, maybe it&rsquo;s time to add it back.</p>
<div class="highlight"><pre><span></span><code>[ 3367.835389] ------------------- cut here -------------------
[ 3367.841504] Possible deadlock happend locker_cpu: 0
[ 3367.846934] Current call stack:
[ 3367.850425] CPU: 0 PID: 1 Comm: kernel_init 4.0.0-lego+ #437
[ 3367.856726] Stack:
[ 3367.858957] ffff88107ff0fa58 ffffffff8101f4b6 ffff88107fc05e00 00000004a817c800
[ 3367.867101] ffff88107ff0fa80 ffffffff8101f52e ffff88107fc05e00 ffff88107ffb4000
[ 3367.875246] 0000000000000000 ffff88107ff0faa0 ffffffff8101b1ae ffff88107fc04980
[ 3367.883390] 0000000000000000 ffff88107ff0fab8 ffffffff810174f5 0000000000000286
[ 3367.891535] ffff88107ff0fae0 ffffffff81006774 ffff88107ffb9000 ffff88107fc05e00
[ 3367.899680] Call Trace:
[ 3367.902396] &lt;TSK&gt;
[ 3367.904528] [&lt;ffffffff8101f4c2&gt;] report_deadlock+0x62/0x80
[ 3367.910637] [&lt;ffffffff8101f52e&gt;] debug_spin_lock+0x4e/0x60
[ 3367.916745] [&lt;ffffffff8101b1ae&gt;] scheduler_tick+0x2e/0x60
[ 3367.922756] [&lt;ffffffff810174f5&gt;] tick_handle_periodic+0x45/0x70
[ 3367.929350] [&lt;ffffffff81006774&gt;] apic_timer_interrupt+0x54/0x90
[ 3367.935943] [&lt;ffffffff8100e8aa&gt;] smp__apic_timer_interrupt+0x6a/0x70
[ 3367.943021] [&lt;ffffffff8101db99&gt;] ? enqueue_task_rt+0x149/0x250
[ 3367.949518] [&lt;ffffffff8105908a&gt;] ? __mlx4_write_mtt+0xea/0x140
[ 3367.956014] [&lt;ffffffff8101ad34&gt;] activate_task+0x44/0x50
[ 3367.961929] [&lt;ffffffff8101b667&gt;] ttwu_do_activate+0x27/0x50
[ 3367.968134] [&lt;ffffffff8101b89c&gt;] try_to_wake_up+0xdc/0x1f0
[ 3367.974243] [&lt;ffffffff8106cc20&gt;] ? ib_mad_send_done_handler.isra.22+0x4d0/0x4d0
[ 3367.982388] [&lt;ffffffff8101ba80&gt;] wake_up_process+0x10/0x20
[ 3367.988497] [&lt;ffffffff81023116&gt;] __kthread_create_on_node+0x146/0x230
[ 3367.995671] [&lt;ffffffff8102329f&gt;] kthread_create_on_node+0x2f/0x40
[ 3368.002459] [&lt;ffffffff81066873&gt;] ? ib_create_cq+0x23/0x60
[ 3368.008470] [&lt;ffffffff810695e1&gt;] ib_mad_init_device+0x1f1/0x7b0
[ 3368.015064] [&lt;ffffffff81067246&gt;] ib_register_device+0x5d6/0x690
[ 3368.021657] [&lt;ffffffff8105e9d3&gt;] mlx4_ib_add+0x653/0x780
[ 3368.027571] [&lt;ffffffff8105147d&gt;] mlx4_add_device+0x8d/0x130
[ 3368.033777] [&lt;ffffffff8105158c&gt;] mlx4_register_interface+0x6c/0xa0
[ 3368.040661] [&lt;ffffffff811dc660&gt;] mlx4_ib_init+0x10/0x20
[ 3368.046478] [&lt;ffffffff811dc619&gt;] mlx4_init+0x19/0x50
[ 3368.052005] [&lt;ffffffff811dc68d&gt;] ib_core_init+0x1d/0x30
[ 3368.057823] [&lt;ffffffff811db7f9&gt;] device_init+0x9/0x10
[ 3368.063447] [&lt;ffffffff8100030b&gt;] kernel_init+0x4b/0xc0
[ 3368.069168] [&lt;ffffffff8101b0ea&gt;] ? schedule_tail+0xa/0x40
[ 3368.075178] [&lt;ffffffff810002c0&gt;] ? 0xffffffff810002c0
[ 3368.080803] [&lt;ffffffff8100eb32&gt;] ret_from_fork+0x22/0x30
[ 3368.086718] &lt;EOT&gt;
</code></pre></div>
<p>0830-w14-1: I really don&rsquo;t know how this happen. The refcounter and fill counter should be enough to serialize..
<div class="highlight"><pre><span></span><code>[37722.177024] CPU20 PID31  victim:ffffffff810c2880 index:0 refcount:0 nr_fill:0 max_fill:4 locked:0 flags:(0x12e)(allocated|usable|hasdata|waitflush|fillfree) pcm:          (null) pset:ffff88207ff5b980
[37722.196623] CPU20 PID31     hit[0] owner:22 m_nid:1 rep_nid:1 addr: 0x2c33000
[37722.204572] CPU20 PID31  victim:ffffffff810c2880 index:0 refcount:0 nr_fill:0 max_fill:4 locked:0 flags:(0x14e)(allocated|usable|hasdata|flushed|fillfree) pcm:          (null) pset:ffff88207ff5b980
[37722.224154] CPU20 PID31     rmap to pset:ffff88207ff5b980 set_idx: 51 nr_lru:63
[37722.232299] CPU20 PID31     victim dumped because: PCACHE_BUG_ON_VICTIM(!VictimAllocated(v) || !VictimUsable(v) || !VictimFlushed(v) || VictimWriteback(v) || VictimLocked(v))
[37722.254790] WARNING: CPU: 20 PID: 31 at managers/processor/pcache/victim.c:196 __put_victim_nolist+0xb8/0x140
 ffffffff8103e170[37722.453632] [&lt;ffffffff8103c9c8&gt;] __put_victim_nolist+0xb8/0x140
 0000000000000000[37722.461873] [&lt;ffffffff8103db18&gt;] victim_try_fill_pcache+0x2f8/0x440

[37722.265842] CPU10 PID20  victim:ffffffff810c2880 index:0 refcount:0 nr_fill:0 max_fill:4 locked:0 flags:(0x14e)(allocated|usable|hasdata|flushed|fillfree) pcm:          (null) pset:ffff88207ff5b980
[37722.291438] CPU10 PID20     hit[0] owner:22 m_nid:1 rep_nid:1 addr: 0x2c33000
[37722.301616] CPU10 PID20  victim:ffffffff810c2880 index:0 refcount:0 nr_fill:0 max_fill:4 locked:0 flags:(0x14e)(allocated|usable|hasdata|flushed|fillfree) pcm:          (null) pset:ffff88207ff5b980
[37722.324206] CPU10 PID20     rmap to pset:ffff88207ff5b980 set_idx: 51 nr_lru:63
[37722.332349] CPU10 PID20     victim dumped because: PCACHE_BUG_ON_VICTIM(victim_ref_count(v) == 0)
[37722.350673] WARNING: CPU: 10 PID: 20 at ./include/processor/pcache_victim.h:127 __victim_flush_func+0x232/0x250
[37722.363568] CPU: 10 PID: 20 Comm: kvictim_flushd 4.0.0-lego+ #435
[37722.534003] [&lt;ffffffff8103e152&gt;] __victim_flush_func+0x232/0x250
[37722.547577] [&lt;ffffffff8103e1d9&gt;] victim_flush_async+0x69/0xb0
[37722.553975] [&lt;ffffffff81022ec1&gt;] kthread+0x111/0x130
[37722.565900] [&lt;ffffffff8100eb32&gt;] ret_from_fork+0x22/0x30
</code></pre></div></p>
<h2 id="aug-29">Aug 29<a class="headerlink" href="#aug-29" title="Permanent link">&para;</a></h2>
<p>The only thing left about core_IB is: ib_sa_query, which will be invoked when there is a mlx4 interrupts.</p>
<p>Not sure if this is important.</p>
<p>Anyway. Testing TF 4 threads MNIST again.</p>
<p>When I enable SEQ_IBAPI：</p>
<ul>
<li>0829-w14-11 (0829-w09-11) succeed</li>
<li>0829-w14-12: P side seems have deadlock. Let me enable DEBUG_SPINLOCK.</li>
<li>
<p>0829-w14-13: SEQ_IBAPI, DEBUG_SPINLOCK, this is a very useful log:
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">531.495545</span><span class="p">]</span><span class="w"> </span><span class="n">STDOUT</span><span class="o">:</span><span class="w"> </span><span class="o">---</span><span class="p">[</span>
<span class="nl">INFO</span><span class="p">:</span><span class="n">tensorflow</span><span class="o">:</span><span class="n">loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5256375</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">101</span><span class="w"> </span><span class="p">(</span><span class="mf">25.166</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="p">]</span><span class="o">---</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.624474</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">dereference</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mo">0000000000000064</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.633016</span><span class="p">]</span><span class="w"> </span><span class="n">IP</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103b60e</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">__put_victim_nolist</span><span class="o">+</span><span class="mh">0xe</span><span class="o">/</span><span class="mh">0xa0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.639803</span><span class="p">]</span><span class="w"> </span><span class="n">PGD</span><span class="w"> </span><span class="mi">0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.642032</span><span class="p">]</span><span class="w"> </span><span class="n">Oops</span><span class="o">:</span><span class="w"> </span><span class="mo">0002</span><span class="w"> </span><span class="p">[</span><span class="err">#</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">SMP</span><span class="w"> </span><span class="n">PROCESSOR</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.646493</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">kvictim_flushd</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">426</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.653279</span><span class="p">]</span><span class="w"> </span><span class="n">RIP</span><span class="o">:</span><span class="w"> </span><span class="mo">0010</span><span class="o">:</span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103b60e</span><span class="o">&gt;</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103b60e</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">__put_victim_nolist</span><span class="o">+</span><span class="mh">0xe</span><span class="o">/</span><span class="mh">0xa0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.662781</span><span class="p">]</span><span class="w"> </span><span class="n">RSP</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="o">:</span><span class="n">ffff880fe392fde0</span><span class="w">  </span><span class="n">EFLAGS</span><span class="o">:</span><span class="w"> </span><span class="mo">00010006</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.668696</span><span class="p">]</span><span class="w"> </span><span class="n">RAX</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">RBX</span><span class="o">:</span><span class="w"> </span><span class="n">ffffffff810c2b00</span><span class="w"> </span><span class="n">RCX</span><span class="o">:</span><span class="w"> </span><span class="n">ffffffff810c2b70</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.676646</span><span class="p">]</span><span class="w"> </span><span class="n">RDX</span><span class="o">:</span><span class="w"> </span><span class="n">ffffffff810c2b70</span><span class="w"> </span><span class="n">RSI</span><span class="o">:</span><span class="w"> </span><span class="mo">0000007</span><span class="n">aea3f42fa</span><span class="w"> </span><span class="n">RDI</span><span class="o">:</span><span class="w"> </span><span class="n">ffffffff810c2b00</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.684597</span><span class="p">]</span><span class="w"> </span><span class="n">RBP</span><span class="o">:</span><span class="w"> </span><span class="n">ffff880fe392fdf0</span><span class="w"> </span><span class="n">R08</span><span class="o">:</span><span class="w"> </span><span class="mf">000000000000001f</span><span class="w"> </span><span class="n">R09</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000002</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.692548</span><span class="p">]</span><span class="w"> </span><span class="n">R10</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000</span><span class="mi">80000000</span><span class="w"> </span><span class="n">R11</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000000664</span><span class="n">c3</span><span class="w"> </span><span class="n">R12</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88207ff57000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.700498</span><span class="p">]</span><span class="w"> </span><span class="n">R13</span><span class="o">:</span><span class="w"> </span><span class="n">ffffffff810c2b60</span><span class="w"> </span><span class="n">R14</span><span class="o">:</span><span class="w"> </span><span class="n">ffff880a72555000</span><span class="w"> </span><span class="n">R15</span><span class="o">:</span><span class="w"> </span><span class="n">ffffffff810c2b48</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.708449</span><span class="p">]</span><span class="w"> </span><span class="n">FS</span><span class="o">:</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span><span class="w"> </span><span class="n">GS</span><span class="o">:</span><span class="n">ffff88107fca0000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span><span class="w"> </span><span class="n">knlGS</span><span class="o">:</span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.717466</span><span class="p">]</span><span class="w"> </span><span class="n">CS</span><span class="o">:</span><span class="w">  </span><span class="mo">0010</span><span class="w"> </span><span class="n">DS</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="n">ES</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="n">CR0</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000</span><span class="mi">80050033</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.723865</span><span class="p">]</span><span class="w"> </span><span class="n">CR2</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000064</span><span class="w"> </span><span class="n">CR3</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000011</span><span class="n">b9000</span><span class="w"> </span><span class="n">CR4</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000000406</span><span class="n">a0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.731816</span><span class="p">]</span><span class="w"> </span><span class="n">Stack</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.734046</span><span class="p">]</span><span class="w"> </span><span class="n">ffffffff810c2b00</span><span class="w"> </span><span class="n">ffff88207ff57000</span><span class="w"> </span><span class="n">ffff880fe392fe08</span><span class="w"> </span><span class="n">ffffffff8103bbea</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.742190</span><span class="p">]</span><span class="w"> </span><span class="n">ffffffff810c2b00</span><span class="w"> </span><span class="n">ffff880fe392fe48</span><span class="w"> </span><span class="n">ffffffff8103c729</span><span class="w"> </span><span class="mo">00000000</span><span class="mi">8103</span><span class="n">d7c2</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.750335</span><span class="p">]</span><span class="w"> </span><span class="n">ffff880a72555060</span><span class="w"> </span><span class="n">ffff88107ff0fdc8</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">ffffffff8103c780</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.758479</span><span class="p">]</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">ffff880fe392fe60</span><span class="w"> </span><span class="n">ffffffff8103c7e6</span><span class="w"> </span><span class="n">ffff880fe391c000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.766623</span><span class="p">]</span><span class="w"> </span><span class="n">ffff880fe392ff48</span><span class="w"> </span><span class="n">ffffffff81022e81</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.774768</span><span class="p">]</span><span class="w"> </span><span class="n">Call</span><span class="w"> </span><span class="n">Trace</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.777483</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.779617</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103bbea</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">__put_victim</span><span class="o">+</span><span class="mh">0x4a</span><span class="o">/</span><span class="mh">0x50</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.785433</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103c729</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">__victim_flush_func</span><span class="o">+</span><span class="mh">0xb9</span><span class="o">/</span><span class="mh">0x110</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.792027</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103c780</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">__victim_flush_func</span><span class="o">+</span><span class="mh">0x110</span><span class="o">/</span><span class="mh">0x110</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.798911</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103c7e6</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">victim_flush_async</span><span class="o">+</span><span class="mh">0x66</span><span class="o">/</span><span class="mh">0x90</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.805310</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81022e81</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">kthread</span><span class="o">+</span><span class="mh">0x111</span><span class="o">/</span><span class="mh">0x130</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.810836</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81022d70</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">__kthread_parkme</span><span class="o">+</span><span class="mh">0x70</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.817236</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100eb32</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">ret_from_fork</span><span class="o">+</span><span class="mh">0x22</span><span class="o">/</span><span class="mh">0x30</span>
<span class="p">[</span><span class="w">  </span><span class="mf">531.823151</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">EOT</span><span class="o">&gt;</span>
</code></pre></div></p>
</li>
<li>
<p>0829-w14-14: this looks like a double free, or concurrent eviction. But if you look into the evict code, we will check the Flushed flag. It means another eviction routine should have skipped this line, and will not pick this line to do eviction. Some other possibilities?</p>
</li>
<li>
<p>check until 0829-w14-18
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w"> </span><span class="mf">1671.661424</span><span class="p">]</span><span class="w"> </span><span class="o">------------</span><span class="p">[</span><span class="w"> </span><span class="n">cut</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="p">]</span><span class="o">------------</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.666378</span><span class="p">]</span><span class="w"> </span><span class="n">BUG</span><span class="o">:</span><span class="w"> </span><span class="n">failure</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">managers</span><span class="o">/</span><span class="n">processor</span><span class="o">/</span><span class="n">pcache</span><span class="o">/</span><span class="n">victim</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">610</span><span class="o">/</span><span class="n">victim_finish_insert</span><span class="p">()</span><span class="o">!</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.675591</span><span class="p">]</span><span class="w"> </span><span class="n">Kernel</span><span class="w"> </span><span class="n">Panic</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">syncing</span><span class="o">:</span><span class="w"> </span><span class="n">BUG</span><span class="o">!</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.680339</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">python</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">426</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.686351</span><span class="p">]</span><span class="w"> </span><span class="n">Stack</span><span class="o">:</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.688581</span><span class="p">]</span><span class="w"> </span><span class="n">ffff880fbe76fda0</span><span class="w"> </span><span class="n">ffffffff810289b7</span><span class="w"> </span><span class="n">ffffffff00000008</span><span class="w"> </span><span class="n">ffff880fbe76fdb0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.696725</span><span class="p">]</span><span class="w"> </span><span class="n">ffff880fbe76fd68</span><span class="w"> </span><span class="n">ffffff0021475542</span><span class="w"> </span><span class="n">ffff88107fd45e00</span><span class="w"> </span><span class="n">ffff880fbe753000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.704870</span><span class="p">]</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="mo">0000000000000001</span><span class="w"> </span><span class="n">ffff880fbe76f9b0</span><span class="w"> </span><span class="n">ffffffff8101b1b7</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.713015</span><span class="p">]</span><span class="w"> </span><span class="n">ffff88107fd44980</span><span class="w"> </span><span class="n">ffff880fbe76f9d8</span><span class="w"> </span><span class="n">ffffffff8101405f</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.721160</span><span class="p">]</span><span class="w"> </span><span class="mo">0000000000000001</span><span class="w"> </span><span class="n">ffff880ff992a000</span><span class="w"> </span><span class="mo">0000000000000001</span><span class="w"> </span><span class="n">ffff880fbe76f9f0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.729304</span><span class="p">]</span><span class="w"> </span><span class="n">Call</span><span class="w"> </span><span class="n">Trace</span><span class="o">:</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.732019</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.734153</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810289c3</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">panic</span><span class="o">+</span><span class="mh">0xc2</span><span class="o">/</span><span class="mh">0x10a</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.739388</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101b1b7</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">scheduler_tick</span><span class="o">+</span><span class="mh">0x57</span><span class="o">/</span><span class="mh">0x60</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.745593</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101405f</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">generic_smp_call_function_single_interrupt</span><span class="o">+</span><span class="mh">0x8f</span><span class="o">/</span><span class="mh">0x160</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.754611</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100339e</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">call_function_interrupt</span><span class="o">+</span><span class="mh">0x2e</span><span class="o">/</span><span class="mh">0x40</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.761688</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e9fa</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">smp__call_function_interrupt</span><span class="o">+</span><span class="mh">0x6a</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.769251</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101f4bb</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">debug_spin_lock</span><span class="o">+</span><span class="mh">0x1b</span><span class="o">/</span><span class="mh">0x50</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.775555</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81075efc</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">fit_internal_poll_sendcq</span><span class="o">+</span><span class="mh">0x6c</span><span class="o">/</span><span class="mh">0x140</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.782826</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81042039</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">find_next_bit</span><span class="o">+</span><span class="mh">0x19</span><span class="o">/</span><span class="mh">0x20</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.788934</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101f4bb</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">debug_spin_lock</span><span class="o">+</span><span class="mh">0x1b</span><span class="o">/</span><span class="mh">0x50</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.795236</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101dcac</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">task_tick_rt</span><span class="o">+</span><span class="mh">0x2c</span><span class="o">/</span><span class="mh">0xd0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.801248</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101b1b7</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">scheduler_tick</span><span class="o">+</span><span class="mh">0x57</span><span class="o">/</span><span class="mh">0x60</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.807453</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810174d5</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">tick_handle_periodic</span><span class="o">+</span><span class="mh">0x45</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.814240</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81006774</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">apic_timer_interrupt</span><span class="o">+</span><span class="mh">0x54</span><span class="o">/</span><span class="mh">0x90</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.821029</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e8aa</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">smp__apic_timer_interrupt</span><span class="o">+</span><span class="mh">0x6a</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.828300</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81012bc8</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">printk</span><span class="o">+</span><span class="mh">0x118</span><span class="o">/</span><span class="mh">0x1b0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.833924</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103c161</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">victim_finish_insert</span><span class="o">+</span><span class="mh">0x171</span><span class="o">/</span><span class="mh">0x180</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.840711</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103b2a2</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">pcache_evict_line</span><span class="o">+</span><span class="mh">0xf2</span><span class="o">/</span><span class="mh">0x2e0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.847110</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81038d7c</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">pcache_alloc</span><span class="o">+</span><span class="mh">0x1ac</span><span class="o">/</span><span class="mh">0x380</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.853122</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103a10c</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">pcache_add_rmap</span><span class="o">+</span><span class="mh">0x7c</span><span class="o">/</span><span class="mh">0x260</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.859521</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810382bb</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">common_do_fill_page</span><span class="o">+</span><span class="mh">0x2b</span><span class="o">/</span><span class="mh">0x1e0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.866114</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81038631</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">pcache_handle_fault</span><span class="o">+</span><span class="mh">0x1c1</span><span class="o">/</span><span class="mh">0x620</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.872804</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81037fc0</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">pcache_meta_to_kva</span><span class="o">+</span><span class="mh">0x30</span><span class="o">/</span><span class="mh">0x30</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.879398</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101006f</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">do_page_fault</span><span class="o">+</span><span class="mh">0xaf</span><span class="o">/</span><span class="mh">0x1c0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1671.885410</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100dedf</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">page_fault</span><span class="o">+</span><span class="mh">0x1f</span><span class="o">/</span><span class="mh">0x30</span>
</code></pre></div></p>
</li>
<li>
<p>0829-w14-16: we got this by having debug_spinlock, and seq_ibapi. This is interesting and serious. I think our general C code is fine.. Should I go check the assembly part? This is the rq-&gt;lock? come on&hellip;
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="w">  </span><span class="mf">683.748135</span><span class="p">]</span><span class="w"> </span><span class="o">-------------------</span><span class="w"> </span><span class="n">cut</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="o">-------------------</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.754252</span><span class="p">]</span><span class="w"> </span><span class="n">Possible</span><span class="w"> </span><span class="n">deadlock</span><span class="w"> </span><span class="n">happend</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.758323</span><span class="p">]</span><span class="w"> </span><span class="n">Current</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">stack</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.761815</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">python</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">428</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.767728</span><span class="p">]</span><span class="w"> </span><span class="n">Stack</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.769959</span><span class="p">]</span><span class="w"> </span><span class="n">ffff880fc1c1fc38</span><span class="w"> </span><span class="n">ffffffff8101f48c</span><span class="w"> </span><span class="n">ffff88107fc45e00</span><span class="w"> </span><span class="n">ffff880fc1c1fc60</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.778103</span><span class="p">]</span><span class="w"> </span><span class="n">ffffffff8101f4e4</span><span class="w"> </span><span class="n">ffff88107fc45e00</span><span class="w"> </span><span class="n">ffff880fc23fb000</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.786247</span><span class="p">]</span><span class="w"> </span><span class="n">ffff880fc1c1fc80</span><span class="w"> </span><span class="n">ffffffff8101b18e</span><span class="w"> </span><span class="n">ffff88107fc44980</span><span class="w"> </span><span class="mo">0000000000000004</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.794391</span><span class="p">]</span><span class="w"> </span><span class="n">ffff880fc1c1fc98</span><span class="w"> </span><span class="n">ffffffff810174d5</span><span class="w"> </span><span class="n">ffffffff8101dddb</span><span class="w"> </span><span class="n">ffff880fc1c1fcc0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.802537</span><span class="p">]</span><span class="w"> </span><span class="n">ffffffff81006774</span><span class="w"> </span><span class="n">ffff88107fc45e00</span><span class="w"> </span><span class="mo">00000004</span><span class="n">a817c800</span><span class="w"> </span><span class="mo">000000</span><span class="mi">9</span><span class="n">a8a78c5e7</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.810680</span><span class="p">]</span><span class="w"> </span><span class="n">Call</span><span class="w"> </span><span class="n">Trace</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.813396</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.815528</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101f498</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">report_deadlock</span><span class="o">+</span><span class="mh">0x58</span><span class="o">/</span><span class="mh">0x60</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.821637</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101f4e4</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">debug_spin_lock</span><span class="o">+</span><span class="mh">0x44</span><span class="o">/</span><span class="mh">0x50</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.827745</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101b18e</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">scheduler_tick</span><span class="o">+</span><span class="mh">0x2e</span><span class="o">/</span><span class="mh">0x60</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.833758</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810174d5</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">tick_handle_periodic</span><span class="o">+</span><span class="mh">0x45</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.840351</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101dddb</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">dequeue_task_rt</span><span class="o">+</span><span class="mh">0x1b</span><span class="o">/</span><span class="mh">0x180</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.846750</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81006774</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">apic_timer_interrupt</span><span class="o">+</span><span class="mh">0x54</span><span class="o">/</span><span class="mh">0x90</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.853343</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e8aa</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">smp__apic_timer_interrupt</span><span class="o">+</span><span class="mh">0x6a</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.860421</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101f4d1</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">debug_spin_lock</span><span class="o">+</span><span class="mh">0x31</span><span class="o">/</span><span class="mh">0x50</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.866723</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101b86e</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">try_to_wake_up</span><span class="o">+</span><span class="mh">0xce</span><span class="o">/</span><span class="mh">0x1f0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.872832</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101b9e4</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">wake_up_q</span><span class="o">+</span><span class="mh">0x54</span><span class="o">/</span><span class="mh">0xc0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.878358</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81028487</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">do_futex</span><span class="o">+</span><span class="mh">0x407</span><span class="o">/</span><span class="mh">0x620</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.883982</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103a941</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">pcache_add_rmap</span><span class="o">+</span><span class="mh">0xb1</span><span class="o">/</span><span class="mh">0x600</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.890381</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102870c</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">sys_futex</span><span class="o">+</span><span class="mh">0x6c</span><span class="o">/</span><span class="mh">0x130</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.896005</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100ec66</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">do_syscall_64</span><span class="o">+</span><span class="mh">0x36</span><span class="o">/</span><span class="mh">0xc0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">683.901919</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100db6c</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">entry_SYSCALL64_slow_path</span><span class="o">+</span><span class="mh">0x25</span><span class="o">/</span><span class="mh">0x25</span>
</code></pre></div></p>
</li>
</ul>
<h2 id="aug-27">Aug 27<a class="headerlink" href="#aug-27" title="Permanent link">&para;</a></h2>
<p>There a lot lost CQE cases. This one is about P-&gt;M-&gt;S. And M lost the CQE for the WQE sent to S.
<div class="highlight"><pre><span></span><code><span class="mi">0827</span><span class="o">-</span><span class="n">w9</span><span class="mi">-5</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.304865</span><span class="p">]</span><span class="w"> </span><span class="n">watchdog</span><span class="o">:</span><span class="w"> </span><span class="n">worker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">CPU10</span><span class="w"> </span><span class="n">stucked</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.309712</span><span class="p">]</span><span class="w"> </span><span class="n">watchdog</span><span class="o">:</span><span class="w">  </span><span class="n">common_header</span><span class="w"> </span><span class="p">[</span><span class="n">op</span><span class="o">=</span><span class="mh">0x20000000</span><span class="w"> </span><span class="n">src_nid</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.316210</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">thpool</span><span class="o">-</span><span class="n">worker0</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">43</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.322899</span><span class="p">]</span><span class="w"> </span><span class="n">RIP</span><span class="o">:</span><span class="w"> </span><span class="mo">0010</span><span class="o">:</span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8106ad51</span><span class="o">&gt;</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8106ad51</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">fit_send_reply_with_rdma_write_with_imm</span><span class="o">+</span><span class="mh">0x2a1</span><span class="o">/</span><span class="mh">0x3a0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.334632</span><span class="p">]</span><span class="w"> </span><span class="n">RSP</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="o">:</span><span class="n">ffff88103ef3fc20</span><span class="w">  </span><span class="n">EFLAGS</span><span class="o">:</span><span class="w"> </span><span class="mo">000002</span><span class="mi">87</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.340547</span><span class="p">]</span><span class="w"> </span><span class="n">RAX</span><span class="o">:</span><span class="w"> </span><span class="mf">00000000f</span><span class="n">fffb6d4</span><span class="w"> </span><span class="n">RBX</span><span class="o">:</span><span class="w"> </span><span class="mo">000000000000000</span><span class="n">b</span><span class="w"> </span><span class="n">RCX</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000001770</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.348498</span><span class="p">]</span><span class="w"> </span><span class="n">RDX</span><span class="o">:</span><span class="w"> </span><span class="mf">00000000f</span><span class="n">fffa70d</span><span class="w"> </span><span class="n">RSI</span><span class="o">:</span><span class="w"> </span><span class="n">fffffffffffff039</span><span class="w"> </span><span class="n">RDI</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.356450</span><span class="p">]</span><span class="w"> </span><span class="n">RBP</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103ef3fcc0</span><span class="w"> </span><span class="n">R08</span><span class="o">:</span><span class="w"> </span><span class="mf">000000000000001f</span><span class="w"> </span><span class="n">R09</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000002</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.364400</span><span class="p">]</span><span class="w"> </span><span class="n">R10</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000</span><span class="mi">80000000</span><span class="w"> </span><span class="n">R11</span><span class="o">:</span><span class="w"> </span><span class="mf">000077f</span><span class="n">f80000000</span><span class="w"> </span><span class="n">R12</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.372352</span><span class="p">]</span><span class="w"> </span><span class="n">R13</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103ef26738</span><span class="w"> </span><span class="n">R14</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000000</span><span class="n">b3d54</span><span class="w"> </span><span class="n">R15</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103ef25008</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.380303</span><span class="p">]</span><span class="w"> </span><span class="n">FS</span><span class="o">:</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span><span class="w"> </span><span class="n">GS</span><span class="o">:</span><span class="n">ffff88107fca0000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span><span class="w"> </span><span class="n">knlGS</span><span class="o">:</span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.389320</span><span class="p">]</span><span class="w"> </span><span class="n">CS</span><span class="o">:</span><span class="w">  </span><span class="mo">0010</span><span class="w"> </span><span class="n">DS</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="n">ES</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="n">CR0</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000</span><span class="mi">80050033</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.395720</span><span class="p">]</span><span class="w"> </span><span class="n">CR2</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">CR3</span><span class="o">:</span><span class="w"> </span><span class="mo">000000000116</span><span class="n">a000</span><span class="w"> </span><span class="n">CR4</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000000406</span><span class="n">a0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.403671</span><span class="p">]</span><span class="w"> </span><span class="n">Stack</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.405901</span><span class="p">]</span><span class="w"> </span><span class="mf">00007f</span><span class="n">ff000b3d54</span><span class="w"> </span><span class="n">ffffffff800b3d54</span><span class="w"> </span><span class="n">ffff881000000004</span><span class="w"> </span><span class="n">ffff88103ef3fc78</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.414045</span><span class="p">]</span><span class="w"> </span><span class="mo">0000000</span><span class="mi">900000000</span><span class="w"> </span><span class="n">ffff881000000000</span><span class="w"> </span><span class="mo">0000100</span><span class="mi">800000001</span><span class="w"> </span><span class="n">ffff88103d216000</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.422191</span><span class="p">]</span><span class="w"> </span><span class="n">ffff88103eebae48</span><span class="w"> </span><span class="mi">800</span><span class="n">b3d540000011c</span><span class="w"> </span><span class="n">ffffff9b00000246</span><span class="w"> </span><span class="n">ffffea0000000001</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.430337</span><span class="p">]</span><span class="w"> </span><span class="mo">000000103</span><span class="n">d216000</span><span class="w"> </span><span class="mo">0000000000010</span><span class="n">c00</span><span class="w"> </span><span class="mo">000000000000011</span><span class="n">c</span><span class="w"> </span><span class="mo">000000000000100</span><span class="mi">8</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.438481</span><span class="p">]</span><span class="w"> </span><span class="mo">000000000000011</span><span class="n">c</span><span class="w"> </span><span class="mo">000000000000100</span><span class="mi">8</span><span class="w"> </span><span class="n">ffff88103eebae48</span><span class="w"> </span><span class="n">ffff88103ef3fd70</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.446626</span><span class="p">]</span><span class="w"> </span><span class="n">Call</span><span class="w"> </span><span class="n">Trace</span><span class="o">:</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.449342</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.451475</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81067c80</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">ibapi_send_reply_imm</span><span class="o">+</span><span class="mh">0x50</span><span class="o">/</span><span class="mh">0xd0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.458068</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102e953</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">__storage_read</span><span class="o">+</span><span class="mh">0xc3</span><span class="o">/</span><span class="mh">0x120</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.464371</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102e953</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">__storage_read</span><span class="o">+</span><span class="mh">0xc3</span><span class="o">/</span><span class="mh">0x120</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.470480</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102e9bf</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">storage_read</span><span class="o">+</span><span class="mh">0xf</span><span class="o">/</span><span class="mh">0x50</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.476201</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102eab7</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">storage_vma_fault</span><span class="o">+</span><span class="mh">0xb7</span><span class="o">/</span><span class="mh">0x130</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.482600</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103262f</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">handle_lego_mm_fault</span><span class="o">+</span><span class="mh">0x13f</span><span class="o">/</span><span class="mh">0x4a0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.489389</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102ecf4</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">common_handle_p2m_miss</span><span class="p">.</span><span class="n">isra</span><span class="mf">.1</span><span class="o">+</span><span class="mh">0x54</span><span class="o">/</span><span class="mh">0xc0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.496855</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102edc7</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">handle_p2m_pcache_miss</span><span class="o">+</span><span class="mh">0x67</span><span class="o">/</span><span class="mh">0x2d0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.503739</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102bf96</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">thpool_worker_func</span><span class="o">+</span><span class="mh">0x296</span><span class="o">/</span><span class="mh">0x3a0</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.510332</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102bd00</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">handle_bad_request</span><span class="o">+</span><span class="mh">0x40</span><span class="o">/</span><span class="mh">0x40</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.516926</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81020ca6</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">kthread</span><span class="o">+</span><span class="mh">0xf6</span><span class="o">/</span><span class="mh">0x120</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.522357</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81020bb0</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">__kthread_parkme</span><span class="o">+</span><span class="mh">0x70</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="w">  </span><span class="mf">963.528756</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e632</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">ret_from_fork</span><span class="o">+</span><span class="mh">0x22</span><span class="o">/</span><span class="mh">0x30</span>
</code></pre></div></p>
<p>hmm, another on lost CQE happen at P.
Today is weird, why we happen to have so many lost CQE today?</p>
<p>Think about why CQE is not generated?</p>
<div class="highlight"><pre><span></span><code><span class="mi">0827</span><span class="o">-</span><span class="n">w14</span><span class="mi">-6</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.835707</span><span class="p">]</span>
<span class="o">*****</span>
<span class="o">*****</span><span class="w"> </span><span class="n">Fail</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">CQE</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">send_cq</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="n">seconds</span><span class="o">!</span>
<span class="o">*****</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">lost</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="n">went</span><span class="w"> </span><span class="n">wrong</span>
<span class="o">*****</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">NIC</span><span class="p">...</span>
<span class="o">*****</span><span class="w"> </span><span class="n">connection_id</span><span class="o">:</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="n">node</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="o">*****</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.856465</span><span class="p">]</span><span class="w"> </span><span class="n">IB</span><span class="w"> </span><span class="n">Stats</span><span class="o">:</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.858985</span><span class="p">]</span><span class="w">     </span><span class="n">nr_ib_send_reply</span><span class="o">:</span><span class="w">            </span><span class="mi">3452</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.864221</span><span class="p">]</span><span class="w">     </span><span class="n">nr_bytes_tx</span><span class="o">:</span><span class="w">               </span><span class="mi">506507</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.869456</span><span class="p">]</span><span class="w">     </span><span class="n">nr_bytes_rx</span><span class="o">:</span><span class="w">              </span><span class="mi">8981004</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.874692</span><span class="p">]</span><span class="w"> </span><span class="o">------------</span><span class="p">[</span><span class="w"> </span><span class="n">cut</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="p">]</span><span class="o">------------</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.879829</span><span class="p">]</span><span class="w"> </span><span class="n">WARNING</span><span class="o">:</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">net</span><span class="o">/</span><span class="n">lego</span><span class="o">/</span><span class="n">fit_internal</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">1108</span><span class="w"> </span><span class="n">fit_internal_poll_sendcq</span><span class="o">+</span><span class="mh">0xe5</span><span class="o">/</span><span class="mh">0x140</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.890399</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">python</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">356</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.896410</span><span class="p">]</span><span class="w"> </span><span class="n">Stack</span><span class="o">:</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.898640</span><span class="p">]</span><span class="w"> </span><span class="n">ffff88103c49fb30</span><span class="w"> </span><span class="n">ffffffff810126f5</span><span class="w"> </span><span class="n">ffff88103cb22000</span><span class="w"> </span><span class="mo">00000004</span><span class="n">a817c800</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.906784</span><span class="p">]</span><span class="w"> </span><span class="mf">0000010f7139214f</span><span class="w"> </span><span class="mo">0000000000000007</span><span class="w"> </span><span class="n">ffff88103c49fb40</span><span class="w"> </span><span class="n">ffffffff810127cf</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.914927</span><span class="p">]</span><span class="w"> </span><span class="n">ffff88103c49fbf0</span><span class="w"> </span><span class="n">ffffffff810724b5</span><span class="w"> </span><span class="mo">000000023</span><span class="n">cb2c280</span><span class="w"> </span><span class="n">ffff88103cb2c1f8</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.923072</span><span class="p">]</span><span class="w"> </span><span class="mo">00000000000002</span><span class="mi">86</span><span class="w"> </span><span class="n">ffff88103c49fc18</span><span class="w"> </span><span class="n">ffff88103cb06000</span><span class="w"> </span><span class="n">ffff88103cb2c150</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.931217</span><span class="p">]</span><span class="w"> </span><span class="mo">000000000000024</span><span class="n">b</span><span class="w"> </span><span class="n">ffff88108101c7dc</span><span class="w"> </span><span class="n">ffff88107fce5d80</span><span class="w"> </span><span class="n">ffff88103c46f000</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.939360</span><span class="p">]</span><span class="w"> </span><span class="n">Call</span><span class="w"> </span><span class="n">Trace</span><span class="o">:</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.942075</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.944209</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81012701</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">__warn</span><span class="p">.</span><span class="n">constprop</span><span class="mf">.1</span><span class="o">+</span><span class="mh">0x91</span><span class="o">/</span><span class="mh">0xd0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.950607</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810127cf</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">warn_slowpath_null</span><span class="o">+</span><span class="mh">0xf</span><span class="o">/</span><span class="mh">0x20</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.956909</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810724b5</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">fit_internal_poll_sendcq</span><span class="o">+</span><span class="mh">0xe5</span><span class="o">/</span><span class="mh">0x140</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.963987</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81019dd5</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">scheduler_tick</span><span class="o">+</span><span class="mh">0x55</span><span class="o">/</span><span class="mh">0x60</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.970192</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81072662</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">fit_send_message_with_rdma_write_with_imm_request</span><span class="o">+</span><span class="mh">0x152</span><span class="o">/</span><span class="mh">0x350</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.979791</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810741ff</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">fit_send_reply_with_rdma_write_with_imm</span><span class="o">+</span><span class="mh">0x25f</span><span class="o">/</span><span class="mh">0x3a0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.988420</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810368c2</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">__pcache_do_fill_page</span><span class="o">+</span><span class="mh">0xc2</span><span class="o">/</span><span class="mh">0x1d0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1185.995401</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810701e9</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">ibapi_send_reply_timeout</span><span class="o">+</span><span class="mh">0x79</span><span class="o">/</span><span class="mh">0x120</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1186.002479</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810368c2</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">__pcache_do_fill_page</span><span class="o">+</span><span class="mh">0xc2</span><span class="o">/</span><span class="mh">0x1d0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1186.009459</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810368c2</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">__pcache_do_fill_page</span><span class="o">+</span><span class="mh">0xc2</span><span class="o">/</span><span class="mh">0x1d0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1186.016245</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81036ac4</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">common_do_fill_page</span><span class="o">+</span><span class="mh">0xf4</span><span class="o">/</span><span class="mh">0x1f0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1186.022839</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81036d80</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">pcache_handle_fault</span><span class="o">+</span><span class="mh">0x1c0</span><span class="o">/</span><span class="mh">0x610</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1186.029528</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81036800</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">__pcache_do_zerofill_page</span><span class="o">+</span><span class="mh">0x100</span><span class="o">/</span><span class="mh">0x100</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1186.036995</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100fdff</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">do_page_fault</span><span class="o">+</span><span class="mh">0xaf</span><span class="o">/</span><span class="mh">0x1c0</span>
<span class="p">[</span><span class="w"> </span><span class="mf">1186.043005</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100dc1f</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">page_fault</span><span class="o">+</span><span class="mh">0x1f</span><span class="o">/</span><span class="mh">0x30</span>
</code></pre></div>
<h2 id="aug-26">Aug 26<a class="headerlink" href="#aug-26" title="Permanent link">&para;</a></h2>
<p>Oh well. I saw the same damn lost packet issue again. The issue can be desribed as: P use lite rpc to send a request to M. M processed the handled, and called rpc reply to sent back to P. M need to poll send_cq to poll completion. But M fail to get the CQE for the should-be-sent-out WQE.</p>
<p>This is tested with M&rsquo;s <code>CONFIG_FIT_NOWAIT</code> optimization, which is basically an optimization that M will not poll cq every time a reply was sent out, instead, do batch polling.</p>
<p>The following stack dump was reported by M side watchdog. It is not necessary mlx4_poll_cq&rsquo;s issue, since there is a while (1) loop at fit code. Oh well.
<div class="highlight"><pre><span></span><code><span class="n">Log</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="mi">0826</span><span class="o">-</span><span class="n">w9</span><span class="mi">-1</span>

<span class="p">[</span><span class="mf">187736.669027</span><span class="p">]</span><span class="w"> </span><span class="n">watchdog</span><span class="o">:</span><span class="w"> </span><span class="n">worker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">CPU10</span><span class="w"> </span><span class="n">stucked</span>
<span class="p">[</span><span class="mf">187736.673972</span><span class="p">]</span><span class="w"> </span><span class="n">watchdog</span><span class="o">:</span><span class="w">  </span><span class="n">common_header</span><span class="w"> </span><span class="p">[</span><span class="n">op</span><span class="o">=</span><span class="mh">0x30000000</span><span class="w"> </span><span class="n">src_nid</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span>
<span class="p">[</span><span class="mf">187736.680566</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span><span class="o">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">PID</span><span class="o">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="n">Comm</span><span class="o">:</span><span class="w"> </span><span class="n">thpool</span><span class="o">-</span><span class="n">worker0</span><span class="w"> </span><span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span><span class="w"> </span><span class="err">#</span><span class="mi">26</span>
<span class="p">[</span><span class="mf">187736.687351</span><span class="p">]</span><span class="w"> </span><span class="n">RIP</span><span class="o">:</span><span class="w"> </span><span class="mo">0010</span><span class="o">:</span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810522c3</span><span class="o">&gt;</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810522c3</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">mlx4_ib_poll_cq</span><span class="o">+</span><span class="mh">0x1d3</span><span class="o">/</span><span class="mh">0x850</span>
<span class="p">[</span><span class="mf">187736.696854</span><span class="p">]</span><span class="w"> </span><span class="n">RSP</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="o">:</span><span class="n">ffff88103ef3f750</span><span class="w">  </span><span class="n">EFLAGS</span><span class="o">:</span><span class="w"> </span><span class="mo">000002</span><span class="mi">86</span>
<span class="p">[</span><span class="mf">187736.702865</span><span class="p">]</span><span class="w"> </span><span class="n">RAX</span><span class="o">:</span><span class="w"> </span><span class="mf">00000000f</span><span class="n">ffffff5</span><span class="w"> </span><span class="n">RBX</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">RCX</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103ed6b050</span>
<span class="p">[</span><span class="mf">187736.710913</span><span class="p">]</span><span class="w"> </span><span class="n">RDX</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000</span><span class="mi">80630000</span><span class="w"> </span><span class="n">RSI</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000001</span><span class="w"> </span><span class="n">RDI</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103edb0bf0</span>
<span class="p">[</span><span class="mf">187736.718961</span><span class="p">]</span><span class="w"> </span><span class="n">RBP</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103ef3f7b8</span><span class="w"> </span><span class="n">R08</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000020</span><span class="w"> </span><span class="n">R09</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000002</span>
<span class="p">[</span><span class="mf">187736.727007</span><span class="p">]</span><span class="w"> </span><span class="n">R10</span><span class="o">:</span><span class="w"> </span><span class="mf">0000000f</span><span class="n">fc53fddc</span><span class="w"> </span><span class="n">R11</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000040</span><span class="n">bf1040</span><span class="w"> </span><span class="n">R12</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103ef3f7c8</span>
<span class="p">[</span><span class="mf">187736.735055</span><span class="p">]</span><span class="w"> </span><span class="n">R13</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">R14</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">R15</span><span class="o">:</span><span class="w"> </span><span class="n">ffff88103edb0bf0</span>
<span class="p">[</span><span class="mf">187736.743104</span><span class="p">]</span><span class="w"> </span><span class="n">FS</span><span class="o">:</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span><span class="w"> </span><span class="n">GS</span><span class="o">:</span><span class="n">ffff88107fca0000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span><span class="w"> </span><span class="n">knlGS</span><span class="o">:</span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="mf">187736.752218</span><span class="p">]</span><span class="w"> </span><span class="n">CS</span><span class="o">:</span><span class="w">  </span><span class="mo">0010</span><span class="w"> </span><span class="n">DS</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="n">ES</span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="n">CR0</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000</span><span class="mi">80050033</span>
<span class="p">[</span><span class="mf">187736.758714</span><span class="p">]</span><span class="w"> </span><span class="n">CR2</span><span class="o">:</span><span class="w"> </span><span class="mo">0000000000000000</span><span class="w"> </span><span class="n">CR3</span><span class="o">:</span><span class="w"> </span><span class="mo">000000000116</span><span class="n">a000</span><span class="w"> </span><span class="n">CR4</span><span class="o">:</span><span class="w"> </span><span class="mo">00000000000406</span><span class="n">a0</span>
<span class="p">[</span><span class="mf">187736.766762</span><span class="p">]</span><span class="w"> </span><span class="n">Stack</span><span class="o">:</span>
<span class="p">[</span><span class="mf">187736.769089</span><span class="p">]</span><span class="w"> </span><span class="mf">0000000f</span><span class="n">fc53fddc</span><span class="w"> </span><span class="mo">0000000000000002</span><span class="w"> </span><span class="mo">0000000000000020</span><span class="w"> </span><span class="n">ffff88103edb0c98</span>
<span class="p">[</span><span class="mf">187736.777331</span><span class="p">]</span><span class="w"> </span><span class="mo">00000000000002</span><span class="mi">86</span><span class="w"> </span><span class="mo">00000000</span><span class="mi">80630000</span><span class="w"> </span><span class="n">ffff88103ef3f7d0</span><span class="w"> </span><span class="mo">000063</span><span class="mi">8000000018</span>
<span class="p">[</span><span class="mf">187736.785572</span><span class="p">]</span><span class="w"> </span><span class="n">ffff88103edb0bf0</span><span class="w"> </span><span class="mo">0000000000000001</span><span class="w"> </span><span class="n">ffff88103ef25008</span><span class="w"> </span><span class="mo">0000000000000003</span>
<span class="p">[</span><span class="mf">187736.793813</span><span class="p">]</span><span class="w"> </span><span class="mo">000000000000000</span><span class="n">c</span><span class="w"> </span><span class="n">ffff88103ef3fd30</span><span class="w"> </span><span class="n">ffffffff8106920c</span><span class="w"> </span><span class="n">ffff88103ef3fd54</span>
<span class="p">[</span><span class="mf">187736.802054</span><span class="p">]</span><span class="w"> </span><span class="mo">0000000100000000</span><span class="w"> </span><span class="mo">0000000100000000</span><span class="w"> </span><span class="n">ffff88103edb07b0</span><span class="w"> </span><span class="n">ffff88103e81b008</span>
<span class="p">[</span><span class="mf">187736.810296</span><span class="p">]</span><span class="w"> </span><span class="n">Call</span><span class="w"> </span><span class="n">Trace</span><span class="o">:</span>
<span class="p">[</span><span class="mf">187736.813108</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span><span class="mf">187736.815338</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8106920c</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">fit_internal_poll_sendcq</span><span class="o">+</span><span class="mh">0x6c</span><span class="o">/</span><span class="mh">0xe0</span>
<span class="p">[</span><span class="mf">187736.822416</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8106ab2f</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">fit_send_reply_with_rdma_write_with_imm</span><span class="o">+</span><span class="mh">0x25f</span><span class="o">/</span><span class="mh">0x3a0</span>
<span class="p">[</span><span class="mf">187736.831336</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81033ff0</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">_lego_copy_to_user</span><span class="o">+</span><span class="mh">0x110</span><span class="o">/</span><span class="mh">0x250</span>
<span class="p">[</span><span class="mf">187736.838220</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81028d65</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">__free_pages</span><span class="o">+</span><span class="mh">0x25</span><span class="o">/</span><span class="mh">0x30</span>
<span class="p">[</span><span class="mf">187736.844329</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102e981</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">__storage_read</span><span class="o">+</span><span class="mh">0xf1</span><span class="o">/</span><span class="mh">0x120</span>
<span class="p">[</span><span class="mf">187736.850728</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81019865</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">scheduler_tick</span><span class="o">+</span><span class="mh">0x55</span><span class="o">/</span><span class="mh">0x60</span>
<span class="p">[</span><span class="mf">187736.857031</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810693d2</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">fit_send_message_with_rdma_write_with_imm_request</span><span class="o">+</span><span class="mh">0x152</span><span class="o">/</span><span class="mh">0x350</span>
<span class="p">[</span><span class="mf">187736.866920</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810693d2</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">fit_send_message_with_rdma_write_with_imm_request</span><span class="o">+</span><span class="mh">0x152</span><span class="o">/</span><span class="mh">0x350</span>
<span class="p">[</span><span class="mf">187736.876810</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103043f</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">__vma_adjust</span><span class="o">+</span><span class="mh">0x38f</span><span class="o">/</span><span class="mh">0x550</span>
<span class="p">[</span><span class="mf">187736.883113</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81030944</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">vma_merge</span><span class="o">+</span><span class="mh">0x1a4</span><span class="o">/</span><span class="mh">0x280</span>
<span class="p">[</span><span class="mf">187736.889123</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81030f20</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">arch_get_unmapped_area_topdown</span><span class="o">+</span><span class="mh">0xe0</span><span class="o">/</span><span class="mh">0x220</span>
<span class="p">[</span><span class="mf">187736.897075</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810693d2</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">fit_send_message_with_rdma_write_with_imm_request</span><span class="o">+</span><span class="mh">0x152</span><span class="o">/</span><span class="mh">0x350</span>
<span class="p">[</span><span class="mf">187736.906771</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81069ab5</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">fit_ack_reply_callback</span><span class="o">+</span><span class="mh">0x185</span><span class="o">/</span><span class="mh">0x1e0</span>
<span class="p">[</span><span class="mf">187736.913848</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102f129</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">handle_p2m_flush_one</span><span class="o">+</span><span class="mh">0x69</span><span class="o">/</span><span class="mh">0x160</span>
<span class="p">[</span><span class="mf">187736.920830</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102bde0</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">thpool_worker_func</span><span class="o">+</span><span class="mh">0xe0</span><span class="o">/</span><span class="mh">0x3a0</span>
<span class="p">[</span><span class="mf">187736.927424</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102bd00</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">handle_bad_request</span><span class="o">+</span><span class="mh">0x40</span><span class="o">/</span><span class="mh">0x40</span>
<span class="p">[</span><span class="mf">187736.934113</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81020ca6</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">kthread</span><span class="o">+</span><span class="mh">0xf6</span><span class="o">/</span><span class="mh">0x120</span>
<span class="p">[</span><span class="mf">187736.939639</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81020bb0</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">__kthread_parkme</span><span class="o">+</span><span class="mh">0x70</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="mf">187736.946137</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e632</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="n">ret_from_fork</span><span class="o">+</span><span class="mh">0x22</span><span class="o">/</span><span class="mh">0x30</span>
</code></pre></div></p>
<h2 id="aug-22">Aug 22<a class="headerlink" href="#aug-22" title="Permanent link">&para;</a></h2>
<p>Damn it!!! After so much effort verifying we had a solid IB stack, we still has memory corruption and deadlock issues. Fuck!</p>
<p>One thing at a time, simple stuff first. Okay, tomorrow first add DEBUG_SPINLOCK to detect possible deadlocks. This, could help to identify some buggy code. After this, I will spend some time looking into the LITE, it&rsquo;s fucking HEAVY. I do found a lot issues during summer.</p>
<p>Personally, I&rsquo;m not feeling good this days. I treat someone with love and respect, but there is not too much in return. Yeahyeahyeah, I know how this works. It&rsquo;s just sad that sometimes you just have a BAD timing. I&rsquo;ve went through too much things in 2018, good and bad. I care sooo much about the people I love, family and others. I feel this is good, of course. Anyway, it is supposed to be a Lego dump, that no one probably interested in.</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 1, 2018</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["instant", "tabs", "navigation.tabs", "navigation.tabs.sticky", "navigation.top"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>