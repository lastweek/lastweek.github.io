
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Yizhou Shan">
      
      
        <link rel="canonical" href="http://lastweek.io/fpga/bitstream/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.1, mkdocs-material-7.1.9">
    
    
      
        <title>Bitstream Explained - Yizhou Shan's Home Page</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Courier+Prime+Bold:300,400,400i,700%7CCourier+Prime+Bold&display=fallback">
        <style>:root{--md-text-font-family:"Courier Prime Bold";--md-code-font-family:"Courier Prime Bold"}</style>
      
    
    
    
    
      
  



  
  



  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-143772066-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fpga-bitstream-explained" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Yizhou Shan&#39;s Home Page" class="md-header__button md-logo" aria-label="Yizhou Shan's Home Page" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Yizhou Shan's Home Page
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Bitstream Explained
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/lastweek/lastweek.github.io/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M105.2 24.9c-3.1-8.9-15.7-8.9-18.9 0L29.8 199.7h132c-.1 0-56.6-174.8-56.6-174.8zM.9 287.7c-2.6 8 .3 16.9 7.1 22l247.9 184-226.2-294zm160.8-88 94.3 294 94.3-294zm349.4 88-28.8-88-226.3 294 247.9-184c6.9-5.1 9.7-14 7.2-22zM425.7 24.9c-3.1-8.9-15.7-8.9-18.9 0l-56.6 174.8h132z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../notes/virt/" class="md-tabs__link">
        Notes
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../notes/source_code/summary/" class="md-tabs__link">
        Code
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="./" class="md-tabs__link md-tabs__link--active">
        FPGA
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../lego/log/misc/" class="md-tabs__link">
        LegoOS
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Yizhou Shan&#39;s Home Page" class="md-nav__button md-logo" aria-label="Yizhou Shan's Home Page" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Yizhou Shan's Home Page
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/lastweek/lastweek.github.io/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M105.2 24.9c-3.1-8.9-15.7-8.9-18.9 0L29.8 199.7h132c-.1 0-56.6-174.8-56.6-174.8zM.9 287.7c-2.6 8 .3 16.9 7.1 22l247.9 184-226.2-294zm160.8-88 94.3 294 94.3-294zm349.4 88-28.8-88-226.3 294 247.9-184c6.9-5.1 9.7-14 7.2-22zM425.7 24.9c-3.1-8.9-15.7-8.9-18.9 0l-56.6 174.8h132z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Notes
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Notes" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/virt/" class="md-nav__link">
        Modern Virtualization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/cache_coherence/" class="md-nav__link">
        Practical Cache Coherence
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/dynamic_linking/" class="md-nav__link">
        Dynamic Linking
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/dcn/" class="md-nav__link">
        Data Center Networking
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/packet-sched/" class="md-nav__link">
        Switch Buffering and Packet Scheduling
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/sysml/" class="md-nav__link">
        SysML
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/arch/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/cryptography/" class="md-nav__link">
        Cryptography
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/cryptocurrency/" class="md-nav__link">
        Cryptocurrency
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/hardware_pl/" class="md-nav__link">
        Hardware Design Languages
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/paper_perf_shadows/" class="md-nav__link">
        Performance-Shadows
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/essential/" class="md-nav__link">
        Essential
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/cheatsheet/" class="md-nav__link">
        Cheatsheet
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../blog/20200404-on-read-once/" class="md-nav__link">
        On Read Once and Compiler Optimization
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Code
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Code" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/source_code/summary/" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      <label class="md-nav__link" for="__nav_3_2">
        Linux
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Linux" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/linux/" class="md-nav__link">
        Linux Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/linux/linux-function-trace/" class="md-nav__link">
        Linux Dump Function Graph
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/linux/fork/" class="md-nav__link">
        Linux fork/switch_to
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/linux/linux-rcu/" class="md-nav__link">
        Linux RCU
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/linux/linux-completion/" class="md-nav__link">
        Linux Completion/swait
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/linux/linux-workqueue/" class="md-nav__link">
        Linux workqueue
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/linux/linux-linker-script/" class="md-nav__link">
        Linux Linker Script
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/linux/linux-boot/" class="md-nav__link">
        Linux Boot Sequence
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/trace/" class="md-nav__link">
        Linux Trace and Profile
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/rmap/" class="md-nav__link">
        Linux Reverse Mapping
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/userfaultfd/" class="md-nav__link">
        Linux Userfaultfd
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/cgroup-swap/" class="md-nav__link">
        Linux Cgroup and Swap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/xperf/" class="md-nav__link">
        Linux x86 Ring Switch
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/linux/linux-x86-fpu/" class="md-nav__link">
        Linux FPU
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/linux/linux-iouring/" class="md-nav__link">
        Linux io_uring
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/linux/linux-resource/" class="md-nav__link">
        Linux Resource
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/proc/" class="md-nav__link">
        Linux Special Files
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/kvm-basic/" class="md-nav__link">
        Linux KVM
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/linux/rust.md" class="md-nav__link">
        Linux Rust
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      <label class="md-nav__link" for="__nav_3_3">
        Go
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Go" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Go
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/go/golang/" class="md-nav__link">
        Learn Go
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/go/gvisor/" class="md-nav__link">
        gVisor
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      <label class="md-nav__link" for="__nav_3_4">
        Rust
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Rust" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Rust
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/rust/rust/" class="md-nav__link">
        Learn Rust
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/rust/firecracker.md" class="md-nav__link">
        Firecracker
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/program_advice/" class="md-nav__link">
        Guideline & Advice
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/source_code/firmware-softwares/" class="md-nav__link">
        Firmware & Bootloader
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/source_code/os/" class="md-nav__link">
        Operating System
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/source_code/compilers/" class="md-nav__link">
        Compilers
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/source_code/unix-tools/" class="md-nav__link">
        Unix Tools
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/source_code/virt/" class="md-nav__link">
        Virtualization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/source_code/rdma/" class="md-nav__link">
        DPDK and RDMA
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/source_code/20200501-on-graphic-softwares/" class="md-nav__link">
        Graphics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/source_code/gpu/" class="md-nav__link">
        GPU
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/source_code/fpga/" class="md-nav__link">
        FPGA
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/source_code/risc-v/" class="md-nav__link">
        RISC-V
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/source_code/dotconfigs/" class="md-nav__link">
        Dot-Configs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/source_code/misc/" class="md-nav__link">
        Misc
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        FPGA
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="FPGA" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          FPGA
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Bitstream Explained
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Bitstream Explained
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bistream-related-files" class="md-nav__link">
    Bistream Related Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#details" class="md-nav__link">
    Details
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/paper_fpga/" class="md-nav__link">
        Papers
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../language/" class="md-nav__link">
        Languages
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../vivado/" class="md-nav__link">
        Vivado Notes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../setup_hold/" class="md-nav__link">
        Setup and Hold Time
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pr/" class="md-nav__link">
        Partial Reconfiguration
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        LegoOS
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="LegoOS" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          LegoOS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" >
      
      <label class="md-nav__link" for="__nav_5_1">
        Log
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Log" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Log
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/log/misc/" class="md-nav__link">
        MISC
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/log/test-note/" class="md-nav__link">
        Test Script
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      <label class="md-nav__link" for="__nav_5_2">
        Kernel
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Kernel" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Kernel
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/boot/" class="md-nav__link">
        GRUB2 and Boot
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/kconfig/" class="md-nav__link">
        Kconfig
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/debug/" class="md-nav__link">
        Debug
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/grub/" class="md-nav__link">
        GRUB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/profile/" class="md-nav__link">
        Profile
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/profile_strace/" class="md-nav__link">
        Profile strace
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/profile_heatmap/" class="md-nav__link">
        Profile heatmap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/profile_points/" class="md-nav__link">
        Profile points
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/trampoline/" class="md-nav__link">
        Trampoline
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/pagefault_disable/" class="md-nav__link">
        Disable pgfault
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/stop_machine/" class="md-nav__link">
        Stop machine
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/loader/" class="md-nav__link">
        Program Loader
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/vDSO/" class="md-nav__link">
        vDSO
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/vfs/" class="md-nav__link">
        Virtual File System
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/vm/" class="md-nav__link">
        Process Virtual Memory
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/fpu/" class="md-nav__link">
        x86 FPU
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/irq/" class="md-nav__link">
        IRQ
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/net_thpool/" class="md-nav__link">
        Network Thpool
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" type="checkbox" id="__nav_5_3" >
      
      <label class="md-nav__link" for="__nav_5_3">
        Syscall
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Syscall" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          Syscall
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/syscall/facts/" class="md-nav__link">
        Facts
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/kernel/profile_strace/" class="md-nav__link">
        strace
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/syscall/compat/" class="md-nav__link">
        compat
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/syscall/msync/" class="md-nav__link">
        msync()
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/syscall/mremap/" class="md-nav__link">
        mremap()
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/syscall/fork/" class="md-nav__link">
        fork()
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/syscall/getrusage/" class="md-nav__link">
        getrusage()
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/syscall/wait_and_exit/" class="md-nav__link">
        wait4 and exit()
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_4" type="checkbox" id="__nav_5_4" >
      
      <label class="md-nav__link" for="__nav_5_4">
        Pcache
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Pcache" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          Pcache
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/pcache/config/" class="md-nav__link">
        Config
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/pcache/sweep/" class="md-nav__link">
        Sweep
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/pcache/tlb/" class="md-nav__link">
        TLB Coherence
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/pcache/pgtable-lock/" class="md-nav__link">
        PageTable Lock
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/pcache/victim/" class="md-nav__link">
        Victim Cache
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/pcache/virtual_cache/" class="md-nav__link">
        Virtual Cache
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/pcache/rmap/" class="md-nav__link">
        Reverse Mapping
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/pcache/evict_and_ref/" class="md-nav__link">
        Evict and Refcount
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/pcache/smp_design/" class="md-nav__link">
        SMP Design
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/pcache/replication/" class="md-nav__link">
        Replication
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_5" type="checkbox" id="__nav_5_5" >
      
      <label class="md-nav__link" for="__nav_5_5">
        Driver
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Driver" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_5">
          <span class="md-nav__icon md-icon"></span>
          Driver
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/driver/pci/" class="md-nav__link">
        PCI
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/driver/ib/" class="md-nav__link">
        Infiniband
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_6" type="checkbox" id="__nav_5_6" >
      
      <label class="md-nav__link" for="__nav_5_6">
        Paper
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Paper" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_6">
          <span class="md-nav__icon md-icon"></span>
          Paper
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/paper/nmp/" class="md-nav__link">
        NMP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/paper/processor_oom/" class="md-nav__link">
        Processor OOM
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/paper/genz/" class="md-nav__link">
        Gen-Z
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/paper/replication/" class="md-nav__link">
        Replication
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lego/paper/related/" class="md-nav__link">
        Related
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bistream-related-files" class="md-nav__link">
    Bistream Related Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#details" class="md-nav__link">
    Details
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/lastweek/lastweek.github.io/edit/master/docs/fpga/bitstream.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="fpga-bitstream-explained">FPGA Bitstream Explained<a class="headerlink" href="#fpga-bitstream-explained" title="Permanent link">&para;</a></h1>
<p><img alt="ðŸª" class="twemoji" src="https://twemoji.maxcdn.com/v/latest/svg/1f42a.svg" title=":dromedary_camel:" /></p>
<details class="note"><summary>Version History</summary><table>
<thead>
<tr>
<th align="left">Date</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Sep 18, 2020</td>
<td>add github link and usenix paper</td>
</tr>
<tr>
<td align="left">Dec 20, 2019</td>
<td>Update</td>
</tr>
<tr>
<td align="left">Oct 24, 2019</td>
<td>Created</td>
</tr>
</tbody>
</table>
</details>
<p>The proof-of-concept code to decode Xilinx bitstream is here: <a href="https://github.com/lastweek/fpga_decode_bitstream">https://github.com/lastweek/fpga_decode_bitstream</a>.</p>
<p><a href="https://www.usenix.org/conference/usenixsecurity20/presentation/ender">USENIX Security 2020</a> has a paper on decrypting Xilinx bitstream.
They find a vulnerability in the 7-series chip and in turn able to decrypt a fully encrypted bitstream. WHAT A HACK!</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>An FPGA bitstream can configure an FPGA.
A bitstream includes the description of the hardware logic, routing, and initial
values for both registers and on-chip memory (e.g., LUT).
The common impression is that a bitstream has vendor-specific format thus cannot be reversed or understood.
This impression is partially true.</p>
<p>A bitstream file is more than the bits to configure an FPGA,
it also has certain human-readable fields to describe those bits.
In fact, it has a <strong>assembly-like instruction set</strong> to describe the FPGA configuration process.
This note is trying to walk through this.</p>
<p>At a high-level, a bitstream file is similar to an executable program.
Analogous to the ELF format, a bistream has its own format to describe the contents.
Note, the file format is publicly documented <a href="https://www.xilinx.com/support/documentation/user_guides/ug570-ultrascale-configuration.pdf">1</a>.
Thus, you <strong>can</strong> analyze the contents of a bitstream file, meaning you can understand the steps taken to configure the FPGA.
The un-documented part is the <strong>bits mapping</strong>:
the format of the configuration bits,
especially how the bitstream bits map to specific on-chip LUTs, wires etc.
Think this way, you can understand that the assembly instruction is doing addition on registers,
but it does not tell you which register.</p>
<p>As a normal FPGA user, you mostly do not need to understand neither of these.
You only need to understand these if you are planning to do <strong>bitstream readback</strong>,
<strong>preemption scheduling</strong>, and so on.</p>
<p>After reading this note, I hope you could understand that a bitstream file is just
a sequence of instructions and data.
The FPGA itself has a simple state machine to parse the bitstream and then configure the chip (ICAP in Xilinx).
Part of the bistream file format is public, the mapping between the bitstream configuration bits
and the actual physical resource is undocumented.</p>
<h2 id="bistream-related-files">Bistream Related Files<a class="headerlink" href="#bistream-related-files" title="Permanent link">&para;</a></h2>
<p>In a normal flow, Vivado only generates a simple <code>.bit</code> file.
When you click &ldquo;Program Device&rdquo;, Vivado will use this file to configure your FPGA.</p>
<p>In addition to generating this file, Vivado is capable of generating a bunch other files.
You can find a complete coverage in this <a href="https://www.xilinx.com/support/answers/14468.html">link</a>.
We give a high level summary here.
Most of the files have the same content and have similar file size.
For instance, the difference between a <code>.rbt</code> and a <code>.bit</code> is that the former one is in ASCII format while the latter is in binary format,
but they have the <em>same</em> contents. As for a <code>.bit</code> and a <code>.bin</code> file, the latter does not have some ASCII headers at the beginning of the file.</p>
<p><code>.ll</code>, the logical link file, is very interesting.
It tells you the mapping between user logic and the actual bit offset in the bistream file data section.
This file can be used to aid preemption scheduling.
However, note that, this file only documents a very small part of the mapping.
To the best of my knowledge, I think only the registers, on-chip memory are documented, but the routing
information is missing. Thus, this file can help reserve engineer bitstream data section to some extend, but not full of it.
<a href="https://github.com/SymbiFlow/prjxray">Prjxray</a> is an open source project working on cracking everything on 7-series FPGA.</p>
<h2 id="details">Details<a class="headerlink" href="#details" title="Permanent link">&para;</a></h2>
<p>We use <code>.rbt</code> and <code>.bit</code> to demonstrate the file format.
Note that they are essentially the same thing, except the former in human-readable ASCII format.</p>
<p>The target board is VCU118, the one used by many cloud vendors.</p>
<p>The following snippt is the first few lines of the <code>.rpt</code> file.
The first few lines are human-readable ASCII contents describing some general information
about the bitstream. Starting from line 8 is the actual bitstream file contents.
Note that the <code>.bin</code> file starts directly from line 8, no general header info is attached.
The interesting part is the 1s and 0s.
Unless otherwise noted, when we refer to bitstream format, we focus on the 1s and 0s only
and omit any general ASICC information headers.</p>
<div class="highlight"><pre><span></span><code>Xilinx ASCII Bitstream
Created by Bitstream 2018.3 SW Build 2405991 on Thu Dec  6 23:36:41 MST 2018
Design name:    base_mb_wrapper;UserID=0XFFFFFFFF;Version=2018.3
Architecture:   virtexuplus
Part:           xcvu9p-flga2104-2L-e
Date:           Wed Nov 20 04:13:05 2019
Bits:           641272864
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
...
</code></pre></div>
<p>Note that each line has 32 bits, thus 4 bytes.
In Xilinx bistream format, each four bytes is a packet (analogous to CPU instruction).
Each packet has certain format, it could be a special <em>header packet</em>, or a normal <em>data packet</em>.
The header packet follows a simple assembly-like instruction set to dictate the configuration process.
The bitstream file is a sequence of these four bytes packets. </p>
<p>Why it sounds so complicated, a sequence of instructions?!
I think the short answer is that configuraing FPGA is not an easy task,
and any wrong doings may permanently harm the chip.
Natually, the designer would have a on-chip state machine to control the configuration process,
not only to control the whole process but also to ensure safety.</p>
<p>Each Xilinx FPGA has an on-chip <em>configuration packet processor</em>.
All configuration methods such as JTAG, SelectMAP, ICAP merge into this final narrow bridge to carry out the configuration.
The configuration packet processor has many internal registers (similar to x86 RAX, CRn, MSR registers).
The bitstream usually interact with one of the registers at a time to do one thing.
For a more detailed explanation, check out <a href="https://www.kc8apf.net/2018/05/unpacking-xilinx-7-series-bitstreams-part-2/">this blog</a>,
and UG570 chapter 9.</p>
<p>To this end, a bitstream consits of three parts:</p>
<ul>
<li>1) Header packets to prepare the configuration process.</li>
<li>2) The actual configuration bits in a contiguous sequence of data packets.
     AN write to the <code>FDRI</code> register marks the beginning of this section.
     The length of this section is described by the packet following the FDRI header packet.</li>
<li>3) Header packets to clean up the configuration process.</li>
</ul>
<p>The actual configuration bits are the ones determine the FPGA functionality.
Note that if you are using an SSI Xilinx device like VCU118, the bitstream format is a bit more complicated.
Basically, each die has the above three parts. If an chip has N dies, it will have N above triplet.
I have complained about this is not well documented <a href="https://forums.xilinx.com/t5/FPGA-Configuration/Readback-Verify-and-Capture-on-SSI-devices/m-p/1045810/highlight/true#M14828">here</a>
and <a href="https://forums.xilinx.com/t5/FPGA-Configuration/Issues-with-ll-and-msk-file-with-an-SSI-Ultrascale-chip-VCU118/m-p/1047253">here</a>.</p>
<p>I wrote a simple <a href="https://github.com/lastweek/FPGA-Xilinx-Bitstream">C program</a>
to parse the <code>.rbt</code> file and associate a human-reable syntax with each line.
I didn&rsquo;t have a complete coverage of the header packet format.
The following snippt shows a parsed <code>.rbt</code> file with header removed.
Here, <code>0xffffffff</code> has no effect, like a NOP.
<code>0x000000bb</code> and <code>0x11220044</code> are special bus detect words.
<code>0xaa995566</code> is another special work marking the synchronization status.
The last few lines mark the beginning of the configuration bits section.</p>
<div class="highlight"><pre><span></span><code>Parsed from base_mb_wrapper.rbt
ffffffff 
ffffffff 
ffffffff 
ffffffff 
ffffffff 
ffffffff 
ffffffff 
ffffffff 
ffffffff 
ffffffff 
ffffffff 
ffffffff 
ffffffff 
ffffffff 
ffffffff 
ffffffff 
000000bb Bus Width Sync
11220044 Bus Width Detect
ffffffff 
ffffffff 
aa995566  SYNC
20000000 
20000000 
30022001 Write to regs 17
00000000 
30020001 Write to regs 16
00000000 
30008001 Write to CMD
00000000 
20000000 
30008001 Write to CMD
00000007 
20000000 
20000000 
30002001 Write to FAR
00000000 
30026001 Write to regs 19
00000000 
30012001 Write to regs 9
38003fe5 Write to regs 1
3001c001 Write to regs 14
00400000 
30018001 Write to IDCODE
04b31093 IDCODE=4b31093
30008001 Write to CMD
00000009 
20000000 
3000c001 Write to regs 6
00000001 
3000a001 Write to regs 5
00000101 
3000c001 Write to regs 6
00000000 
30030001 Write to regs 24
00000000 
20000000 
20000000 
20000000 
20000000 
20000000 
20000000 
20000000 
20000000 
30002001 Write to FAR
00000000 
30008001 Write to CMD
00000001 
20000000 
30004000 Write to FDRI
5065eadc            &lt;- The length of configuration bits, follows a certain format
00000000            &lt;- The first 4 bytes of the configuration bits!
</code></pre></div>
<p>Thank you for reading. Hope you enjoyed this post.</p>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="https://www.xilinx.com/support/documentation/user_guides/ug570-ultrascale-configuration.pdf">Xilinx UG570</a></li>
<li><a href="https://www.xilinx.com/support/answers/14468.html">Xilinx bitstream files</a></li>
<li><a href="https://www.kc8apf.net/2018/05/unpacking-xilinx-7-series-bitstreams-part-2/">Another blog on Xilinx Bitstream Internals</a> </li>
<li><a href="https://github.com/lastweek/FPGA-Xilinx-Bitstream">Source code to annotate bitstream</a></li>
</ol>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: April 29, 2021
      
    
  </small>
</div>
                  
                
              
              
                


  <h2 id="__comments">Comments</h2>
  <div id="disqus_thread"></div>
  <script>var disqus_config=function(){this.page.url="http://lastweek.io/fpga/bitstream/",this.page.identifier="fpga/bitstream/"};window.addEventListener("load",function(){var e=document,i=e.createElement("script");i.src="//lastweek-io.disqus.com/embed.js",i.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(i)})</script>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" title="Back to top" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../notes/source_code/misc/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Misc" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Misc
            </div>
          </div>
        </a>
      
      
        
        <a href="../../notes/paper_fpga/" class="md-footer__link md-footer__link--next" aria-label="Next: Papers" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Papers
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["instant", "tabs", "navigation.tabs", "navigation.tabs.sticky", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.82b56eb2.min.js"></script>
      
    
  </body>
</html>